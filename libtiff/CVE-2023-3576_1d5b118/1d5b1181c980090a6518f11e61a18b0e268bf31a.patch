commit 1d5b1181c980090a6518f11e61a18b0e268bf31a (from 6bb0f1171adfcccde2cd7931e74317cccb7db845)	1d5b1181c980090a6518f11e61a18b0e268bf31a
Merge: 6bb0f117 881a0701
Author: Even Rouault <even.rouault@spatialys.com>
Date:   Sat Mar 11 13:23:49 2023 +0000

    Merge branch 'master' into 'master'
    
    Fix memory leak in tiffcrop.c
    
    See merge request libtiff/libtiff!475

diff --git a/tools/tiffcrop.c b/tools/tiffcrop.c
index d3e11ba2..24d0ca84 100644
--- a/tools/tiffcrop.c
+++ b/tools/tiffcrop.c
@@ -8782,8 +8782,13 @@ static int createCroppedImage(struct image_data *image, struct crop_mask *crop,
 
     read_buff = *read_buff_ptr;
 
+    /* Memory is freed before crop_buff_ptr is overwritten */
+    if (*crop_buff_ptr != NULL)
+    {
+	_TIFFfree(*crop_buff_ptr);
+    }
+
     /* process full image, no crop buffer needed */
-    crop_buff = read_buff;
     *crop_buff_ptr = read_buff;
     crop->combined_width = image->width;
     crop->combined_length = image->length;
