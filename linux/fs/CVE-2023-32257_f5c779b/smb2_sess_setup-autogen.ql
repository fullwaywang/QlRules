/**
 * @name linux-f5c779b7ddbda30866cf2a27c63e34158f858c73-smb2_sess_setup
 * @id cpp/linux/f5c779b7ddbda30866cf2a27c63e34158f858c73/smb2-sess-setup
 * @description linux-f5c779b7ddbda30866cf2a27c63e34158f858c73-fs/ksmbd/smb2pdu.c-smb2_sess_setup CVE-2023-32250
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vsess_1618, FunctionCall target_0) {
	target_0.getTarget().hasName("ksmbd_session_destroy")
	and not target_0.getTarget().hasName("ksmbd_conn_lock")
	and target_0.getArgument(0).(VariableAccess).getTarget()=vsess_1618
}

predicate func_1(Variable vconn_1615, ExprStmt target_30, EqualityOperation target_31) {
exists(FunctionCall target_1 |
	target_1.getTarget().hasName("ksmbd_conn_need_reconnect")
	and target_1.getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_1.getParent().(IfStmt).getThen()=target_30
	and target_1.getArgument(0).(VariableAccess).getLocation().isBefore(target_31.getLeftOperand().(FunctionCall).getArgument(0).(VariableAccess).getLocation()))
}

predicate func_5(EqualityOperation target_20, Function func) {
exists(GotoStmt target_5 |
	target_5.getName() ="out_err"
	and target_5.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(2)=target_5
	and target_5.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_20
	and target_5.getEnclosingFunction() = func)
}

predicate func_6(Variable vrc_1621, BitwiseAndExpr target_17, IfStmt target_32) {
exists(ExprStmt target_6 |
	target_6.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_6.getExpr().(AssignExpr).getRValue().(UnaryMinusExpr).getValue()="-14"
	and target_6.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(0)=target_6
	and target_6.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_17
	and target_32.getCondition().(VariableAccess).getLocation().isBefore(target_6.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation()))
}

predicate func_7(BitwiseAndExpr target_17, Function func) {
exists(GotoStmt target_7 |
	target_7.getName() ="out_err"
	and target_7.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(1)=target_7
	and target_7.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_17
	and target_7.getEnclosingFunction() = func)
}

predicate func_8(Variable vconn_1615, Variable vsess_1618, Variable vrc_1621, LogicalAndExpr target_33, ExprStmt target_34, NotExpr target_35, ExprStmt target_36, ExprStmt target_37) {
exists(IfStmt target_8 |
	target_8.getCondition().(FunctionCall).getTarget().hasName("ksmbd_conn_need_reconnect")
	and target_8.getCondition().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_8.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_8.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(UnaryMinusExpr).getValue()="-14"
	and target_8.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vsess_1618
	and target_8.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getRValue() instanceof Literal
	and target_8.getThen().(BlockStmt).getStmt(2).(GotoStmt).getName() ="out_err"
	and target_8.getParent().(BlockStmt).getParent().(IfStmt).getElse().(BlockStmt).getStmt(3)=target_8
	and target_8.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_33
	and target_34.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_8.getCondition().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
	and target_35.getOperand().(VariableAccess).getLocation().isBefore(target_8.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation())
	and target_8.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_36.getExpr().(AssignExpr).getRValue().(VariableAccess).getLocation())
	and target_37.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_8.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation()))
}

predicate func_9(Parameter vwork_1613, Variable vconn_1615, Variable vsess_1618, Variable vnegblob_1619, Variable vrc_1621, BitwiseAndExpr target_38, ExprStmt target_39, ExprStmt target_40, BitwiseAndExpr target_17, ExprStmt target_21, ExprStmt target_22, ExprStmt target_41, ExprStmt target_42) {
exists(IfStmt target_9 |
	target_9.getCondition() instanceof BitwiseAndExpr
	and target_9.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_9.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("krb5_authenticate")
	and target_9.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vwork_1613
	and target_9.getThen().(BlockStmt).getStmt(1).(IfStmt).getCondition().(VariableAccess).getTarget()=vrc_1621
	and target_9.getThen().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_9.getThen().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(1).(GotoStmt).getName() ="out_err"
	and target_9.getThen().(BlockStmt).getStmt(2).(IfStmt).getCondition().(NotExpr).getOperand().(FunctionCall).getTarget().hasName("ksmbd_conn_need_reconnect")
	and target_9.getThen().(BlockStmt).getStmt(2).(IfStmt).getCondition().(NotExpr).getOperand().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_9.getThen().(BlockStmt).getStmt(2).(IfStmt).getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("ksmbd_conn_set_good")
	and target_9.getThen().(BlockStmt).getStmt(2).(IfStmt).getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_9.getThen().(BlockStmt).getStmt(2).(IfStmt).getThen().(BlockStmt).getStmt(1) instanceof ExprStmt
	and target_9.getThen().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("kfree")
	and target_9.getThen().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="Preauth_HashValue"
	and target_9.getThen().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vsess_1618
	and target_9.getThen().(BlockStmt).getStmt(4).(ExprStmt).getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="Preauth_HashValue"
	and target_9.getThen().(BlockStmt).getStmt(4).(ExprStmt).getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vsess_1618
	and target_9.getThen().(BlockStmt).getStmt(4).(ExprStmt).getExpr().(AssignExpr).getRValue().(Literal).getValue()="0"
	and target_9.getElse().(IfStmt).getCondition().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getTarget().getName()="preferred_auth_mech"
	and target_9.getElse().(IfStmt).getCondition().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vconn_1615
	and target_9.getElse().(IfStmt).getCondition().(EqualityOperation).getRightOperand().(Literal).getValue()="1"
	and target_9.getElse().(IfStmt).getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getTarget().getName()="MessageType"
	and target_9.getElse().(IfStmt).getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vnegblob_1619
	and target_9.getElse().(IfStmt).getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(EqualityOperation).getRightOperand().(Literal).getValue()="1"
	and target_9.getElse().(IfStmt).getThen().(BlockStmt).getStmt(0).(IfStmt).getThen().(BlockStmt).getStmt(1).(IfStmt).getCondition().(VariableAccess).getTarget()=vrc_1621
	and target_9.getElse().(IfStmt).getThen().(BlockStmt).getStmt(0).(IfStmt).getThen().(BlockStmt).getStmt(1).(IfStmt).getThen().(GotoStmt).getName() ="out_err"
	and target_9.getElse().(IfStmt).getThen().(BlockStmt).getStmt(0).(IfStmt).getThen().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("inc_rfc1001_len")
	and target_9.getElse().(IfStmt).getThen().(BlockStmt).getStmt(0).(IfStmt).getElse().(IfStmt).getCondition().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getTarget().getName()="MessageType"
	and target_9.getElse().(IfStmt).getThen().(BlockStmt).getStmt(0).(IfStmt).getElse().(IfStmt).getCondition().(EqualityOperation).getRightOperand().(Literal).getValue()="3"
	and target_9.getElse().(IfStmt).getElse().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_9.getElse().(IfStmt).getElse().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getRValue().(UnaryMinusExpr).getValue()="-22"
	and target_9.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(2)=target_9
	and target_9.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_38
	and target_39.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_9.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
	and target_9.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_40.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
	and target_17.getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_9.getThen().(BlockStmt).getStmt(2).(IfStmt).getCondition().(NotExpr).getOperand().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
	and target_21.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_9.getThen().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
	and target_9.getThen().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_22.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
	and target_41.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_9.getElse().(IfStmt).getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
	and target_9.getElse().(IfStmt).getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_42.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(VariableAccess).getLocation()))
}

/*predicate func_10(Variable vconn_1615, BitwiseAndExpr target_17, EqualityOperation target_43) {
exists(IfStmt target_10 |
	target_10.getCondition().(NotExpr).getOperand().(FunctionCall).getTarget().hasName("ksmbd_conn_need_reconnect")
	and target_10.getCondition().(NotExpr).getOperand().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_10.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("ksmbd_conn_set_good")
	and target_10.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_10.getThen().(BlockStmt).getStmt(1) instanceof ExprStmt
	and target_10.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(2)=target_10
	and target_10.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_17
	and target_10.getCondition().(NotExpr).getOperand().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_43.getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation()))
}

*/
/*predicate func_12(Variable vconn_1615, EqualityOperation target_44, EqualityOperation target_43, IfStmt target_45) {
exists(IfStmt target_12 |
	target_12.getCondition().(NotExpr).getOperand().(FunctionCall).getTarget().hasName("ksmbd_conn_need_reconnect")
	and target_12.getCondition().(NotExpr).getOperand().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_12.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("ksmbd_conn_set_good")
	and target_12.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_12.getThen().(BlockStmt).getStmt(1) instanceof ExprStmt
	and target_12.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(2)=target_12
	and target_12.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_44
	and target_43.getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_12.getCondition().(NotExpr).getOperand().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
	and target_12.getCondition().(NotExpr).getOperand().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_45.getCondition().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation()))
}

*/
predicate func_14(Variable vsess_1618, ExprStmt target_46) {
exists(AssignExpr target_14 |
	target_14.getLValue().(PointerFieldAccess).getTarget().getName()="state"
	and target_14.getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vsess_1618
	and target_14.getRValue().(Literal).getValue()="0"
	and target_14.getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_46.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation()))
}

predicate func_15(Variable vconn_1615, AddressOfExpr target_47, Function func) {
exists(ExprStmt target_15 |
	target_15.getExpr().(FunctionCall).getTarget().hasName("ksmbd_conn_unlock")
	and target_15.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_15
	and target_15.getFollowingStmt() instanceof ReturnStmt
	and target_47.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_15.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation()))
}

predicate func_16(Variable vsess_1618, PointerFieldAccess target_16) {
	target_16.getTarget().getName()="state"
	and target_16.getQualifier().(VariableAccess).getTarget()=vsess_1618
	and target_16.getParent().(AssignExpr).getLValue() = target_16
	and target_16.getParent().(AssignExpr).getRValue() instanceof BinaryBitwiseOperation
}

predicate func_17(Variable vconn_1615, BlockStmt target_48, BitwiseAndExpr target_17) {
	target_17.getLeftOperand().(PointerFieldAccess).getTarget().getName()="preferred_auth_mech"
	and target_17.getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vconn_1615
	and target_17.getRightOperand().(BitwiseOrExpr).getValue()="6"
	and target_17.getParent().(IfStmt).getThen()=target_48
}

/*predicate func_18(Variable vsess_1618, PointerFieldAccess target_18) {
	target_18.getTarget().getName()="state"
	and target_18.getQualifier().(VariableAccess).getTarget()=vsess_1618
	and target_18.getParent().(AssignExpr).getLValue() = target_18
	and target_18.getParent().(AssignExpr).getRValue().(BinaryBitwiseOperation).getValue()="2"
}

*/
/*predicate func_19(Variable vsess_1618, PointerFieldAccess target_19) {
	target_19.getTarget().getName()="state"
	and target_19.getQualifier().(VariableAccess).getTarget()=vsess_1618
	and target_19.getParent().(AssignExpr).getLValue() = target_19
	and target_19.getParent().(AssignExpr).getRValue().(BinaryBitwiseOperation).getValue()="2"
}

*/
predicate func_20(Variable vsess_1618, ExprStmt target_30, EqualityOperation target_20) {
	target_20.getLeftOperand().(PointerFieldAccess).getTarget().getName()="state"
	and target_20.getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vsess_1618
	and target_20.getRightOperand().(Literal).getValue()="0"
	and target_20.getParent().(IfStmt).getThen()=target_30
}

predicate func_21(Variable vsess_1618, BitwiseAndExpr target_17, ExprStmt target_21) {
	target_21.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="state"
	and target_21.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vsess_1618
	and target_21.getExpr().(AssignExpr).getRValue().(BinaryBitwiseOperation).getValue()="2"
	and target_21.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_17
}

predicate func_22(Variable vsess_1618, EqualityOperation target_44, ExprStmt target_22) {
	target_22.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="state"
	and target_22.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vsess_1618
	and target_22.getExpr().(AssignExpr).getRValue().(BinaryBitwiseOperation).getValue()="2"
	and target_22.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_44
}

predicate func_24(Variable vconn_1615, VariableAccess target_24) {
	target_24.getTarget()=vconn_1615
	and target_24.getParent().(PointerFieldAccess).getParent().(AddressOfExpr).getParent().(FunctionCall).getParent().(ExprStmt).getExpr() instanceof FunctionCall
}

predicate func_25(Variable vsess_1618, ExprStmt target_21, BinaryBitwiseOperation target_25) {
	target_25.getValue()="1"
	and target_25.getParent().(AssignExpr).getRValue() = target_25
	and target_25.getParent().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="state"
	and target_25.getParent().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vsess_1618
	and target_25.getParent().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_21.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_26(Parameter vwork_1613, ExprStmt target_49, ExprStmt target_42, VariableAccess target_26) {
	target_26.getTarget()=vwork_1613
	and target_26.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("ksmbd_conn_set_good")
	and target_49.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_26.getLocation())
	and target_26.getLocation().isBefore(target_42.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_27(Parameter vwork_1613, ExprStmt target_50, ExprStmt target_51, VariableAccess target_27) {
	target_27.getTarget()=vwork_1613
	and target_27.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("ksmbd_conn_set_good")
	and target_50.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_27.getLocation())
	and target_27.getLocation().isBefore(target_51.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_28(Variable vconn_1615, Variable vsess_1618, FunctionCall target_28) {
	target_28.getTarget().hasName("xa_erase")
	and target_28.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="sessions"
	and target_28.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vconn_1615
	and target_28.getArgument(1).(PointerFieldAccess).getTarget().getName()="id"
	and target_28.getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vsess_1618
}

predicate func_29(Parameter vwork_1613, ExprStmt target_52, PointerFieldAccess target_29) {
	target_29.getTarget().getName()="sess"
	and target_29.getQualifier().(VariableAccess).getTarget()=vwork_1613
	and target_52.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_29.getQualifier().(VariableAccess).getLocation())
}

predicate func_30(Variable vsess_1618, ExprStmt target_30) {
	target_30.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="state"
	and target_30.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vsess_1618
	and target_30.getExpr().(AssignExpr).getRValue() instanceof BinaryBitwiseOperation
}

predicate func_31(Variable vconn_1615, Variable vnegblob_1619, EqualityOperation target_31) {
	target_31.getLeftOperand().(FunctionCall).getTarget().hasName("decode_negotiation_token")
	and target_31.getLeftOperand().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_31.getLeftOperand().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vnegblob_1619
	and target_31.getLeftOperand().(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("unsigned int")
	and target_31.getRightOperand().(Literal).getValue()="0"
}

predicate func_32(Variable vrc_1621, BitwiseAndExpr target_38, IfStmt target_32) {
	target_32.getCondition().(VariableAccess).getTarget()=vrc_1621
	and target_32.getThen().(GotoStmt).getName() ="out_err"
	and target_32.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_38
}

predicate func_33(Variable vconn_1615, LogicalAndExpr target_33) {
	target_33.getLeftOperand().(LogicalOrExpr).getLeftOperand().(RelationalOperation).getLesserOperand().(PointerFieldAccess).getTarget().getName()="dialect"
	and target_33.getLeftOperand().(LogicalOrExpr).getLeftOperand().(RelationalOperation).getLesserOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vconn_1615
	and target_33.getLeftOperand().(LogicalOrExpr).getLeftOperand().(RelationalOperation).getGreaterOperand().(Literal).getValue()="768"
	and target_33.getLeftOperand().(LogicalOrExpr).getRightOperand().(BitwiseAndExpr).getLeftOperand().(ValueFieldAccess).getTarget().getName()="flags"
	and target_33.getLeftOperand().(LogicalOrExpr).getRightOperand().(BitwiseAndExpr).getLeftOperand().(ValueFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("ksmbd_server_config")
	and target_33.getLeftOperand().(LogicalOrExpr).getRightOperand().(BitwiseAndExpr).getRightOperand().(BinaryBitwiseOperation).getValue()="4"
	and target_33.getRightOperand().(BitwiseAndExpr).getLeftOperand().(PointerFieldAccess).getTarget().getName()="Flags"
	and target_33.getRightOperand().(BitwiseAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("smb2_sess_setup_req *")
	and target_33.getRightOperand().(BitwiseAndExpr).getRightOperand().(Literal).getValue()="1"
}

predicate func_34(Variable vconn_1615, Variable vsess_1618, ExprStmt target_34) {
	target_34.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vsess_1618
	and target_34.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("ksmbd_session_lookup")
	and target_34.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_34.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(ValueFieldAccess).getTarget().getName()="SessionId"
	and target_34.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="hdr"
	and target_34.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("smb2_sess_setup_req *")
}

predicate func_35(Variable vsess_1618, BlockStmt target_53, NotExpr target_35) {
	target_35.getOperand().(VariableAccess).getTarget()=vsess_1618
	and target_35.getParent().(IfStmt).getThen()=target_53
}

predicate func_36(Parameter vwork_1613, Variable vsess_1618, ExprStmt target_36) {
	target_36.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="sess"
	and target_36.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vwork_1613
	and target_36.getExpr().(AssignExpr).getRValue().(VariableAccess).getTarget()=vsess_1618
}

predicate func_37(Variable vrc_1621, NotExpr target_35, ExprStmt target_37) {
	target_37.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_37.getExpr().(AssignExpr).getRValue().(UnaryMinusExpr).getValue()="-2"
	and target_37.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_35
}

predicate func_38(Variable vconn_1615, BitwiseAndExpr target_38) {
	target_38.getLeftOperand().(ValueFieldAccess).getTarget().getName()="auth_mechs"
	and target_38.getLeftOperand().(ValueFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("ksmbd_server_config")
	and target_38.getRightOperand().(PointerFieldAccess).getTarget().getName()="auth_mechs"
	and target_38.getRightOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vconn_1615
}

predicate func_39(Parameter vwork_1613, Variable vrc_1621, ExprStmt target_39) {
	target_39.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_39.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("generate_preauth_hash")
	and target_39.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vwork_1613
}

predicate func_40(Parameter vwork_1613, BitwiseAndExpr target_17, ExprStmt target_40) {
	target_40.getExpr().(FunctionCall).getTarget().hasName("ksmbd_conn_set_good")
	and target_40.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vwork_1613
	and target_40.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_17
}

predicate func_41(Variable vconn_1615, Variable vnegblob_1619, ExprStmt target_41) {
	target_41.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vnegblob_1619
	and target_41.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getTarget().getName()="mechToken"
	and target_41.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vconn_1615
}

predicate func_42(Parameter vwork_1613, Variable vnegblob_1619, Variable vrc_1621, ExprStmt target_42) {
	target_42.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_42.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("ntlm_negotiate")
	and target_42.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vwork_1613
	and target_42.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vnegblob_1619
	and target_42.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("unsigned int")
}

predicate func_43(Variable vconn_1615, EqualityOperation target_43) {
	target_43.getLeftOperand().(PointerFieldAccess).getTarget().getName()="preferred_auth_mech"
	and target_43.getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vconn_1615
	and target_43.getRightOperand().(Literal).getValue()="1"
}

predicate func_44(Variable vnegblob_1619, EqualityOperation target_44) {
	target_44.getLeftOperand().(PointerFieldAccess).getTarget().getName()="MessageType"
	and target_44.getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vnegblob_1619
	and target_44.getRightOperand().(Literal).getValue()="3"
}

predicate func_45(Variable vconn_1615, Variable vsess_1618, IfStmt target_45) {
	target_45.getCondition().(PointerFieldAccess).getTarget().getName()="binding"
	and target_45.getCondition().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vconn_1615
	and target_45.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget().getType().hasName("preauth_session *")
	and target_45.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("ksmbd_preauth_session_lookup")
	and target_45.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_45.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="id"
	and target_45.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vsess_1618
}

predicate func_46(Variable vconn_1615, Variable vsess_1618, ExprStmt target_46) {
	target_46.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget().getType().hasName("preauth_session *")
	and target_46.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("ksmbd_preauth_session_lookup")
	and target_46.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vconn_1615
	and target_46.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="id"
	and target_46.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vsess_1618
}

predicate func_47(Variable vconn_1615, AddressOfExpr target_47) {
	target_47.getOperand().(PointerFieldAccess).getTarget().getName()="sessions"
	and target_47.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vconn_1615
}

predicate func_48(Parameter vwork_1613, Variable vrc_1621, BlockStmt target_48) {
	target_48.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_48.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("krb5_authenticate")
	and target_48.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vwork_1613
	and target_48.getStmt(1).(IfStmt).getCondition().(VariableAccess).getTarget()=vrc_1621
	and target_48.getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_48.getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(UnaryMinusExpr).getValue()="-22"
	and target_48.getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(1).(GotoStmt).getName() ="out_err"
}

predicate func_49(Parameter vwork_1613, Variable vrc_1621, ExprStmt target_49) {
	target_49.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_49.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("krb5_authenticate")
	and target_49.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vwork_1613
}

predicate func_50(Parameter vwork_1613, Variable vrc_1621, ExprStmt target_50) {
	target_50.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_50.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("ntlm_authenticate")
	and target_50.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vwork_1613
}

predicate func_51(Parameter vwork_1613, ExprStmt target_51) {
	target_51.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="sess"
	and target_51.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vwork_1613
	and target_51.getExpr().(AssignExpr).getRValue().(Literal).getValue()="0"
}

predicate func_52(Parameter vwork_1613, EqualityOperation target_44, ExprStmt target_52) {
	target_52.getExpr().(FunctionCall).getTarget().hasName("ksmbd_conn_set_good")
	and target_52.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vwork_1613
	and target_52.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_44
}

predicate func_53(Variable vrc_1621, NotExpr target_35, BlockStmt target_53) {
	target_53.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vrc_1621
	and target_53.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(UnaryMinusExpr).getValue()="-2"
	and target_53.getStmt(1).(GotoStmt).getName() ="out_err"
	and target_53.getParent().(IfStmt).getCondition()=target_35
}

from Function func, Parameter vwork_1613, Variable vconn_1615, Variable vsess_1618, Variable vnegblob_1619, Variable vrc_1621, FunctionCall target_0, PointerFieldAccess target_16, BitwiseAndExpr target_17, EqualityOperation target_20, ExprStmt target_21, ExprStmt target_22, VariableAccess target_24, BinaryBitwiseOperation target_25, VariableAccess target_26, VariableAccess target_27, FunctionCall target_28, PointerFieldAccess target_29, ExprStmt target_30, EqualityOperation target_31, IfStmt target_32, LogicalAndExpr target_33, ExprStmt target_34, NotExpr target_35, ExprStmt target_36, ExprStmt target_37, BitwiseAndExpr target_38, ExprStmt target_39, ExprStmt target_40, ExprStmt target_41, ExprStmt target_42, EqualityOperation target_43, EqualityOperation target_44, IfStmt target_45, ExprStmt target_46, AddressOfExpr target_47, BlockStmt target_48, ExprStmt target_49, ExprStmt target_50, ExprStmt target_51, ExprStmt target_52, BlockStmt target_53
where
func_0(vsess_1618, target_0)
and not func_1(vconn_1615, target_30, target_31)
and not func_5(target_20, func)
and not func_6(vrc_1621, target_17, target_32)
and not func_7(target_17, func)
and not func_8(vconn_1615, vsess_1618, vrc_1621, target_33, target_34, target_35, target_36, target_37)
and not func_9(vwork_1613, vconn_1615, vsess_1618, vnegblob_1619, vrc_1621, target_38, target_39, target_40, target_17, target_21, target_22, target_41, target_42)
and not func_14(vsess_1618, target_46)
and not func_15(vconn_1615, target_47, func)
and func_16(vsess_1618, target_16)
and func_17(vconn_1615, target_48, target_17)
and func_20(vsess_1618, target_30, target_20)
and func_21(vsess_1618, target_17, target_21)
and func_22(vsess_1618, target_44, target_22)
and func_24(vconn_1615, target_24)
and func_25(vsess_1618, target_21, target_25)
and func_26(vwork_1613, target_49, target_42, target_26)
and func_27(vwork_1613, target_50, target_51, target_27)
and func_28(vconn_1615, vsess_1618, target_28)
and func_29(vwork_1613, target_52, target_29)
and func_30(vsess_1618, target_30)
and func_31(vconn_1615, vnegblob_1619, target_31)
and func_32(vrc_1621, target_38, target_32)
and func_33(vconn_1615, target_33)
and func_34(vconn_1615, vsess_1618, target_34)
and func_35(vsess_1618, target_53, target_35)
and func_36(vwork_1613, vsess_1618, target_36)
and func_37(vrc_1621, target_35, target_37)
and func_38(vconn_1615, target_38)
and func_39(vwork_1613, vrc_1621, target_39)
and func_40(vwork_1613, target_17, target_40)
and func_41(vconn_1615, vnegblob_1619, target_41)
and func_42(vwork_1613, vnegblob_1619, vrc_1621, target_42)
and func_43(vconn_1615, target_43)
and func_44(vnegblob_1619, target_44)
and func_45(vconn_1615, vsess_1618, target_45)
and func_46(vconn_1615, vsess_1618, target_46)
and func_47(vconn_1615, target_47)
and func_48(vwork_1613, vrc_1621, target_48)
and func_49(vwork_1613, vrc_1621, target_49)
and func_50(vwork_1613, vrc_1621, target_50)
and func_51(vwork_1613, target_51)
and func_52(vwork_1613, target_44, target_52)
and func_53(vrc_1621, target_35, target_53)
and vwork_1613.getType().hasName("ksmbd_work *")
and vconn_1615.getType().hasName("ksmbd_conn *")
and vsess_1618.getType().hasName("ksmbd_session *")
and vnegblob_1619.getType().hasName("negotiate_message *")
and vrc_1621.getType().hasName("int")
and vwork_1613.getFunction() = func
and vconn_1615.(LocalVariable).getFunction() = func
and vsess_1618.(LocalVariable).getFunction() = func
and vnegblob_1619.(LocalVariable).getFunction() = func
and vrc_1621.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
