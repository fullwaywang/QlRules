commit d2955714a4a0b8ca10941550cfbf64c7e111fbf1	d2955714a4a0b8ca10941550cfbf64c7e111fbf1
Author: erouault <erouault>
Date:   Sat Oct 8 15:14:42 2016 +0000

    * tools/tiff2pdf.c: fix read -largely- outsize of buffer in
    t2p_readwrite_pdf_image_tile(), causing crash, when reading a
    JPEG compressed image with TIFFTAG_JPEGTABLES length being one.
    Reported as MSVR 35101 by Axel Souchet and Vishal Chauhan from
    the MSRC Vulnerabilities & Mitigations team.

diff --git a/ChangeLog b/ChangeLog
index 8f54f286..8b57d1b1 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,11 @@
+2016-10-08 Even Rouault <even.rouault at spatialys.com>
+
+	* tools/tiff2pdf.c: fix read -largely- outsize of buffer in
+	t2p_readwrite_pdf_image_tile(), causing crash, when reading a
+	JPEG compressed image with TIFFTAG_JPEGTABLES length being one.
+	Reported as MSVR 35101 by Axel Souchet and Vishal Chauhan from
+	the MSRC Vulnerabilities & Mitigations team.
+
 2016-10-08 Even Rouault <even.rouault at spatialys.com>
 
 	* tools/tiffcp.c: fix read of undefined variable in case of missing
diff --git a/tools/tiff2pdf.c b/tools/tiff2pdf.c
index f8df6b52..829d4cb3 100644
--- a/tools/tiff2pdf.c
+++ b/tools/tiff2pdf.c
@@ -2887,13 +2887,13 @@ tsize_t t2p_readwrite_pdf_image_tile(T2P* t2p, TIFF* input, TIFF* output, ttile_
 				return(0);
 			}
 			if(TIFFGetField(input, TIFFTAG_JPEGTABLES, &count, &jpt) != 0) {
-				if (count > 0) {
+				if (count >= 2) {
 					_TIFFmemcpy(buffer, jpt, count);
 					bufferoffset += count - 2;
 					table_end[0] = buffer[bufferoffset-2];
 					table_end[1] = buffer[bufferoffset-1];
 				}
-				if (count > 0) {
+				if (count >= 2) {
 					xuint32 = bufferoffset;
 					bufferoffset += TIFFReadRawTile(
 						input, 
