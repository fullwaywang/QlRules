commit 40d442f969fb1e871da6fca73d3f8aef1f888558
Author: Johan Hovold <johan+linaro@kernel.org>
Date:   Wed May 1 08:37:40 2024 +0200

    Bluetooth: qca: fix firmware check error path
    
    A recent commit fixed the code that parses the firmware files before
    downloading them to the controller but introduced a memory leak in case
    the sanity checks ever fail.
    
    Make sure to free the firmware buffer before returning on errors.
    
    Fixes: f905ae0be4b7 ("Bluetooth: qca: add missing firmware sanity checks")
    Cc: stable@vger.kernel.org      # 4.19
    Signed-off-by: Johan Hovold <johan+linaro@kernel.org>
    Signed-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>

diff --git a/drivers/bluetooth/btqca.c b/drivers/bluetooth/btqca.c
index 8d8a664620a3..638074992c82 100644
--- a/drivers/bluetooth/btqca.c
+++ b/drivers/bluetooth/btqca.c
@@ -605,7 +605,7 @@ static int qca_download_firmware(struct hci_dev *hdev,
 
 	ret = qca_tlv_check_data(hdev, config, data, size, soc_type);
 	if (ret)
-		return ret;
+		goto out;
 
 	segment = data;
 	remain = size;
