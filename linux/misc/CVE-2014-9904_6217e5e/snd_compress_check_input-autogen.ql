/**
 * @name linux-6217e5ede23285ddfee10d2e4ba0cc2d4c046205-snd_compress_check_input
 * @id cpp/linux/6217e5ede23285ddfee10d2e4ba0cc2d4c046205/snd-compress-check-input
 * @description linux-6217e5ede23285ddfee10d2e4ba0cc2d4c046205-sound/core/compress_offload.c-snd_compress_check_input CVE-2014-9904
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func, Literal target_0) {
	target_0.getValue()="0"
	and not target_0.getValue()="1"
	and target_0.getParent().(ComplementExpr).getParent().(DivExpr).getLeftOperand() instanceof ComplementExpr
	and target_0.getEnclosingFunction() = func
}

predicate func_1(Function func) {
exists(DivExpr target_1 |
	target_1.getLeftOperand().(BinaryBitwiseOperation).getValue()="2147483647"
	and target_1.getRightOperand() instanceof ValueFieldAccess
	and target_1.getEnclosingFunction() = func)
}

predicate func_2(Parameter vparams_490, ValueFieldAccess target_2) {
	target_2.getTarget().getName()="fragment_size"
	and target_2.getQualifier().(PointerFieldAccess).getTarget().getName()="buffer"
	and target_2.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vparams_490
}

predicate func_3(Function func, DivExpr target_3) {
	target_3.getLeftOperand().(ComplementExpr).getValue()="18446744073709551615"
	and target_3.getRightOperand() instanceof ValueFieldAccess
	and target_3.getEnclosingFunction() = func
}

from Function func, Parameter vparams_490, Literal target_0, ValueFieldAccess target_2, DivExpr target_3
where
func_0(func, target_0)
and not func_1(func)
and func_2(vparams_490, target_2)
and func_3(func, target_3)
and vparams_490.getType().hasName("snd_compr_params *")
and vparams_490.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
