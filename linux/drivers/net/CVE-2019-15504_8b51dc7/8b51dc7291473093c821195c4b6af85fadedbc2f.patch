commit 8b51dc7291473093c821195c4b6af85fadedbc2f
Author: Hui Peng <benquike@gmail.com>
Date:   Mon Aug 19 18:02:29 2019 -0400

    rsi: fix a double free bug in rsi_91x_deinit()
    
    `dev` (struct rsi_91x_usbdev *) field of adapter
    (struct rsi_91x_usbdev *) is allocated  and initialized in
    `rsi_init_usb_interface`. If any error is detected in information
    read from the device side,  `rsi_init_usb_interface` will be
    freed. However, in the higher level error handling code in
    `rsi_probe`, if error is detected, `rsi_91x_deinit` is called
    again, in which `dev` will be freed again, resulting double free.
    
    This patch fixes the double free by removing the free operation on
    `dev` in `rsi_init_usb_interface`, because `rsi_91x_deinit` is also
    used in `rsi_disconnect`, in that code path, the `dev` field is not
     (and thus needs to be) freed.
    
    This bug was found in v4.19, but is also present in the latest version
    of kernel. Fixes CVE-2019-15504.
    
    Reported-by: Hui Peng <benquike@gmail.com>
    Reported-by: Mathias Payer <mathias.payer@nebelwelt.net>
    Signed-off-by: Hui Peng <benquike@gmail.com>
    Reviewed-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Kalle Valo <kvalo@codeaurora.org>

diff --git a/drivers/net/wireless/rsi/rsi_91x_usb.c b/drivers/net/wireless/rsi/rsi_91x_usb.c
index f5048d4b8cb6..760eaffeebd6 100644
--- a/drivers/net/wireless/rsi/rsi_91x_usb.c
+++ b/drivers/net/wireless/rsi/rsi_91x_usb.c
@@ -645,7 +645,6 @@ static int rsi_init_usb_interface(struct rsi_hw *adapter,
 	kfree(rsi_dev->tx_buffer);
 
 fail_eps:
-	kfree(rsi_dev);
 
 	return status;
 }
