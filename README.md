# Auto-generated CodeQL Rules for OSS Vulnerabilites

## Background

[CodeQL](https://codeql.github.com/) is an industry-leading semantic code analysis engine supported by GitHub. With its rich storage of built-in rules covering multiple developing languages and CWE catogaries, CodeQL has been extensively used by whitehat security experts for hunting for vulnerabilites in open-source-software (OSS) repositries.

However, locating known CVEs in old codebases remains as a difficult task for SAST tools like CodeQL. A large portion of vulnerablities, especially those found by hackers manually, have very complicated code context and cannot be matched with generic-purpose rules.

To this end, our attemp of automating the generation of CVE-oriented CodeQL rules comes to real life.

## About patch2ql

patch2ql is our solution, which aims at turning OSS bugfix patches into CodeQL rules (ql). Its basic idea is that reasons and causes of a defect of codes is reflected in the code patch, and by querying the similar code context of the unpatched functions, we can locate a vulnerable codebase. The matched code may be an out-of-date submodule, homologous functions, or even some other repository which `borrows' the very function.

patch2ql is currently under tensive research and development, and many features are still to be tested. This is why it is not yet ready for openning source.

## About this repository

This repository is the place to hold auto-generated rules we retrieve against some top OSS projects along the evolution stage of patch2ql. These released rules, organized according to their corresponding source projects and commit IDs, can be freely used for analyzing some other OSS project which originates/forked from or contains OSS projects whose CVEs we already covered.

## About target OSSs and CVEs

As for now, we mainly focus on OSS written in C/C++, where package management and SCA techniques don't apply.

To focus on the most important, infra-like OSS, we borrowed the list from [google/oss-fuzz](https://github.com/google/oss-fuzz/tree/master/projects), filtered out those denoted `language: c/c++` in their yaml files. Besides, since our tool depends on Git commit to revert code-base to specific versions and to generate patches, we currently only support those hosted or mirrored on any Git platforms.

To collect patching commit IDs for any CVE vulnerability more easily, we utilized the amazing [Ubuntu Security](https://ubuntu.com/security) and [Red Hat Bugzilla](https://bugzilla.redhat.com/) as processed info sources, which contain patches urls of corresponding upstream OSS if possible.Some specific projects required more manual handling, such as those repos hosted originally with Mercurial and SVN and patch urls don't contain a git commit ID.

Considering SAST queries/rules make a step further towards finding similar vulnerabilities, we are more than careful in opening source the whole storage of our rules. Rules of only a part of target OSSs are made public, and some of them were generated by a former version of patch2ql. A relatively complete list contain extra repos in private as follows:

    - bluez
    - brotli
    - c-ares
    - ceph
    - cjson
    - clamav
    - cmark
    - coturn
    - cups
    - curl
    - dpdk
    - expat
    - ffmpeg
    - file
    - flac
    - freeradius
    - freerdp
    - git
    - gpac
    - graphicsmagick
    - h2o
    - haproxy
    - hiredis
    - htslib
    - http-parser
    - imagemagick
    - jbig2dec
    - json-c
    - krb5
    - lcms
    - libarchive
    - libass
    - libavif
    - libbpf
    - libexif
    - libgit2
    - libjpeg-turbo
    - libmodbus
    - libpcap
    - libplist
    - libpng
    - libsndfile
    - libssh2
    - libtpms
    - libvpx
    - libxml2
    - libxslt
    - libyang
    - libzip
    - lighttpd
    - lldpd
    - lxc
    - lz4
    - mbedtls
    - mosquitto
    - nanopb
    - ndpi
    - neomutt
    - nghttp2
    - nodejs
    - openjpeg
    - opensc
    - opensips
    - openssh
    - openssl
    - openvpn
    - openvswitch
    - opusfile
    - p11-kit
    - pidgin
    - qemu
    - samba
    - sleuthkit
    - strongswan
    - systemd
    - tarantool
    - tidy-html5
    - tor
    - tpm2-tss
    - unbound
    - uriparser
    - util-linux
    - varnish
    - vim
    - wavpack
    - wireshark
    - wolfssl
    - xrdp
    - yara
    - zlib

Right now we welcome the maintainers of these OSS to contact us requiring its rules. The complete set of rules will be made public once we determine that it may not greatly lower the security level of the whole OSS domain.

## Contact

Technical representations and explanations are still on their way. To exchange ideas, feel free to contact the [maintainer](mailto:forward.wfw@hotmail.com). Any suggestions or collaborations are welcomed.
