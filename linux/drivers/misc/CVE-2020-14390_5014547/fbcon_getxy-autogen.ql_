/**
 * @name linux-50145474f6ef4a9c19205b173da6264a644c7489-fbcon_getxy
 * @id cpp/linux/50145474f6ef4a9c19205b173da6264a644c7489/fbcon-getxy
 * @description linux-50145474f6ef4a9c19205b173da6264a644c7489-drivers/video/fbdev/core/fbcon.c-fbcon_getxy CVE-2020-14390
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vvc_2806, Variable vret_2809, PointerFieldAccess target_0) {
	target_0.getTarget().getName()="vc_origin"
	and target_0.getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_0.getParent().(AssignExpr).getRValue() = target_0
	and target_0.getParent().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_2809
}

predicate func_1(Parameter vvc_2806, Variable vret_2809, Variable vx_2810, Variable vy_2810, LogicalAndExpr target_12, BlockStmt target_1) {
	target_1.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vx_2810
	and target_1.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(AssignExpr).getLValue().(VariableAccess).getTarget()=vy_2810
	and target_1.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(AssignExpr).getRValue().(Literal).getValue()="0"
	and target_1.getStmt(1).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_2809
	and target_1.getStmt(1).(ExprStmt).getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getTarget().getName()="vc_origin"
	and target_1.getStmt(1).(ExprStmt).getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_1.getParent().(IfStmt).getParent().(IfStmt).getCondition()=target_12
}

predicate func_2(Parameter vvc_2806, Variable vy_2810, Variable vfg_console, Variable vsoftback_lines, LogicalAndExpr target_12, IfStmt target_2) {
	target_2.getCondition().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getTarget().getName()="vc_num"
	and target_2.getCondition().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_2.getCondition().(EqualityOperation).getRightOperand().(VariableAccess).getTarget()=vfg_console
	and target_2.getThen().(ExprStmt).getExpr().(AssignAddExpr).getLValue().(VariableAccess).getTarget()=vy_2810
	and target_2.getThen().(ExprStmt).getExpr().(AssignAddExpr).getRValue().(VariableAccess).getTarget()=vsoftback_lines
	and target_2.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_12
}

predicate func_3(Parameter vvc_2806, Parameter vpos_2806, Variable vret_2809, Variable vx_2810, Variable vy_2810, Variable vfg_console, Variable vsoftback_lines, Variable voffset_2821, Variable vsoftback_curr, Variable vsoftback_end, Variable vsoftback_buf, Variable vsoftback_in, LogicalAndExpr target_12, IfStmt target_3) {
	target_3.getCondition().(LogicalAndExpr).getLeftOperand().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getTarget().getName()="vc_num"
	and target_3.getCondition().(LogicalAndExpr).getLeftOperand().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_3.getCondition().(LogicalAndExpr).getLeftOperand().(EqualityOperation).getRightOperand().(VariableAccess).getTarget()=vfg_console
	and target_3.getCondition().(LogicalAndExpr).getRightOperand().(VariableAccess).getTarget()=vsoftback_lines
	and target_3.getThen().(BlockStmt).getStmt(1).(IfStmt).getCondition().(RelationalOperation).getLesserOperand().(VariableAccess).getTarget()=vpos_2806
	and target_3.getThen().(BlockStmt).getStmt(1).(IfStmt).getCondition().(RelationalOperation).getGreaterOperand().(VariableAccess).getTarget()=vsoftback_curr
	and target_3.getThen().(BlockStmt).getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(AssignAddExpr).getLValue().(VariableAccess).getTarget()=voffset_2821
	and target_3.getThen().(BlockStmt).getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(AssignAddExpr).getRValue().(SubExpr).getLeftOperand().(VariableAccess).getTarget()=vsoftback_end
	and target_3.getThen().(BlockStmt).getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(AssignAddExpr).getRValue().(SubExpr).getRightOperand().(VariableAccess).getTarget()=vsoftback_buf
	and target_3.getThen().(BlockStmt).getStmt(2).(ExprStmt).getExpr().(AssignDivExpr).getLValue().(VariableAccess).getTarget()=voffset_2821
	and target_3.getThen().(BlockStmt).getStmt(2).(ExprStmt).getExpr().(AssignDivExpr).getRValue().(Literal).getValue()="2"
	and target_3.getThen().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vx_2810
	and target_3.getThen().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(AssignExpr).getRValue().(RemExpr).getLeftOperand().(VariableAccess).getTarget()=voffset_2821
	and target_3.getThen().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(AssignExpr).getRValue().(RemExpr).getRightOperand().(PointerFieldAccess).getTarget().getName()="vc_cols"
	and target_3.getThen().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(AssignExpr).getRValue().(RemExpr).getRightOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_3.getThen().(BlockStmt).getStmt(4).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vy_2810
	and target_3.getThen().(BlockStmt).getStmt(4).(ExprStmt).getExpr().(AssignExpr).getRValue().(DivExpr).getLeftOperand().(VariableAccess).getTarget()=voffset_2821
	and target_3.getThen().(BlockStmt).getStmt(4).(ExprStmt).getExpr().(AssignExpr).getRValue().(DivExpr).getRightOperand().(PointerFieldAccess).getTarget().getName()="vc_cols"
	and target_3.getThen().(BlockStmt).getStmt(4).(ExprStmt).getExpr().(AssignExpr).getRValue().(DivExpr).getRightOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_3.getThen().(BlockStmt).getStmt(5).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_2809
	and target_3.getThen().(BlockStmt).getStmt(5).(ExprStmt).getExpr().(AssignExpr).getRValue().(AddExpr).getLeftOperand().(VariableAccess).getTarget()=vpos_2806
	and target_3.getThen().(BlockStmt).getStmt(5).(ExprStmt).getExpr().(AssignExpr).getRValue().(AddExpr).getRightOperand().(MulExpr).getRightOperand().(Literal).getValue()="2"
	and target_3.getThen().(BlockStmt).getStmt(6).(IfStmt).getCondition().(EqualityOperation).getLeftOperand().(VariableAccess).getTarget()=vret_2809
	and target_3.getThen().(BlockStmt).getStmt(6).(IfStmt).getCondition().(EqualityOperation).getRightOperand().(VariableAccess).getTarget()=vsoftback_end
	and target_3.getThen().(BlockStmt).getStmt(6).(IfStmt).getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_2809
	and target_3.getThen().(BlockStmt).getStmt(6).(IfStmt).getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(VariableAccess).getTarget()=vsoftback_buf
	and target_3.getThen().(BlockStmt).getStmt(7).(IfStmt).getCondition().(EqualityOperation).getLeftOperand().(VariableAccess).getTarget()=vret_2809
	and target_3.getThen().(BlockStmt).getStmt(7).(IfStmt).getCondition().(EqualityOperation).getRightOperand().(VariableAccess).getTarget()=vsoftback_in
	and target_3.getThen().(BlockStmt).getStmt(7).(IfStmt).getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_2809
	and target_3.getThen().(BlockStmt).getStmt(7).(IfStmt).getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getTarget().getName()="vc_origin"
	and target_3.getThen().(BlockStmt).getStmt(7).(IfStmt).getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_3.getElse() instanceof BlockStmt
	and target_3.getParent().(IfStmt).getCondition()=target_12
}

predicate func_4(LogicalAndExpr target_13, Function func, DeclStmt target_4) {
	target_4.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_13
	and target_4.getEnclosingFunction() = func
}

/*predicate func_5(Parameter vpos_2806, Variable voffset_2821, Variable vsoftback_curr, Variable vsoftback_end, Variable vsoftback_buf, LogicalAndExpr target_13, IfStmt target_5) {
	target_5.getCondition().(RelationalOperation).getLesserOperand().(VariableAccess).getTarget()=vpos_2806
	and target_5.getCondition().(RelationalOperation).getGreaterOperand().(VariableAccess).getTarget()=vsoftback_curr
	and target_5.getThen().(ExprStmt).getExpr().(AssignAddExpr).getLValue().(VariableAccess).getTarget()=voffset_2821
	and target_5.getThen().(ExprStmt).getExpr().(AssignAddExpr).getRValue().(SubExpr).getLeftOperand().(VariableAccess).getTarget()=vsoftback_end
	and target_5.getThen().(ExprStmt).getExpr().(AssignAddExpr).getRValue().(SubExpr).getRightOperand().(VariableAccess).getTarget()=vsoftback_buf
	and target_5.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_13
}

*/
predicate func_6(Variable voffset_2821, LogicalAndExpr target_13, ExprStmt target_6) {
	target_6.getExpr().(AssignDivExpr).getLValue().(VariableAccess).getTarget()=voffset_2821
	and target_6.getExpr().(AssignDivExpr).getRValue().(Literal).getValue()="2"
	and target_6.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_13
}

/*predicate func_7(Parameter vvc_2806, Variable vx_2810, Variable voffset_2821, LogicalAndExpr target_13, ExprStmt target_8, ExprStmt target_14, ExprStmt target_9, ExprStmt target_6, ExprStmt target_7) {
	target_7.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vx_2810
	and target_7.getExpr().(AssignExpr).getRValue().(RemExpr).getLeftOperand().(VariableAccess).getTarget()=voffset_2821
	and target_7.getExpr().(AssignExpr).getRValue().(RemExpr).getRightOperand().(PointerFieldAccess).getTarget().getName()="vc_cols"
	and target_7.getExpr().(AssignExpr).getRValue().(RemExpr).getRightOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_7.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_13
	and target_7.getExpr().(AssignExpr).getRValue().(RemExpr).getRightOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_8.getExpr().(AssignExpr).getRValue().(DivExpr).getRightOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
	and target_14.getExpr().(AssignExpr).getRValue().(AddExpr).getRightOperand().(MulExpr).getLeftOperand().(SubExpr).getRightOperand().(VariableAccess).getLocation().isBefore(target_7.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation())
	and target_7.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_9.getExpr().(AssignExpr).getRValue().(AddExpr).getRightOperand().(MulExpr).getLeftOperand().(SubExpr).getRightOperand().(VariableAccess).getLocation())
	and target_6.getExpr().(AssignDivExpr).getLValue().(VariableAccess).getLocation().isBefore(target_7.getExpr().(AssignExpr).getRValue().(RemExpr).getLeftOperand().(VariableAccess).getLocation())
}

*/
predicate func_8(Parameter vvc_2806, Variable vy_2810, Variable voffset_2821, LogicalAndExpr target_13, ExprStmt target_8) {
	target_8.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vy_2810
	and target_8.getExpr().(AssignExpr).getRValue().(DivExpr).getLeftOperand().(VariableAccess).getTarget()=voffset_2821
	and target_8.getExpr().(AssignExpr).getRValue().(DivExpr).getRightOperand().(PointerFieldAccess).getTarget().getName()="vc_cols"
	and target_8.getExpr().(AssignExpr).getRValue().(DivExpr).getRightOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_8.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_13
}

predicate func_9(Parameter vvc_2806, Parameter vpos_2806, Variable vret_2809, Variable vx_2810, LogicalAndExpr target_13, ExprStmt target_9) {
	target_9.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_2809
	and target_9.getExpr().(AssignExpr).getRValue().(AddExpr).getLeftOperand().(VariableAccess).getTarget()=vpos_2806
	and target_9.getExpr().(AssignExpr).getRValue().(AddExpr).getRightOperand().(MulExpr).getLeftOperand().(SubExpr).getLeftOperand().(PointerFieldAccess).getTarget().getName()="vc_cols"
	and target_9.getExpr().(AssignExpr).getRValue().(AddExpr).getRightOperand().(MulExpr).getLeftOperand().(SubExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_9.getExpr().(AssignExpr).getRValue().(AddExpr).getRightOperand().(MulExpr).getLeftOperand().(SubExpr).getRightOperand().(VariableAccess).getTarget()=vx_2810
	and target_9.getExpr().(AssignExpr).getRValue().(AddExpr).getRightOperand().(MulExpr).getRightOperand().(Literal).getValue()="2"
	and target_9.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_13
}

/*predicate func_10(Variable vret_2809, Variable vsoftback_end, Variable vsoftback_buf, LogicalAndExpr target_13, IfStmt target_10) {
	target_10.getCondition().(EqualityOperation).getLeftOperand().(VariableAccess).getTarget()=vret_2809
	and target_10.getCondition().(EqualityOperation).getRightOperand().(VariableAccess).getTarget()=vsoftback_end
	and target_10.getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_2809
	and target_10.getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(VariableAccess).getTarget()=vsoftback_buf
	and target_10.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_13
}

*/
/*predicate func_11(Parameter vvc_2806, Variable vret_2809, Variable vsoftback_in, LogicalAndExpr target_13, IfStmt target_11) {
	target_11.getCondition().(EqualityOperation).getLeftOperand().(VariableAccess).getTarget()=vret_2809
	and target_11.getCondition().(EqualityOperation).getRightOperand().(VariableAccess).getTarget()=vsoftback_in
	and target_11.getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_2809
	and target_11.getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getTarget().getName()="vc_origin"
	and target_11.getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_11.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_13
}

*/
predicate func_12(Parameter vvc_2806, Parameter vpos_2806, LogicalAndExpr target_12) {
	target_12.getLeftOperand().(RelationalOperation).getGreaterOperand().(VariableAccess).getTarget()=vpos_2806
	and target_12.getLeftOperand().(RelationalOperation).getLesserOperand().(PointerFieldAccess).getTarget().getName()="vc_origin"
	and target_12.getLeftOperand().(RelationalOperation).getLesserOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_12.getRightOperand().(RelationalOperation).getLesserOperand().(VariableAccess).getTarget()=vpos_2806
	and target_12.getRightOperand().(RelationalOperation).getGreaterOperand().(PointerFieldAccess).getTarget().getName()="vc_scr_end"
	and target_12.getRightOperand().(RelationalOperation).getGreaterOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
}

predicate func_13(Variable vsoftback_lines, LogicalAndExpr target_13) {
	target_13.getLeftOperand() instanceof EqualityOperation
	and target_13.getRightOperand().(VariableAccess).getTarget()=vsoftback_lines
}

predicate func_14(Parameter vvc_2806, Parameter vpos_2806, Variable vret_2809, Variable vx_2810, LogicalAndExpr target_12, ExprStmt target_14) {
	target_14.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_2809
	and target_14.getExpr().(AssignExpr).getRValue().(AddExpr).getLeftOperand().(VariableAccess).getTarget()=vpos_2806
	and target_14.getExpr().(AssignExpr).getRValue().(AddExpr).getRightOperand().(MulExpr).getLeftOperand().(SubExpr).getLeftOperand().(PointerFieldAccess).getTarget().getName()="vc_cols"
	and target_14.getExpr().(AssignExpr).getRValue().(AddExpr).getRightOperand().(MulExpr).getLeftOperand().(SubExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2806
	and target_14.getExpr().(AssignExpr).getRValue().(AddExpr).getRightOperand().(MulExpr).getLeftOperand().(SubExpr).getRightOperand().(VariableAccess).getTarget()=vx_2810
	and target_14.getExpr().(AssignExpr).getRValue().(AddExpr).getRightOperand().(MulExpr).getRightOperand().(Literal).getValue()="2"
	and target_14.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_12
}

from Function func, Parameter vvc_2806, Parameter vpos_2806, Variable vret_2809, Variable vx_2810, Variable vy_2810, Variable vfg_console, Variable vsoftback_lines, Variable voffset_2821, Variable vsoftback_curr, Variable vsoftback_end, Variable vsoftback_buf, Variable vsoftback_in, PointerFieldAccess target_0, BlockStmt target_1, IfStmt target_2, IfStmt target_3, DeclStmt target_4, ExprStmt target_6, ExprStmt target_8, ExprStmt target_9, LogicalAndExpr target_12, LogicalAndExpr target_13, ExprStmt target_14
where
func_0(vvc_2806, vret_2809, target_0)
and func_1(vvc_2806, vret_2809, vx_2810, vy_2810, target_12, target_1)
and func_2(vvc_2806, vy_2810, vfg_console, vsoftback_lines, target_12, target_2)
and func_3(vvc_2806, vpos_2806, vret_2809, vx_2810, vy_2810, vfg_console, vsoftback_lines, voffset_2821, vsoftback_curr, vsoftback_end, vsoftback_buf, vsoftback_in, target_12, target_3)
and func_4(target_13, func, target_4)
and func_6(voffset_2821, target_13, target_6)
and func_8(vvc_2806, vy_2810, voffset_2821, target_13, target_8)
and func_9(vvc_2806, vpos_2806, vret_2809, vx_2810, target_13, target_9)
and func_12(vvc_2806, vpos_2806, target_12)
and func_13(vsoftback_lines, target_13)
and func_14(vvc_2806, vpos_2806, vret_2809, vx_2810, target_12, target_14)
and vvc_2806.getType().hasName("vc_data *")
and vpos_2806.getType().hasName("unsigned long")
and vret_2809.getType().hasName("unsigned long")
and vx_2810.getType().hasName("int")
and vy_2810.getType().hasName("int")
and vfg_console.getType().hasName("int")
and vsoftback_lines.getType().hasName("int")
and voffset_2821.getType().hasName("unsigned long")
and vsoftback_curr.getType().hasName("unsigned long")
and vsoftback_end.getType().hasName("unsigned long")
and vsoftback_buf.getType().hasName("unsigned long")
and vsoftback_in.getType().hasName("unsigned long")
and vvc_2806.getFunction() = func
and vpos_2806.getFunction() = func
and vret_2809.(LocalVariable).getFunction() = func
and vx_2810.(LocalVariable).getFunction() = func
and vy_2810.(LocalVariable).getFunction() = func
and not vfg_console.getParentScope+() = func
and not vsoftback_lines.getParentScope+() = func
and voffset_2821.(LocalVariable).getFunction() = func
and not vsoftback_curr.getParentScope+() = func
and not vsoftback_end.getParentScope+() = func
and not vsoftback_buf.getParentScope+() = func
and not vsoftback_in.getParentScope+() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
