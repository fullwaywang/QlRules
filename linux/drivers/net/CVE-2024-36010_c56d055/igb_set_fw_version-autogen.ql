/**
 * @name linux-c56d055893cbe97848611855d1c97d0ab171eccc-igb_set_fw_version
 * @id cpp/linux/c56d055893cbe97848611855d1c97d0ab171eccc/igb-set-fw-version
 * @description linux-c56d055893cbe97848611855d1c97d0ab171eccc-drivers/net/ethernet/intel/igb/igb_main.c-igb_set_fw_version CVE-2024-36010
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func, SizeofExprOperator target_0) {
	target_0.getValue()="32"
	and target_0.getEnclosingFunction() = func
}

predicate func_1(Parameter vadapter_3068) {
exists(FunctionCall target_1 |
	target_1.getTarget().hasName("snprintf")
	and target_1.getArgument(0).(PointerFieldAccess).getTarget().getName()="fw_version"
	and target_1.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vadapter_3068
	and target_1.getArgument(1).(SizeofExprOperator).getValue()="48"
	and target_1.getArgument(2) instanceof StringLiteral
	and target_1.getArgument(3) instanceof ValueFieldAccess
	and target_1.getArgument(4) instanceof ValueFieldAccess
	and target_1.getArgument(5) instanceof ValueFieldAccess)
}

predicate func_2(Parameter vadapter_3068, AddressOfExpr target_32) {
exists(FunctionCall target_2 |
	target_2.getTarget().hasName("snprintf")
	and target_2.getArgument(0).(PointerFieldAccess).getTarget().getName()="fw_version"
	and target_2.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vadapter_3068
	and target_2.getArgument(1).(SizeofExprOperator).getValue()="48"
	and target_2.getArgument(2) instanceof StringLiteral
	and target_2.getArgument(3) instanceof ValueFieldAccess
	and target_2.getArgument(4) instanceof ValueFieldAccess
	and target_2.getArgument(5) instanceof ValueFieldAccess
	and target_2.getArgument(6) instanceof ValueFieldAccess
	and target_2.getArgument(7) instanceof ValueFieldAccess
	and target_2.getArgument(8) instanceof ValueFieldAccess
	and target_32.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_2.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation()))
}

predicate func_3(Parameter vadapter_3068) {
exists(FunctionCall target_3 |
	target_3.getTarget().hasName("snprintf")
	and target_3.getArgument(0).(PointerFieldAccess).getTarget().getName()="fw_version"
	and target_3.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vadapter_3068
	and target_3.getArgument(1).(SizeofExprOperator).getValue()="48"
	and target_3.getArgument(2) instanceof StringLiteral
	and target_3.getArgument(3) instanceof ValueFieldAccess
	and target_3.getArgument(4) instanceof ValueFieldAccess
	and target_3.getArgument(5) instanceof ValueFieldAccess)
}

predicate func_4(Parameter vadapter_3068) {
exists(FunctionCall target_4 |
	target_4.getTarget().hasName("snprintf")
	and target_4.getArgument(0).(PointerFieldAccess).getTarget().getName()="fw_version"
	and target_4.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vadapter_3068
	and target_4.getArgument(1).(SizeofExprOperator).getValue()="48"
	and target_4.getArgument(2) instanceof StringLiteral
	and target_4.getArgument(3) instanceof ValueFieldAccess
	and target_4.getArgument(4) instanceof ValueFieldAccess
	and target_4.getArgument(5) instanceof ValueFieldAccess)
}

predicate func_5(Variable vfw_3071, ValueFieldAccess target_5) {
	target_5.getTarget().getName()="invm_major"
	and target_5.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_6(Variable vfw_3071, ValueFieldAccess target_6) {
	target_6.getTarget().getName()="invm_minor"
	and target_6.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_7(Variable vfw_3071, ValueFieldAccess target_7) {
	target_7.getTarget().getName()="invm_img_type"
	and target_7.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_8(Variable vfw_3071, ValueFieldAccess target_8) {
	target_8.getTarget().getName()="eep_major"
	and target_8.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_9(Variable vfw_3071, ValueFieldAccess target_9) {
	target_9.getTarget().getName()="eep_minor"
	and target_9.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_10(Variable vfw_3071, ValueFieldAccess target_10) {
	target_10.getTarget().getName()="etrack_id"
	and target_10.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_11(Variable vfw_3071, ValueFieldAccess target_11) {
	target_11.getTarget().getName()="or_major"
	and target_11.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_12(Variable vfw_3071, ValueFieldAccess target_12) {
	target_12.getTarget().getName()="or_build"
	and target_12.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_13(Variable vfw_3071, ValueFieldAccess target_13) {
	target_13.getTarget().getName()="or_patch"
	and target_13.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_14(Variable vfw_3071, ValueFieldAccess target_14) {
	target_14.getTarget().getName()="eep_major"
	and target_14.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_15(Variable vfw_3071, ValueFieldAccess target_15) {
	target_15.getTarget().getName()="eep_minor"
	and target_15.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_16(Variable vfw_3071, ValueFieldAccess target_16) {
	target_16.getTarget().getName()="etrack_id"
	and target_16.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_17(Variable vfw_3071, ValueFieldAccess target_17) {
	target_17.getTarget().getName()="eep_major"
	and target_17.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_18(Variable vfw_3071, ValueFieldAccess target_18) {
	target_18.getTarget().getName()="eep_minor"
	and target_18.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_19(Variable vfw_3071, ValueFieldAccess target_19) {
	target_19.getTarget().getName()="eep_build"
	and target_19.getQualifier().(VariableAccess).getTarget()=vfw_3071
}

predicate func_20(Parameter vadapter_3068, PointerFieldAccess target_20) {
	target_20.getTarget().getName()="fw_version"
	and target_20.getQualifier().(VariableAccess).getTarget()=vadapter_3068
	and target_20.getParent().(FunctionCall).getParent().(ExprStmt).getExpr() instanceof FunctionCall
}

predicate func_25(Function func, DeclStmt target_25) {
	func.getEntryPoint().(BlockStmt).getAStmt()=target_25
}

predicate func_26(Variable vlbuf_3072, AssignExpr target_26) {
	target_26.getLValue().(VariableAccess).getTarget()=vlbuf_3072
	and target_26.getRValue().(FunctionCall).getTarget().hasName("kasprintf")
	and target_26.getRValue().(FunctionCall).getArgument(0).(BitwiseOrExpr).getValue()="3264"
	and target_26.getRValue().(FunctionCall).getArgument(1) instanceof StringLiteral
	and target_26.getRValue().(FunctionCall).getArgument(2) instanceof ValueFieldAccess
	and target_26.getRValue().(FunctionCall).getArgument(3) instanceof ValueFieldAccess
	and target_26.getRValue().(FunctionCall).getArgument(4) instanceof ValueFieldAccess
}

predicate func_27(Variable vlbuf_3072, AssignExpr target_27) {
	target_27.getLValue().(VariableAccess).getTarget()=vlbuf_3072
	and target_27.getRValue().(FunctionCall).getTarget().hasName("kasprintf")
	and target_27.getRValue().(FunctionCall).getArgument(0).(BitwiseOrExpr).getValue()="3264"
	and target_27.getRValue().(FunctionCall).getArgument(1) instanceof StringLiteral
	and target_27.getRValue().(FunctionCall).getArgument(2) instanceof ValueFieldAccess
	and target_27.getRValue().(FunctionCall).getArgument(3) instanceof ValueFieldAccess
	and target_27.getRValue().(FunctionCall).getArgument(4) instanceof ValueFieldAccess
	and target_27.getRValue().(FunctionCall).getArgument(5) instanceof ValueFieldAccess
	and target_27.getRValue().(FunctionCall).getArgument(6) instanceof ValueFieldAccess
	and target_27.getRValue().(FunctionCall).getArgument(7) instanceof ValueFieldAccess
}

predicate func_28(Variable vlbuf_3072, AssignExpr target_28) {
	target_28.getLValue().(VariableAccess).getTarget()=vlbuf_3072
	and target_28.getRValue().(FunctionCall).getTarget().hasName("kasprintf")
	and target_28.getRValue().(FunctionCall).getArgument(0).(BitwiseOrExpr).getValue()="3264"
	and target_28.getRValue().(FunctionCall).getArgument(1) instanceof StringLiteral
	and target_28.getRValue().(FunctionCall).getArgument(2) instanceof ValueFieldAccess
	and target_28.getRValue().(FunctionCall).getArgument(3) instanceof ValueFieldAccess
	and target_28.getRValue().(FunctionCall).getArgument(4) instanceof ValueFieldAccess
}

predicate func_29(Variable vlbuf_3072, AssignExpr target_29) {
	target_29.getLValue().(VariableAccess).getTarget()=vlbuf_3072
	and target_29.getRValue().(FunctionCall).getTarget().hasName("kasprintf")
	and target_29.getRValue().(FunctionCall).getArgument(0).(BitwiseOrExpr).getValue()="3264"
	and target_29.getRValue().(FunctionCall).getArgument(1) instanceof StringLiteral
	and target_29.getRValue().(FunctionCall).getArgument(2) instanceof ValueFieldAccess
	and target_29.getRValue().(FunctionCall).getArgument(3) instanceof ValueFieldAccess
	and target_29.getRValue().(FunctionCall).getArgument(4) instanceof ValueFieldAccess
}

predicate func_30(Variable vlbuf_3072, Parameter vadapter_3068, Function func, ExprStmt target_30) {
	target_30.getExpr().(FunctionCall).getTarget().hasName("strscpy")
	and target_30.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="fw_version"
	and target_30.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vadapter_3068
	and target_30.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vlbuf_3072
	and target_30.getExpr().(FunctionCall).getArgument(2) instanceof SizeofExprOperator
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_30
}

predicate func_31(Variable vlbuf_3072, Function func, ExprStmt target_31) {
	target_31.getExpr().(FunctionCall).getTarget().hasName("kfree")
	and target_31.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vlbuf_3072
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_31
}

predicate func_32(Parameter vadapter_3068, AddressOfExpr target_32) {
	target_32.getOperand().(PointerFieldAccess).getTarget().getName()="hw"
	and target_32.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vadapter_3068
}

from Function func, Variable vfw_3071, Variable vlbuf_3072, Parameter vadapter_3068, SizeofExprOperator target_0, ValueFieldAccess target_5, ValueFieldAccess target_6, ValueFieldAccess target_7, ValueFieldAccess target_8, ValueFieldAccess target_9, ValueFieldAccess target_10, ValueFieldAccess target_11, ValueFieldAccess target_12, ValueFieldAccess target_13, ValueFieldAccess target_14, ValueFieldAccess target_15, ValueFieldAccess target_16, ValueFieldAccess target_17, ValueFieldAccess target_18, ValueFieldAccess target_19, PointerFieldAccess target_20, DeclStmt target_25, AssignExpr target_26, AssignExpr target_27, AssignExpr target_28, AssignExpr target_29, ExprStmt target_30, ExprStmt target_31, AddressOfExpr target_32
where
func_0(func, target_0)
and not func_1(vadapter_3068)
and not func_2(vadapter_3068, target_32)
and not func_3(vadapter_3068)
and not func_4(vadapter_3068)
and func_5(vfw_3071, target_5)
and func_6(vfw_3071, target_6)
and func_7(vfw_3071, target_7)
and func_8(vfw_3071, target_8)
and func_9(vfw_3071, target_9)
and func_10(vfw_3071, target_10)
and func_11(vfw_3071, target_11)
and func_12(vfw_3071, target_12)
and func_13(vfw_3071, target_13)
and func_14(vfw_3071, target_14)
and func_15(vfw_3071, target_15)
and func_16(vfw_3071, target_16)
and func_17(vfw_3071, target_17)
and func_18(vfw_3071, target_18)
and func_19(vfw_3071, target_19)
and func_20(vadapter_3068, target_20)
and func_25(func, target_25)
and func_26(vlbuf_3072, target_26)
and func_27(vlbuf_3072, target_27)
and func_28(vlbuf_3072, target_28)
and func_29(vlbuf_3072, target_29)
and func_30(vlbuf_3072, vadapter_3068, func, target_30)
and func_31(vlbuf_3072, func, target_31)
and func_32(vadapter_3068, target_32)
and vfw_3071.getType().hasName("e1000_fw_version")
and vlbuf_3072.getType().hasName("char *")
and vadapter_3068.getType().hasName("igb_adapter *")
and vfw_3071.(LocalVariable).getFunction() = func
and vlbuf_3072.(LocalVariable).getFunction() = func
and vadapter_3068.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
