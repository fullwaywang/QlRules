/**
 * @name linux-4e085e76cbe558b79b54cbab772f61185879bc64-aun_incoming
 * @id cpp/linux/4e085e76cbe558b79b54cbab772f61185879bc64/aun-incoming
 * @description linux-4e085e76cbe558b79b54cbab772f61185879bc64-net/econet/af_econet.c-aun_incoming CVE-2010-4342
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_2(Variable vedev_856, NotExpr target_6, Function func) {
	exists(IfStmt target_2 |
		target_2.getCondition().(VariableAccess).getType().hasName("dst_entry *")
		and target_2.getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vedev_856
		and target_2.getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getTarget().getName()="ec_ptr"
		and target_2.getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="dev"
		and target_2.getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("dst_entry *")
		and func.getEntryPoint().(BlockStmt).getAStmt()=target_2
		and target_2.getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_6.getOperand().(VariableAccess).getLocation()))
}

predicate func_4(Parameter vskb_850, VariableAccess target_4) {
		target_4.getTarget()=vskb_850
}

predicate func_6(Variable vedev_856, NotExpr target_6) {
		target_6.getOperand().(VariableAccess).getTarget()=vedev_856
}

from Function func, Variable vedev_856, Parameter vskb_850, VariableAccess target_4, NotExpr target_6
where
not func_2(vedev_856, target_6, func)
and func_4(vskb_850, target_4)
and func_6(vedev_856, target_6)
and vedev_856.getType().hasName("ec_device *")
and vskb_850.getType().hasName("sk_buff *")
and vedev_856.(LocalVariable).getFunction() = func
and vskb_850.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
