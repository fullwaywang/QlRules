/**
 * @name linux-b2a4df200d570b2c33a57e1ebfa5896e4bc81b69-construct_alloc_key
 * @id cpp/linux/b2a4df200d570b2c33a57e1ebfa5896e4bc81b69/construct-alloc-key
 * @description linux-b2a4df200d570b2c33a57e1ebfa5896e4bc81b69-security/keys/request_key.c-construct_alloc_key CVE-2014-3631
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_1(Parameter vdest_keyring_349) {
	exists(AddressOfExpr target_1 |
		target_1.getOperand().(VariableAccess).getType().hasName("assoc_array_edit *")
		and target_1.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("__key_link_begin")
		and target_1.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_1.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="index_key"
		and target_1.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("keyring_search_context *")
		and target_1.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(2) instanceof AddressOfExpr)
}

predicate func_2(Parameter vdest_keyring_349) {
	exists(AddressOfExpr target_2 |
		target_2.getOperand().(VariableAccess).getType().hasName("assoc_array_edit *")
		and target_2.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link")
		and target_2.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_2.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_2.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2) instanceof AddressOfExpr)
}

predicate func_4(Parameter vdest_keyring_349) {
	exists(AddressOfExpr target_4 |
		target_4.getOperand().(VariableAccess).getType().hasName("assoc_array_edit *")
		and target_4.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link")
		and target_4.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_4.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_4.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2) instanceof AddressOfExpr)
}

predicate func_6(Parameter vdest_keyring_349, VariableAccess target_6) {
		target_6.getTarget()=vdest_keyring_349
		and target_6.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link")
		and target_6.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_6.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2) instanceof AddressOfExpr
}

predicate func_7(Variable vprealloc_354, Parameter vdest_keyring_349, VariableAccess target_7) {
		target_7.getTarget()=vdest_keyring_349
		and target_7.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link_end")
		and target_7.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="index_key"
		and target_7.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("keyring_search_context *")
		and target_7.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget()=vprealloc_354
}

predicate func_9(Variable vprealloc_354, Parameter vdest_keyring_349, AddressOfExpr target_10, IfStmt target_17, IfStmt target_18, AddressOfExpr target_9) {
		target_9.getOperand().(VariableAccess).getTarget()=vprealloc_354
		and target_9.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("__key_link_begin")
		and target_9.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_9.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="index_key"
		and target_9.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("keyring_search_context *")
		and target_9.getOperand().(VariableAccess).getLocation().isBefore(target_10.getOperand().(VariableAccess).getLocation())
		and target_17.getCondition().(VariableAccess).getLocation().isBefore(target_9.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_9.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_18.getCondition().(VariableAccess).getLocation())
}

predicate func_10(Variable vprealloc_354, Parameter vdest_keyring_349, AddressOfExpr target_9, ExprStmt target_19, IfStmt target_18, IfStmt target_20, AddressOfExpr target_10) {
		target_10.getOperand().(VariableAccess).getTarget()=vprealloc_354
		and target_10.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link")
		and target_10.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_10.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_9.getOperand().(VariableAccess).getLocation().isBefore(target_10.getOperand().(VariableAccess).getLocation())
		and target_10.getOperand().(VariableAccess).getLocation().isBefore(target_19.getExpr().(FunctionCall).getArgument(2).(VariableAccess).getLocation())
		and target_18.getCondition().(VariableAccess).getLocation().isBefore(target_10.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_10.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_20.getCondition().(VariableAccess).getLocation())
}

predicate func_11(Variable vprealloc_354, Parameter vdest_keyring_349, AddressOfExpr target_10, AddressOfExpr target_13, IfStmt target_20, IfStmt target_21, VariableAccess target_11) {
		target_11.getTarget()=vprealloc_354
		and target_11.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link_end")
		and target_11.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_11.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="index_key"
		and target_11.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("keyring_search_context *")
		and target_10.getOperand().(VariableAccess).getLocation().isBefore(target_11.getLocation())
		and target_11.getLocation().isBefore(target_13.getOperand().(VariableAccess).getLocation())
		and target_20.getCondition().(VariableAccess).getLocation().isBefore(target_11.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_11.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_21.getCondition().(VariableAccess).getLocation())
}

predicate func_12(Variable vprealloc_354, Parameter vdest_keyring_349, ExprStmt target_19, ExprStmt target_22, ExprStmt target_23, VariableAccess target_12) {
		target_12.getTarget()=vdest_keyring_349
		and target_12.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link")
		and target_12.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_12.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(AddressOfExpr).getOperand().(VariableAccess).getTarget()=vprealloc_354
		and target_19.getExpr().(FunctionCall).getArgument(2).(VariableAccess).getLocation().isBefore(target_12.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(AddressOfExpr).getOperand().(VariableAccess).getLocation())
		and target_12.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(AddressOfExpr).getOperand().(VariableAccess).getLocation().isBefore(target_22.getExpr().(FunctionCall).getArgument(2).(VariableAccess).getLocation())
		and target_23.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_12.getLocation())
}

predicate func_13(Variable vprealloc_354, Parameter vdest_keyring_349, ExprStmt target_19, ExprStmt target_22, ExprStmt target_23, AddressOfExpr target_13) {
		target_13.getOperand().(VariableAccess).getTarget()=vprealloc_354
		and target_13.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link")
		and target_13.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_13.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_19.getExpr().(FunctionCall).getArgument(2).(VariableAccess).getLocation().isBefore(target_13.getOperand().(VariableAccess).getLocation())
		and target_13.getOperand().(VariableAccess).getLocation().isBefore(target_22.getExpr().(FunctionCall).getArgument(2).(VariableAccess).getLocation())
		and target_23.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_13.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_14(Variable vprealloc_354, Parameter vdest_keyring_349, AddressOfExpr target_13, ExprStmt target_24, VariableAccess target_14) {
		target_14.getTarget()=vdest_keyring_349
		and target_14.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link_end")
		and target_14.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="index_key"
		and target_14.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("keyring_search_context *")
		and target_14.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget()=vprealloc_354
		and target_13.getOperand().(VariableAccess).getLocation().isBefore(target_14.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getLocation())
		and target_24.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_14.getLocation())
}

/*predicate func_15(Variable vprealloc_354, Parameter vdest_keyring_349, AddressOfExpr target_13, ExprStmt target_24, VariableAccess target_15) {
		target_15.getTarget()=vprealloc_354
		and target_15.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link_end")
		and target_15.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_15.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="index_key"
		and target_15.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("keyring_search_context *")
		and target_13.getOperand().(VariableAccess).getLocation().isBefore(target_15.getLocation())
		and target_24.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_15.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

*/
predicate func_17(Parameter vdest_keyring_349, IfStmt target_17) {
		target_17.getCondition().(VariableAccess).getTarget()=vdest_keyring_349
		and target_17.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget().getType().hasName("int")
		and target_17.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("__key_link_begin")
		and target_17.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_17.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="index_key"
		and target_17.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(2) instanceof AddressOfExpr
}

predicate func_18(Parameter vdest_keyring_349, IfStmt target_18) {
		target_18.getCondition().(VariableAccess).getTarget()=vdest_keyring_349
		and target_18.getThen().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link")
		and target_18.getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_18.getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_18.getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(2) instanceof AddressOfExpr
}

predicate func_19(Variable vprealloc_354, Parameter vdest_keyring_349, VariableAccess target_25, ExprStmt target_19) {
		target_19.getExpr().(FunctionCall).getTarget().hasName("__key_link_end")
		and target_19.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_19.getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="index_key"
		and target_19.getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("keyring_search_context *")
		and target_19.getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget()=vprealloc_354
		and target_19.getParent().(IfStmt).getCondition()=target_25
}

predicate func_20(Variable vprealloc_354, Parameter vdest_keyring_349, IfStmt target_20) {
		target_20.getCondition().(VariableAccess).getTarget()=vdest_keyring_349
		and target_20.getThen().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link_end")
		and target_20.getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_20.getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="index_key"
		and target_20.getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("keyring_search_context *")
		and target_20.getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget()=vprealloc_354
}

predicate func_21(Parameter vdest_keyring_349, IfStmt target_21) {
		target_21.getCondition().(VariableAccess).getTarget()=vdest_keyring_349
		and target_21.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget().getType().hasName("int")
		and target_21.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("__key_link_check_live_key")
		and target_21.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_21.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_21.getThen().(BlockStmt).getStmt(1).(IfStmt).getCondition().(EqualityOperation).getAnOperand().(VariableAccess).getTarget().getType().hasName("int")
		and target_21.getThen().(BlockStmt).getStmt(1).(IfStmt).getCondition().(EqualityOperation).getAnOperand().(Literal).getValue()="0"
		and target_21.getThen().(BlockStmt).getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link")
		and target_21.getThen().(BlockStmt).getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_21.getThen().(BlockStmt).getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_21.getThen().(BlockStmt).getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(2) instanceof AddressOfExpr
}

predicate func_22(Variable vprealloc_354, Parameter vdest_keyring_349, VariableAccess target_26, ExprStmt target_22) {
		target_22.getExpr().(FunctionCall).getTarget().hasName("__key_link_end")
		and target_22.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_22.getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="index_key"
		and target_22.getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("keyring_search_context *")
		and target_22.getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget()=vprealloc_354
		and target_22.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_26
}

predicate func_23(Parameter vdest_keyring_349, ExprStmt target_23) {
		target_23.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget().getType().hasName("int")
		and target_23.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("__key_link_check_live_key")
		and target_23.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_23.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
}

predicate func_24(Parameter vdest_keyring_349, EqualityOperation target_27, ExprStmt target_24) {
		target_24.getExpr().(FunctionCall).getTarget().hasName("__key_link")
		and target_24.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_24.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_24.getExpr().(FunctionCall).getArgument(2) instanceof AddressOfExpr
		and target_24.getParent().(IfStmt).getCondition()=target_27
}

predicate func_25(Parameter vdest_keyring_349, ExprStmt target_19, VariableAccess target_25) {
		target_25.getTarget()=vdest_keyring_349
		and target_25.getParent().(IfStmt).getThen()=target_19
}

predicate func_26(Parameter vdest_keyring_349, BlockStmt target_28, VariableAccess target_26) {
		target_26.getTarget()=vdest_keyring_349
		and target_26.getParent().(IfStmt).getThen()=target_28
}

predicate func_27(Function func, EqualityOperation target_27) {
		target_27.getAnOperand().(VariableAccess).getTarget().getType().hasName("int")
		and target_27.getAnOperand().(Literal).getValue()="0"
		and target_27.getEnclosingFunction() = func
}

predicate func_28(Parameter vdest_keyring_349, BlockStmt target_28) {
		target_28.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget().getType().hasName("int")
		and target_28.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("__key_link_check_live_key")
		and target_28.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_28.getStmt(0).(ExprStmt).getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_28.getStmt(1).(IfStmt).getCondition().(EqualityOperation).getAnOperand().(VariableAccess).getTarget().getType().hasName("int")
		and target_28.getStmt(1).(IfStmt).getCondition().(EqualityOperation).getAnOperand().(Literal).getValue()="0"
		and target_28.getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__key_link")
		and target_28.getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vdest_keyring_349
		and target_28.getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("key *")
		and target_28.getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(2) instanceof AddressOfExpr
}

from Function func, Variable vprealloc_354, Parameter vdest_keyring_349, VariableAccess target_6, VariableAccess target_7, AddressOfExpr target_9, AddressOfExpr target_10, VariableAccess target_11, VariableAccess target_12, AddressOfExpr target_13, VariableAccess target_14, IfStmt target_17, IfStmt target_18, ExprStmt target_19, IfStmt target_20, IfStmt target_21, ExprStmt target_22, ExprStmt target_23, ExprStmt target_24, VariableAccess target_25, VariableAccess target_26, EqualityOperation target_27, BlockStmt target_28
where
not func_1(vdest_keyring_349)
and not func_2(vdest_keyring_349)
and not func_4(vdest_keyring_349)
and func_6(vdest_keyring_349, target_6)
and func_7(vprealloc_354, vdest_keyring_349, target_7)
and func_9(vprealloc_354, vdest_keyring_349, target_10, target_17, target_18, target_9)
and func_10(vprealloc_354, vdest_keyring_349, target_9, target_19, target_18, target_20, target_10)
and func_11(vprealloc_354, vdest_keyring_349, target_10, target_13, target_20, target_21, target_11)
and func_12(vprealloc_354, vdest_keyring_349, target_19, target_22, target_23, target_12)
and func_13(vprealloc_354, vdest_keyring_349, target_19, target_22, target_23, target_13)
and func_14(vprealloc_354, vdest_keyring_349, target_13, target_24, target_14)
and func_17(vdest_keyring_349, target_17)
and func_18(vdest_keyring_349, target_18)
and func_19(vprealloc_354, vdest_keyring_349, target_25, target_19)
and func_20(vprealloc_354, vdest_keyring_349, target_20)
and func_21(vdest_keyring_349, target_21)
and func_22(vprealloc_354, vdest_keyring_349, target_26, target_22)
and func_23(vdest_keyring_349, target_23)
and func_24(vdest_keyring_349, target_27, target_24)
and func_25(vdest_keyring_349, target_19, target_25)
and func_26(vdest_keyring_349, target_28, target_26)
and func_27(func, target_27)
and func_28(vdest_keyring_349, target_28)
and vprealloc_354.getType().hasName("unsigned long")
and vdest_keyring_349.getType().hasName("key *")
and vprealloc_354.(LocalVariable).getFunction() = func
and vdest_keyring_349.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
