/**
 * @name v8-4b8d04897cba70cac45eea33d78fa2354dfe2bd7-v8__internal__Map__InobjectSlackTrackingStep_
 * @id cpp/v8/4b8d04897cba70cac45eea33d78fa2354dfe2bd7/v8internalmapinobjectslacktrackingstep
 * @description v8-4b8d04897cba70cac45eea33d78fa2354dfe2bd7-src/objects/map-updater.cc-v8__internal__Map__InobjectSlackTrackingStep_ CVE-2022-0457
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func, Literal target_0) {
	target_0.getValue()="855"
	and not target_0.getValue()="856"
	and target_0.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("V8_Dcheck")
	and target_0.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(StringLiteral).getValue()="../../src/objects/map-inl.h"
	and target_0.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(StringLiteral).getValue()="GetBackPointer().IsUndefined()"
	and target_0.getEnclosingFunction() = func
}

predicate func_1(Function func) {
exists(PointerDereferenceExpr target_1 |
	target_1.getOperand() instanceof ThisExpr
	and target_1.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("CompleteInobjectSlackTracking")
	and target_1.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getQualifier() instanceof ThisExpr
	and target_1.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("Isolate *")
	and target_1.getEnclosingFunction() = func)
}

predicate func_2(Function func, ThisExpr target_2) {
	target_2.getType() instanceof PointerType
	and target_2.getEnclosingFunction() = func
}

from Function func, Literal target_0, ThisExpr target_2
where
func_0(func, target_0)
and not func_1(func)
and func_2(func, target_2)
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
