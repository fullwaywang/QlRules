/**
 * @name linux-68faa679b8be1a74e6663c21c3a9d25d32f1c079-cdev_get
 * @id cpp/linux/68faa679b8be1a74e6663c21c3a9d25d32f1c079/cdev-get
 * @description linux-68faa679b8be1a74e6663c21c3a9d25d32f1c079-fs/char_dev.c-cdev_get CVE-2020-0305
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vp_348, FunctionCall target_0) {
		target_0.getTarget().hasName("kobject_get")
		and not target_0.getTarget().hasName("kobject_get_unless_zero")
		and target_0.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="kobj"
		and target_0.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vp_348
		and target_0.getParent().(AssignExpr).getRValue() = target_0
		and target_0.getParent().(AssignExpr).getLValue().(VariableAccess).getTarget().getType().hasName("kobject *")
}

from Function func, Parameter vp_348, FunctionCall target_0
where
func_0(vp_348, target_0)
and vp_348.getType().hasName("cdev *")
and vp_348.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
