/**
 * @name linux-876f8ab52363f649bcc74072157dfd7adfbabc0d-prp_create_tagged_frame
 * @id cpp/linux/876f8ab52363f649bcc74072157dfd7adfbabc0d/prp-create-tagged-frame
 * @description linux-876f8ab52363f649bcc74072157dfd7adfbabc0d-net/hsr/hsr_forward.c-prp_create_tagged_frame CVE-2023-52846
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vframe_323, Parameter vport_324, Variable vskb_326, FunctionCall target_0) {
	target_0.getTarget().hasName("prp_fill_rct")
	and target_0.getArgument(0).(VariableAccess).getTarget()=vskb_326
	and target_0.getArgument(1).(VariableAccess).getTarget()=vframe_323
	and target_0.getArgument(2).(VariableAccess).getTarget()=vport_324
}

predicate func_1(Function func, ExprStmt target_1) {
	target_1.getExpr() instanceof FunctionCall
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_1
}

predicate func_2(Variable vskb_326, VariableAccess target_2) {
	target_2.getTarget()=vskb_326
}

from Function func, Parameter vframe_323, Parameter vport_324, Variable vskb_326, FunctionCall target_0, ExprStmt target_1, VariableAccess target_2
where
func_0(vframe_323, vport_324, vskb_326, target_0)
and func_1(func, target_1)
and func_2(vskb_326, target_2)
and vframe_323.getType().hasName("hsr_frame_info *")
and vport_324.getType().hasName("hsr_port *")
and vskb_326.getType().hasName("sk_buff *")
and vframe_323.getFunction() = func
and vport_324.getFunction() = func
and vskb_326.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
