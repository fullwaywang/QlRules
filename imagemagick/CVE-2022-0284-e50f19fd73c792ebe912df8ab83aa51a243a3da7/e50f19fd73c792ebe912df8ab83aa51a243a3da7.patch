commit e50f19fd73c792ebe912df8ab83aa51a243a3da7
Author: Cristy <urban-warrior@imagemagick.org>
Date:   Wed Jan 19 16:26:12 2022 -0500

    https://github.com/ImageMagick/ImageMagick/issues/4729

diff --git a/coders/xpm.c b/coders/xpm.c
index 782ed7325..5f73df8bc 100644
--- a/coders/xpm.c
+++ b/coders/xpm.c
@@ -773,7 +773,7 @@ static MagickBooleanType WritePICONImage(const ImageInfo *image_info,
               break;
             for (x=0; x < (ssize_t) picon->columns; x++)
             {
-              if (GetPixelAlpha(image,q) == (Quantum) TransparentAlpha)
+              if (GetPixelAlpha(picon,q) == (Quantum) TransparentAlpha)
                 transparent=MagickTrue;
               else
                 SetPixelAlpha(picon,OpaqueAlpha,q);
@@ -804,7 +804,7 @@ static MagickBooleanType WritePICONImage(const ImageInfo *image_info,
           break;
         for (x=0; x < (ssize_t) picon->columns; x++)
         {
-          if (GetPixelAlpha(image,q) == (Quantum) TransparentAlpha)
+          if (GetPixelAlpha(picon,q) == (Quantum) TransparentAlpha)
             SetPixelIndex(picon,(Quantum) picon->colors,q);
           q+=GetPixelChannels(picon);
         }
