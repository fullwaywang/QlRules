/**
 * @name linux-0da0b06165d83a8ecbb6582d9d5a135f9d38a52a-amdgpu_job_prepare_job
 * @id cpp/linux/0da0b06165d83a8ecbb6582d9d5a135f9d38a52a/amdgpu-job-prepare-job
 * @description linux-0da0b06165d83a8ecbb6582d9d5a135f9d38a52a-drivers/gpu/drm/amd/amdgpu/amdgpu_job.c-amdgpu_job_prepare_job CVE-2024-44961
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vr_259, VariableAccess target_0) {
	exists(LogicalAndExpr obj_0 | obj_0=target_0.getParent() |
		obj_0.getRightOperand() instanceof EqualityOperation
		and obj_0.getParent().(IfStmt).getThen() instanceof GotoStmt
	)
	and target_0.getTarget()=vr_259
}

predicate func_1(Variable vr_259, LogicalAndExpr target_1) {
	exists(EqualityOperation obj_0 | obj_0=target_1.getRightOperand() |
		obj_0.getLeftOperand().(VariableAccess).getTarget()=vr_259
		and obj_0.getRightOperand().(UnaryMinusExpr).getValue()="-61"
	)
	and target_1.getLeftOperand().(VariableAccess).getTarget()=vr_259
	and target_1.getParent().(IfStmt).getThen() instanceof GotoStmt
}

from Function func, Variable vr_259, VariableAccess target_0, LogicalAndExpr target_1
where
func_0(vr_259, target_0)
and func_1(vr_259, target_1)
and vr_259.getType().hasName("int")
and vr_259.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
