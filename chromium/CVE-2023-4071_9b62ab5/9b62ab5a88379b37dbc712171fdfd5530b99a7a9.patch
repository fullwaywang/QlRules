commit 9b62ab5a88379b37dbc712171fdfd5530b99a7a9	9b62ab5a88379b37dbc712171fdfd5530b99a7a9
Author: kylechar <kylechar@chromium.org>
Date:   Wed Jul 12 13:35:46 2023 +0000

    Ensure unique entries in frame_timing_details_
    
    CompositorFrameSinkSupport::DidPresentCompositorFrame() keeps
    |frame_timing_details_| map keyed on CompositorFrame frame_tokens. These
    are supposed to be unique but a malicious renderer could violate that
    assumption. Convert some DCHECKs into CHECKs to guard against problems
    related to this.
    
    Bug: 1458819
    Change-Id: Ib0b9551d18ea421957e0dce49a2593043f4abb12
    Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/4673638
    Reviewed-by: Jonathan Ross <jonross@chromium.org>
    Commit-Queue: Kyle Charbonneau <kylechar@chromium.org>
    Cr-Commit-Position: refs/heads/main@{#1169287}

diff --git a/components/viz/service/frame_sinks/compositor_frame_sink_support.cc b/components/viz/service/frame_sinks/compositor_frame_sink_support.cc
index cb1cb7a007001..72f64313535be 100644
--- a/components/viz/service/frame_sinks/compositor_frame_sink_support.cc
+++ b/components/viz/service/frame_sinks/compositor_frame_sink_support.cc
@@ -799,7 +799,7 @@ void CompositorFrameSinkSupport::DidPresentCompositorFrame(
   DCHECK_LE(pending_received_frame_times_.size(), 25u);
   auto received_frame_timestamp =
       pending_received_frame_times_.find(frame_token);
-  DCHECK(received_frame_timestamp != pending_received_frame_times_.end());
+  CHECK(received_frame_timestamp != pending_received_frame_times_.end());
 
   FrameTimingDetails details;
   details.received_compositor_frame_timestamp =
@@ -820,8 +820,7 @@ void CompositorFrameSinkSupport::DidPresentCompositorFrame(
   pending_received_frame_times_.erase(received_frame_timestamp);
 
   // We should only ever get one PresentationFeedback per frame_token.
-  DCHECK(frame_timing_details_.find(frame_token) ==
-         frame_timing_details_.end());
+  CHECK(!frame_timing_details_.contains(frame_token));
   frame_timing_details_.emplace(frame_token, details);
 
   if (!feedback.failed() && frame_sink_manager_->frame_counter()) {
