commit fb54c10d8b5a9e7c68f76ea8501c7e8664429bbb	fb54c10d8b5a9e7c68f76ea8501c7e8664429bbb
Author: Tommy Steimel <steimel@chromium.org>
Date:   Mon Sep 18 23:52:25 2023 +0000

    pip2: Elide tail for file URLs
    
    This CL changes document picture-in-picture windows to elide the tail
    of the origin display for file URLs, since the file name can be made to
    look like an origin for spoofing.
    
    We will continue to elide the head of the origin display for HTTPS
    URLs, since origins should be head-elided to prevent spoofing.
    
    Bug: 1482045
    Change-Id: Ib0ce7abf869e42b5b070aba9246c9e784a3d2140
    Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/4874656
    Commit-Queue: Tommy Steimel <steimel@chromium.org>
    Reviewed-by: Scott Violet <sky@chromium.org>
    Cr-Commit-Position: refs/heads/main@{#1198094}

diff --git a/chrome/browser/ui/views/frame/picture_in_picture_browser_frame_view.cc b/chrome/browser/ui/views/frame/picture_in_picture_browser_frame_view.cc
index 7ce82820103b1..cfddfedfe9976 100644
--- a/chrome/browser/ui/views/frame/picture_in_picture_browser_frame_view.cc
+++ b/chrome/browser/ui/views/frame/picture_in_picture_browser_frame_view.cc
@@ -451,13 +451,21 @@ PictureInPictureBrowserFrameView::PictureInPictureBrowserFrameView(
                                      gfx::Insets::TLBR(0, 8, 0, 4));
   }
 
+  // For file URLs, we want to elide the tail, since the file name and/or query
+  // part of the file URL can be made to look like an origin for spoofing. For
+  // HTTPS URLs, we elide the head to prevent spoofing via long origins, since
+  // in the HTTPS case everything besides the origin is removed for display.
+  auto elide_behavior = location_bar_model_->GetURL().SchemeIsFile()
+                            ? gfx::ELIDE_TAIL
+                            : gfx::ELIDE_HEAD;
+
   // Creates the window title.
   top_bar_container_view_->AddChildView(
       views::Builder<views::Label>()
           .CopyAddressTo(&window_title_)
           .SetText(location_bar_model_->GetURLForDisplay())
           .SetHorizontalAlignment(gfx::ALIGN_LEFT)
-          .SetElideBehavior(gfx::ELIDE_HEAD)
+          .SetElideBehavior(elide_behavior)
           .SetProperty(
               views::kFlexBehaviorKey,
               views::FlexSpecification(views::MinimumFlexSizeRule::kScaleToZero,
