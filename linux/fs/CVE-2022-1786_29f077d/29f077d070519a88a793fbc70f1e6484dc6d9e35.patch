commit 29f077d070519a88a793fbc70f1e6484dc6d9e35
Author: Jens Axboe <axboe@kernel.dk>
Date:   Mon May 16 23:05:51 2022 +0200

    io_uring: always use original task when preparing req identity
    
    If the ring is setup with IORING_SETUP_IOPOLL and we have more than
    one task doing submissions on a ring, we can up in a situation where
    we assign the context from the current task rather than the request
    originator.
    
    Always use req->task rather than assume it's the same as current.
    
    No upstream patch exists for this issue, as only older kernels with
    the non-native workers have this problem.
    
    Reported-by: Kyle Zeng <zengyhkyle@gmail.com>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/fs/io_uring.c b/fs/io_uring.c
index ab9290ab4cae0..4330603eae35d 100644
--- a/fs/io_uring.c
+++ b/fs/io_uring.c
@@ -1156,7 +1156,7 @@ static inline void __io_req_init_async(struct io_kiocb *req)
  */
 static inline void io_req_init_async(struct io_kiocb *req)
 {
-	struct io_uring_task *tctx = current->io_uring;
+	struct io_uring_task *tctx = req->task->io_uring;
 
 	if (req->flags & REQ_F_WORK_INITIALIZED)
 		return;
