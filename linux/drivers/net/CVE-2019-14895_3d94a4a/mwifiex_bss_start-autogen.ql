/**
 * @name linux-3d94a4a8373bf5f45cf5f939e88b8354dbf2311b-mwifiex_bss_start
 * @id cpp/linux/3d94a4a8373bf5f45cf5f939e88b8354dbf2311b/mwifiex-bss-start
 * @description linux-3d94a4a8373bf5f45cf5f939e88b8354dbf2311b-drivers/net/wireless/marvell/mwifiex/sta_ioctl.c-mwifiex_bss_start CVE-2019-14895
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(ExprStmt target_4, Function func) {
exists(LogicalAndExpr target_0 |
	target_0.getLeftOperand() instanceof EqualityOperation
	and target_0.getRightOperand() instanceof FunctionCall
	and target_0.getParent().(IfStmt).getThen()=target_4
	and target_0.getEnclosingFunction() = func)
}

predicate func_1(EqualityOperation target_2, Function func) {
exists(ReturnStmt target_1 |
	target_1.getExpr().(UnaryMinusExpr).getValue()="-22"
	and target_1.getParent().(IfStmt).getCondition()=target_2
	and target_1.getEnclosingFunction() = func)
}

predicate func_2(Variable vadapter_269, ExprStmt target_4, EqualityOperation target_2) {
	target_2.getLeftOperand().(PointerFieldAccess).getTarget().getName()="region_code"
	and target_2.getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vadapter_269
	and target_2.getRightOperand().(HexLiteral).getValue()="0"
	and target_2.getParent().(IfStmt).getThen()=target_4
}

predicate func_3(Parameter vpriv_265, Parameter vbss_265, FunctionCall target_3) {
	target_3.getTarget().hasName("mwifiex_process_country_ie")
	and target_3.getArgument(0).(VariableAccess).getTarget()=vpriv_265
	and target_3.getArgument(1).(VariableAccess).getTarget()=vbss_265
}

predicate func_4(EqualityOperation target_2, Function func, ExprStmt target_4) {
	target_4.getExpr() instanceof FunctionCall
	and target_4.getParent().(IfStmt).getCondition()=target_2
	and target_4.getEnclosingFunction() = func
}

from Function func, Variable vadapter_269, Parameter vpriv_265, Parameter vbss_265, EqualityOperation target_2, FunctionCall target_3, ExprStmt target_4
where
not func_0(target_4, func)
and not func_1(target_2, func)
and func_2(vadapter_269, target_4, target_2)
and func_3(vpriv_265, vbss_265, target_3)
and func_4(target_2, func, target_4)
and vadapter_269.getType().hasName("mwifiex_adapter *")
and vpriv_265.getType().hasName("mwifiex_private *")
and vbss_265.getType().hasName("cfg80211_bss *")
and vadapter_269.(LocalVariable).getFunction() = func
and vpriv_265.getFunction() = func
and vbss_265.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
