/**
 * @name linux-50145474f6ef4a9c19205b173da6264a644c7489-fb_flashcursor
 * @id cpp/linux/50145474f6ef4a9c19205b173da6264a644c7489/fb-flashcursor
 * @description linux-50145474f6ef4a9c19205b173da6264a644c7489-fb_flashcursor CVE-2020-14390
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_1(Variable vsoftback_lines, VariableAccess target_1) {
		target_1.getTarget()=vsoftback_lines
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getExpr().(PointerFieldAccess).getTarget().getName()="cursor"
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getExpr().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("fbcon_ops *")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("vc_data *")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("fb_info *")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("int")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(4).(FunctionCall).getTarget().hasName("get_color")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(4).(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("vc_data *")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(4).(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("fb_info *")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(4).(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("int")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(4).(FunctionCall).getArgument(3).(Literal).getValue()="1"
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(5).(FunctionCall).getTarget().hasName("get_color")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(5).(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("vc_data *")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(5).(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("fb_info *")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(5).(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("int")
		and target_1.getParent().(VariableCall).getParent().(ExprStmt).getExpr().(VariableCall).getArgument(5).(FunctionCall).getArgument(3).(Literal).getValue()="0"
}

from Function func, Variable vsoftback_lines, VariableAccess target_1
where
func_1(vsoftback_lines, target_1)
and vsoftback_lines.getType().hasName("int")
and not vsoftback_lines.getParentScope+() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
