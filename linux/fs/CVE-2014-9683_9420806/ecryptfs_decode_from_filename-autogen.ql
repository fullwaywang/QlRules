/**
 * @name linux-942080643bce061c3dd9d5718d3b745dcb39a8bc-ecryptfs_decode_from_filename
 * @id cpp/linux/942080643bce061c3dd9d5718d3b745dcb39a8bc/ecryptfs-decode-from-filename
 * @description linux-942080643bce061c3dd9d5718d3b745dcb39a8bc-fs/ecryptfs/crypto.c-ecryptfs_decode_from_filename CVE-2014-9683
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vdst_byte_offset_1892, Parameter vdst_1887, VariableAccess target_1, ExprStmt target_0) {
	target_0.getExpr().(AssignExpr).getLValue().(ArrayExpr).getArrayBase().(VariableAccess).getTarget()=vdst_1887
	and target_0.getExpr().(AssignExpr).getLValue().(ArrayExpr).getArrayOffset().(VariableAccess).getTarget()=vdst_byte_offset_1892
	and target_0.getExpr().(AssignExpr).getRValue().(Literal).getValue()="0"
	and target_0.getParent().(BlockStmt).getParent().(SwitchStmt).getExpr()=target_1
}

predicate func_1(Variable vcurrent_bit_offset_1890, VariableAccess target_1) {
	target_1.getTarget()=vcurrent_bit_offset_1890
}

from Function func, Variable vcurrent_bit_offset_1890, Variable vdst_byte_offset_1892, Parameter vdst_1887, ExprStmt target_0, VariableAccess target_1
where
func_0(vdst_byte_offset_1892, vdst_1887, target_1, target_0)
and func_1(vcurrent_bit_offset_1890, target_1)
and vcurrent_bit_offset_1890.getType().hasName("u8")
and vdst_byte_offset_1892.getType().hasName("size_t")
and vdst_1887.getType().hasName("unsigned char *")
and vcurrent_bit_offset_1890.(LocalVariable).getFunction() = func
and vdst_byte_offset_1892.(LocalVariable).getFunction() = func
and vdst_1887.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
