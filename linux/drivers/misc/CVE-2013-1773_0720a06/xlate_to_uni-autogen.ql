/**
 * @name linux-0720a06a7518c9d0c0125bd5d1f3b6264c55c3dd-xlate_to_uni
 * @id cpp/linux/0720a06a7518c9d0c0125bd5d1f3b6264c55c3dd/xlate-to-uni
 * @description linux-0720a06a7518c9d0c0125bd5d1f3b6264c55c3dd-fs/fat/namei_vfat.c-xlate_to_uni CVE-2013-1773
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_1(Function func) {
	exists(AddExpr target_1 |
		target_1.getValue()="257"
		and target_1.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("utf8s_to_utf16s")
		and target_1.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("const unsigned char *")
		and target_1.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("int")
		and target_1.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("unsigned char *")
		and target_1.getEnclosingFunction() = func)
}

from Function func
where
not func_1(func)
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
