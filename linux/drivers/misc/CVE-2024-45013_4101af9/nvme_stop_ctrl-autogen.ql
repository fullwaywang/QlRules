/**
 * @name linux-4101af98ab573554c4225e328d506fec2a74bc54-nvme_stop_ctrl
 * @id cpp/linux/4101af98ab573554c4225e328d506fec2a74bc54/nvme-stop-ctrl
 * @description linux-4101af98ab573554c4225e328d506fec2a74bc54-drivers/nvme/host/core.c-nvme_stop_ctrl CVE-2024-45013
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vctrl_4521, Function func, ExprStmt target_0) {
	exists(FunctionCall obj_0 | obj_0=target_0.getExpr() |
		obj_0.getTarget().hasName("nvme_stop_keep_alive")
		and obj_0.getArgument(0).(VariableAccess).getTarget()=vctrl_4521
	)
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_0
}

from Function func, Parameter vctrl_4521, ExprStmt target_0
where
func_0(vctrl_4521, func, target_0)
and vctrl_4521.getType().hasName("nvme_ctrl *")
and vctrl_4521.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
