commit f8d0f9aa1ba04c9ae3bfe869a18141a8b8117ad7 (from 7877e9c4c00b8fe617e30b2e8dd40b93fc19a2b3)	f8d0f9aa1ba04c9ae3bfe869a18141a8b8117ad7
Merge: 7877e9c4 32ea0722
Author: Even Rouault <even.rouault@spatialys.com>
Date:   Tue Mar 8 16:22:04 2022 +0000

    Merge branch 'issue-393' into 'master'
    
    fix the FPE in tiffcrop (#393)
    
    Closes #393
    
    See merge request libtiff/libtiff!310

diff --git a/libtiff/tif_dir.c b/libtiff/tif_dir.c
index 57055ca9..59b346ca 100644
--- a/libtiff/tif_dir.c
+++ b/libtiff/tif_dir.c
@@ -333,13 +333,13 @@ _TIFFVSetField(TIFF* tif, uint32_t tag, va_list ap)
 		break;
 	case TIFFTAG_XRESOLUTION:
         dblval = va_arg(ap, double);
-        if( dblval < 0 )
+        if( dblval != dblval || dblval < 0 )
             goto badvaluedouble;
 		td->td_xresolution = _TIFFClampDoubleToFloat( dblval );
 		break;
 	case TIFFTAG_YRESOLUTION:
         dblval = va_arg(ap, double);
-        if( dblval < 0 )
+        if( dblval != dblval || dblval < 0 )
             goto badvaluedouble;
 		td->td_yresolution = _TIFFClampDoubleToFloat( dblval );
 		break;

commit f8d0f9aa1ba04c9ae3bfe869a18141a8b8117ad7 (from 32ea0722ee68f503b7a3f9b2d557acb293fc8cde)	f8d0f9aa1ba04c9ae3bfe869a18141a8b8117ad7
Merge: 7877e9c4 32ea0722
Author: Even Rouault <even.rouault@spatialys.com>
Date:   Tue Mar 8 16:22:04 2022 +0000

    Merge branch 'issue-393' into 'master'
    
    fix the FPE in tiffcrop (#393)
    
    Closes #393
    
    See merge request libtiff/libtiff!310

diff --git a/cmake/PkgConfig.cmake b/cmake/PkgConfig.cmake
index 7796a6b7..4c193534 100644
--- a/cmake/PkgConfig.cmake
+++ b/cmake/PkgConfig.cmake
@@ -47,12 +47,12 @@ endfunction()
 
 # Generate pkg-config file
 set(prefix "${CMAKE_INSTALL_PREFIX}")
-set(exec_prefix "${CMAKE_INSTALL_PREFIX}")
-set(libdir "${CMAKE_INSTALL_LIBDIR}")
-set(includedir "${CMAKE_INSTALL_INCLUDEDIR}")
+set(exec_prefix "$${prefix}")
+set(libdir "$${exec_prefix}/${CMAKE_INSTALL_LIBDIR}")
+set(includedir "$${prefix}/${CMAKE_INSTALL_INCLUDEDIR}")
 set_libs_private(tiff_libs_private ${tiff_libs_private_list})
 configure_file(${CMAKE_CURRENT_SOURCE_DIR}/libtiff-4.pc.in
-        ${CMAKE_CURRENT_BINARY_DIR}/libtiff-4.pc)
+        ${CMAKE_CURRENT_BINARY_DIR}/libtiff-4.pc @ONLY)
 
 # Install pkg-config file
 install(FILES ${CMAKE_CURRENT_BINARY_DIR}/libtiff-4.pc
