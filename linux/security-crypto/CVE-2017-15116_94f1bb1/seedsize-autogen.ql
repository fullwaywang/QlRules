/**
 * @name linux-94f1bb15bed84ad6c893916b7e7b9db6f1d7eec6-seedsize
 * @id cpp/linux/94f1bb15bed84ad6c893916b7e7b9db6f1d7eec6/seedsize
 * @description linux-94f1bb15bed84ad6c893916b7e7b9db6f1d7eec6-crypto/rng.c-seedsize CVE-2017-15116
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vralg_115, PointerFieldAccess target_0) {
		target_0.getTarget().getName()="seedsize"
		and target_0.getQualifier().(VariableAccess).getTarget()=vralg_115
}

predicate func_1(Variable vralg_115, Parameter valg_113, ConditionalExpr target_1) {
		target_1.getCondition().(ValueFieldAccess).getTarget().getName()="rng_make_random"
		and target_1.getCondition().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="rng"
		and target_1.getCondition().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="cra_u"
		and target_1.getCondition().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=valg_113
		and target_1.getThen().(ValueFieldAccess).getTarget().getName()="seedsize"
		and target_1.getThen().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="rng"
		and target_1.getThen().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="cra_u"
		and target_1.getThen().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=valg_113
		and target_1.getElse().(PointerFieldAccess).getTarget().getName()="seedsize"
		and target_1.getElse().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vralg_115
}

from Function func, Variable vralg_115, Parameter valg_113, PointerFieldAccess target_0, ConditionalExpr target_1
where
func_0(vralg_115, target_0)
and func_1(vralg_115, valg_113, target_1)
and vralg_115.getType().hasName("rng_alg *")
and valg_113.getType().hasName("crypto_alg *")
and vralg_115.(LocalVariable).getFunction() = func
and valg_113.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
