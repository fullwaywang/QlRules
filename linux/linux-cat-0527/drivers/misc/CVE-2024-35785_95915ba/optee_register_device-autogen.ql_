/**
 * @name linux-95915ba4b987cf2b222b0f251280228a1ff977ac-optee_register_device
 * @id cpp/linux/95915ba4b987cf2b222b0f251280228a1ff977ac/optee-register-device
 * @description linux-95915ba4b987cf2b222b0f251280228a1ff977ac-drivers/tee/optee/device.c-optee_register_device CVE-2024-35785
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func) {
exists(ReturnStmt target_0 |
	target_0.getExpr().(Literal).getValue()="0"
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_0
	and target_0.getFollowingStmt() instanceof ReturnStmt)
}

predicate func_1(Variable vrc_75, Function func, ReturnStmt target_1) {
	target_1.getExpr().(VariableAccess).getTarget()=vrc_75
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_1
}

from Function func, Variable vrc_75, ReturnStmt target_1
where
not func_0(func)
and func_1(vrc_75, func, target_1)
and vrc_75.getType().hasName("int")
and vrc_75.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
