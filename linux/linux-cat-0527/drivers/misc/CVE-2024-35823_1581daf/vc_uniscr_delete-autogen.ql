/**
 * @name linux-1581dafaf0d34bc9c428a794a22110d7046d186d-vc_uniscr_delete
 * @id cpp/linux/1581dafaf0d34bc9c428a794a22110d7046d186d/vc-uniscr-delete
 * @description linux-1581dafaf0d34bc9c428a794a22110d7046d186d-drivers/tty/vt/vt.c-vc_uniscr_delete CVE-2024-35823
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func, StringLiteral target_0) {
	target_0.getValue()="memcpy"
	and not target_0.getValue()="memmove"
	and target_0.getEnclosingFunction() = func
}

predicate func_1(Variable vln_381, Variable vx_382, Variable v__fortify_size_384, Parameter vnr_378, FunctionCall target_1) {
	target_1.getTarget().hasName("__builtin_memcpy")
	and not target_1.getTarget().hasName("__builtin_memmove")
	and target_1.getArgument(0).(AddressOfExpr).getOperand().(ArrayExpr).getArrayBase().(VariableAccess).getTarget()=vln_381
	and target_1.getArgument(0).(AddressOfExpr).getOperand().(ArrayExpr).getArrayOffset().(VariableAccess).getTarget()=vx_382
	and target_1.getArgument(1).(AddressOfExpr).getOperand().(ArrayExpr).getArrayBase().(VariableAccess).getTarget()=vln_381
	and target_1.getArgument(1).(AddressOfExpr).getOperand().(ArrayExpr).getArrayOffset().(AddExpr).getLeftOperand().(VariableAccess).getTarget()=vx_382
	and target_1.getArgument(1).(AddressOfExpr).getOperand().(ArrayExpr).getArrayOffset().(AddExpr).getRightOperand().(VariableAccess).getTarget()=vnr_378
	and target_1.getArgument(2).(VariableAccess).getTarget()=v__fortify_size_384
}

from Function func, Variable vln_381, Variable vx_382, Variable v__fortify_size_384, Parameter vnr_378, StringLiteral target_0, FunctionCall target_1
where
func_0(func, target_0)
and func_1(vln_381, vx_382, v__fortify_size_384, vnr_378, target_1)
and vln_381.getType().hasName("u32 *")
and vx_382.getType().hasName("unsigned int")
and v__fortify_size_384.getType().hasName("const size_t")
and vnr_378.getType().hasName("unsigned int")
and vln_381.(LocalVariable).getFunction() = func
and vx_382.(LocalVariable).getFunction() = func
and v__fortify_size_384.(LocalVariable).getFunction() = func
and vnr_378.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
