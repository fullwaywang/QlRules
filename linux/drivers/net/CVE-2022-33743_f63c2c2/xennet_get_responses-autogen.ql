/**
 * @name linux-f63c2c2032c2e3caad9add3b82cc6e91c376fd26-xennet_get_responses
 * @id cpp/linux/f63c2c2032c2e3caad9add3b82cc6e91c376fd26/xennet-get-responses
 * @description linux-f63c2c2032c2e3caad9add3b82cc6e91c376fd26-drivers/net/xen-netfront.c-xennet_get_responses CVE-2022-33743
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vlist_1016, Variable vskb_1022, LabelStmt target_1, ExprStmt target_0) {
	target_0.getExpr().(FunctionCall).getTarget().hasName("__skb_queue_tail")
	and target_0.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vlist_1016
	and target_0.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vskb_1022
	and target_1.getLocation().isBefore(target_0.getLocation())
}

predicate func_1(Function func, LabelStmt target_1) {
	target_1.getName() ="next"
	and target_1.getEnclosingFunction() = func
}

from Function func, Parameter vlist_1016, Variable vskb_1022, ExprStmt target_0, LabelStmt target_1
where
func_0(vlist_1016, vskb_1022, target_1, target_0)
and func_1(func, target_1)
and vlist_1016.getType().hasName("sk_buff_head *")
and vskb_1022.getType().hasName("sk_buff *")
and vlist_1016.getFunction() = func
and vskb_1022.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
