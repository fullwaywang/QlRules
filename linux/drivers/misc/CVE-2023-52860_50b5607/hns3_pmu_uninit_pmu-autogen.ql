/**
 * @name linux-50b560783f7f71790bcf70e9e9855155fb0af8c1-hns3_pmu_uninit_pmu
 * @id cpp/linux/50b560783f7f71790bcf70e9e9855155fb0af8c1/hns3-pmu-uninit-pmu
 * @description linux-50b560783f7f71790bcf70e9e9855155fb0af8c1-drivers/perf/hisilicon/hns3_pmu.c-hns3_pmu_uninit_pmu CVE-2023-52860
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vhns3_pmu_1568, FunctionCall target_0) {
	target_0.getTarget().hasName("cpuhp_state_remove_instance")
	and not target_0.getTarget().hasName("cpuhp_state_remove_instance_nocalls")
	and target_0.getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="node"
	and target_0.getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vhns3_pmu_1568
}

from Function func, Variable vhns3_pmu_1568, FunctionCall target_0
where
func_0(vhns3_pmu_1568, target_0)
and vhns3_pmu_1568.getType().hasName("hns3_pmu *")
and vhns3_pmu_1568.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
