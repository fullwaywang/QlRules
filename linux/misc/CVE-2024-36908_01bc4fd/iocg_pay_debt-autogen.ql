/**
 * @name linux-01bc4fda9ea0a6b52f12326486f07a4910666cf6-iocg_pay_debt
 * @id cpp/linux/01bc4fda9ea0a6b52f12326486f07a4910666cf6/iocg-pay-debt
 * @description linux-01bc4fda9ea0a6b52f12326486f07a4910666cf6-block/blk-iocost.c-iocg_pay_debt CVE-2024-36908
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter viocg_1436, AddressOfExpr target_3) {
exists(LogicalAndExpr target_0 |
	target_0.getLeftOperand() instanceof FunctionCall
	and target_0.getRightOperand().(ValueFieldAccess).getTarget().getName()="online"
	and target_0.getRightOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="pd"
	and target_0.getRightOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=viocg_1436
	and target_0.getRightOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_3.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation()))
}

predicate func_1(Parameter viocg_1436, FunctionCall target_1) {
	target_1.getTarget().hasName("list_empty")
	and target_1.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="active_list"
	and target_1.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=viocg_1436
}

predicate func_3(Parameter viocg_1436, AddressOfExpr target_3) {
	target_3.getOperand().(PointerFieldAccess).getTarget().getName()="active_list"
	and target_3.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=viocg_1436
}

from Function func, Parameter viocg_1436, FunctionCall target_1, AddressOfExpr target_3
where
not func_0(viocg_1436, target_3)
and func_1(viocg_1436, target_1)
and func_3(viocg_1436, target_3)
and viocg_1436.getType().hasName("ioc_gq *")
and viocg_1436.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
