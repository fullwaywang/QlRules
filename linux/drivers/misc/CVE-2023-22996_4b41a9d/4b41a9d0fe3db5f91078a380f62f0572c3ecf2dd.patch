commit 4b41a9d0fe3db5f91078a380f62f0572c3ecf2dd
Author: Miaoqian Lin <linmq006@gmail.com>
Date:   Sat Jan 8 09:59:31 2022 +0000

    soc: qcom: aoss: Fix missing put_device call in qmp_get
    
    The reference taken by 'of_find_device_by_node()' must be released when
    not needed anymore.
    Add the corresponding 'put_device()' in the error handling paths.
    
    Fixes: 8c75d585b931 ("soc: qcom: aoss: Expose send for generic usecase")
    Signed-off-by: Miaoqian Lin <linmq006@gmail.com>
    Reviewed-by: Stephen Boyd <swboyd@chromium.org>
    Signed-off-by: Bjorn Andersson <bjorn.andersson@linaro.org>
    Link: https://lore.kernel.org/r/20220108095931.21527-1-linmq006@gmail.com

diff --git a/drivers/soc/qcom/qcom_aoss.c b/drivers/soc/qcom/qcom_aoss.c
index cbe5e39fdaeb..563ae0a501dc 100644
--- a/drivers/soc/qcom/qcom_aoss.c
+++ b/drivers/soc/qcom/qcom_aoss.c
@@ -451,7 +451,11 @@ struct qmp *qmp_get(struct device *dev)
 
 	qmp = platform_get_drvdata(pdev);
 
-	return qmp ? qmp : ERR_PTR(-EPROBE_DEFER);
+	if (!qmp) {
+		put_device(&pdev->dev);
+		return ERR_PTR(-EPROBE_DEFER);
+	}
+	return qmp;
 }
 EXPORT_SYMBOL(qmp_get);
 
