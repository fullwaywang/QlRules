/**
 * @name chromium-a5e2bf3eaeea3a0f7ba9af687f1ee99014aa26fe-extensions__util__SetAllowFileAccess
 * @id cpp/chromium/a5e2bf3eaeea3a0f7ba9af687f1ee99014aa26fe/extensionsutilsetallowfileaccess
 * @description chromium-a5e2bf3eaeea3a0f7ba9af687f1ee99014aa26fe-chrome/browser/extensions/extension_util.cc-extensions__util__SetAllowFileAccess CVE-2023-1221
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vextension_id_166, Parameter vcontext_167, FunctionCall target_0) {
	target_0.getTarget().hasName("ReloadExtensionIfEnabled")
	and not target_0.getTarget().hasName("ReloadExtension")
	and target_0.getArgument(0).(VariableAccess).getTarget()=vextension_id_166
	and target_0.getArgument(1).(VariableAccess).getTarget()=vcontext_167
}

from Function func, Parameter vextension_id_166, Parameter vcontext_167, FunctionCall target_0
where
func_0(vextension_id_166, vcontext_167, target_0)
and vextension_id_166.getType().hasName("const string &")
and vcontext_167.getType().hasName("BrowserContext *")
and vextension_id_166.getFunction() = func
and vcontext_167.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
