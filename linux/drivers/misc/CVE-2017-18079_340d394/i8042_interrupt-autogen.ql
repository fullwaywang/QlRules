/**
 * @name linux-340d394a789518018f834ff70f7534fc463d3226-i8042_interrupt
 * @id cpp/linux/340d394a789518018f834ff70f7534fc463d3226/i8042-interrupt
 * @description linux-340d394a789518018f834ff70f7534fc463d3226-drivers/input/serio/i8042.c-i8042_interrupt CVE-2017-18079
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_1(Variable vport_498, LogicalOrExpr target_2, PointerFieldAccess target_1) {
	target_1.getTarget().getName()="exists"
	and target_1.getQualifier().(VariableAccess).getTarget()=vport_498
	and target_2.getLeftOperand().(NotExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_1.getQualifier().(VariableAccess).getLocation())
}

predicate func_2(Variable vport_498, LogicalOrExpr target_2) {
	target_2.getLeftOperand().(NotExpr).getOperand().(PointerFieldAccess).getTarget().getName()="driver_bound"
	and target_2.getLeftOperand().(NotExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vport_498
	and target_2.getRightOperand().(VariableAccess).getTarget().getType().hasName("bool")
}

from Function func, Variable vport_498, PointerFieldAccess target_1, LogicalOrExpr target_2
where
func_1(vport_498, target_2, target_1)
and func_2(vport_498, target_2)
and vport_498.getType().hasName("i8042_port *")
and vport_498.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
