commit a41479ba6efb5e48b82edad972c7dded6f385b79	a41479ba6efb5e48b82edad972c7dded6f385b79
Author: Yoichi Osato <yoichio@chromium.org>
Date:   Thu Aug 24 05:33:18 2023 +0000

    Readd lock when ObserverListMap::erase()
    
    We should lock when remove an item from the map.
    This lock was accidentally removed in:
    https://chromium-review.googlesource.com/c/chromium/src/+/4280021
    
    Bug: 1469928
    Change-Id: I2512e14d4ad9b246cadae947023dbccb5158da51
    Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/4790983
    Auto-Submit: Yoichi Osato <yoichio@chromium.org>
    Reviewed-by: Yoichi Osato <yoichio@chromium.org>
    Reviewed-by: Koji Ishii <kojii@chromium.org>
    Commit-Queue: Koji Ishii <kojii@chromium.org>
    Cr-Commit-Position: refs/heads/main@{#1187668}

diff --git a/third_party/blink/renderer/platform/network/network_state_notifier.cc b/third_party/blink/renderer/platform/network/network_state_notifier.cc
index 55f3034498228..b73a0ad6625a8 100644
--- a/third_party/blink/renderer/platform/network/network_state_notifier.cc
+++ b/third_party/blink/renderer/platform/network/network_state_notifier.cc
@@ -351,6 +351,7 @@ void NetworkStateNotifier::RemoveObserver(
   DCHECK(task_runner->RunsTasksInCurrentSequence());
   DCHECK(observer);
 
+  base::AutoLock locker(lock_);
   ObserverListMap& map = GetObserverMapFor(type);
   DCHECK(base::Contains(map, observer));
   map.erase(observer);
