/**
 * @name linux-973c096f6a85e5b5f2a295126ba6928d9a6afd45-vgacon_scroll
 * @id cpp/linux/973c096f6a85e5b5f2a295126ba6928d9a6afd45/vgacon-scroll
 * @description linux-973c096f6a85e5b5f2a295126ba6928d9a6afd45-drivers/video/console/vgacon.c-vgacon_scroll CVE-2020-28097
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vt_1373, Parameter vlines_1374, Parameter vc_1373, EqualityOperation target_1, ExprStmt target_0) {
	target_0.getExpr().(FunctionCall).getTarget().hasName("vgacon_scrollback_update")
	and target_0.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vc_1373
	and target_0.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vt_1373
	and target_0.getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget()=vlines_1374
	and target_0.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_1
}

predicate func_1(Function func, EqualityOperation target_1) {
	target_1.getLeftOperand().(VariableAccess).getTarget().getType().hasName("con_scroll")
	and target_1.getEnclosingFunction() = func
}

from Function func, Parameter vt_1373, Parameter vlines_1374, Parameter vc_1373, ExprStmt target_0, EqualityOperation target_1
where
func_0(vt_1373, vlines_1374, vc_1373, target_1, target_0)
and func_1(func, target_1)
and vt_1373.getType().hasName("unsigned int")
and vlines_1374.getType().hasName("unsigned int")
and vc_1373.getType().hasName("vc_data *")
and vt_1373.getFunction() = func
and vlines_1374.getFunction() = func
and vc_1373.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
