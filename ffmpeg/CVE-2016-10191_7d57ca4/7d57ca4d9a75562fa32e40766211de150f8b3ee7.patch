commit 7d57ca4d9a75562fa32e40766211de150f8b3ee7
Author: Michael Niedermayer <michael@niedermayer.cc>
Date:   Mon Dec 5 11:14:51 2016 +0100

    avformat/rtmppkt: Check for packet size mismatches
    
    Fixes out of array access
    
    Found-by: Paul Cher <paulcher@icloud.com>
    Reviewed-by: Paul Cher <paulcher@icloud.com>
    Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>

diff --git a/libavformat/rtmppkt.c b/libavformat/rtmppkt.c
index 0d693c27f7..cde0da78ce 100644
--- a/libavformat/rtmppkt.c
+++ b/libavformat/rtmppkt.c
@@ -235,6 +235,14 @@ static int rtmp_packet_read_one_chunk(URLContext *h, RTMPPacket *p,
     if (hdr != RTMP_PS_TWELVEBYTES)
         timestamp += prev_pkt[channel_id].timestamp;
 
+    if (prev_pkt[channel_id].read && size != prev_pkt[channel_id].size) {
+        av_log(NULL, AV_LOG_ERROR, "RTMP packet size mismatch %d != %d\n",
+                size,
+                prev_pkt[channel_id].size);
+        ff_rtmp_packet_destroy(&prev_pkt[channel_id]);
+        prev_pkt[channel_id].read = 0;
+    }
+
     if (!prev_pkt[channel_id].read) {
         if ((ret = ff_rtmp_packet_create(p, channel_id, type, timestamp,
                                          size)) < 0)
