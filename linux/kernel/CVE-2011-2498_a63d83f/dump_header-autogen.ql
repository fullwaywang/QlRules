/**
 * @name linux-a63d83f427f-dump_header
 * @id cpp/linux/a63d83f427f/dump-header
 * @description linux-a63d83f427f-mm/oom_kill.c-dump_header CVE-2011-2498
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func, StringLiteral target_0) {
		target_0.getValue()="<4>%s invoked oom-killer: gfp_mask=0x%x, order=%d, oom_adj=%d\n"
		and not target_0.getValue()="<4>%s invoked oom-killer: gfp_mask=0x%x, order=%d, oom_adj=%d, oom_score_adj=%d\n"
		and target_0.getEnclosingFunction() = func
}

predicate func_1(Function func) {
	exists(PointerFieldAccess target_1 |
		target_1.getTarget().getName()="oom_score_adj"
		and target_1.getQualifier().(PointerFieldAccess).getTarget().getName()="signal"
		and target_1.getQualifier().(PointerFieldAccess).getQualifier().(FunctionCall).getTarget().hasName("get_current")
		and target_1.getEnclosingFunction() = func)
}

from Function func, StringLiteral target_0
where
func_0(func, target_0)
and not func_1(func)
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
