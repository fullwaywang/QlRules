commit 18180a4550d08be4eb0387fe83f02f703f92d4e7
Author: Chuck Lever <chuck.lever@oracle.com>
Date:   Thu Apr 25 17:46:26 2024 -0400

    NFSD: Fix nfsd4_encode_fattr4() crasher
    
    Ensure that args.acl is initialized early. It is used in an
    unconditional call to kfree() on the way out of
    nfsd4_encode_fattr4().
    
    Reported-by: Scott Mayhew <smayhew@redhat.com>
    Fixes: 83ab8678ad0c ("NFSD: Add struct nfsd4_fattr_args")
    Signed-off-by: Chuck Lever <chuck.lever@oracle.com>

diff --git a/fs/nfsd/nfs4xdr.c b/fs/nfsd/nfs4xdr.c
index 1955481832e0..a644460f3a5e 100644
--- a/fs/nfsd/nfs4xdr.c
+++ b/fs/nfsd/nfs4xdr.c
@@ -3515,6 +3515,7 @@ nfsd4_encode_fattr4(struct svc_rqst *rqstp, struct xdr_stream *xdr,
 	args.exp = exp;
 	args.dentry = dentry;
 	args.ignore_crossmnt = (ignore_crossmnt != 0);
+	args.acl = NULL;
 
 	/*
 	 * Make a local copy of the attribute bitmap that can be modified.
@@ -3573,7 +3574,6 @@ nfsd4_encode_fattr4(struct svc_rqst *rqstp, struct xdr_stream *xdr,
 	} else
 		args.fhp = fhp;
 
-	args.acl = NULL;
 	if (attrmask[0] & FATTR4_WORD0_ACL) {
 		err = nfsd4_get_nfs4_acl(rqstp, dentry, &args.acl);
 		if (err == -EOPNOTSUPP)
