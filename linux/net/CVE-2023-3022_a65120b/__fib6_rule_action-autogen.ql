/**
 * @name linux-a65120bae4b7425a39c5783aa3d4fc29677eef0e-__fib6_rule_action
 * @id cpp/linux/a65120bae4b7425a39c5783aa3d4fc29677eef0e/--fib6-rule-action
 * @description linux-a65120bae4b7425a39c5783aa3d4fc29677eef0e-net/ipv6/fib6_rules.c-__fib6_rule_action CVE-2023-3022
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vrt_195) {
exists(AssignExpr target_0 |
	target_0.getLValue().(PointerFieldAccess).getTarget().getName()="rt6"
	and target_0.getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("fib6_result *")
	and target_0.getRValue().(VariableAccess).getTarget()=vrt_195)
}

/*predicate func_1(Parameter varg_192, VariableAccess target_1) {
	target_1.getTarget()=varg_192
}

*/
predicate func_2(Parameter varg_192, Variable vrt_195, VariableAccess target_2) {
	target_2.getTarget()=vrt_195
	and target_2.getParent().(AssignExpr).getRValue() = target_2
	and target_2.getParent().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="result"
	and target_2.getParent().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=varg_192
}

predicate func_3(Parameter varg_192, Variable vrt_195, AssignExpr target_3) {
	target_3.getLValue().(PointerFieldAccess).getTarget().getName()="result"
	and target_3.getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=varg_192
	and target_3.getRValue().(VariableAccess).getTarget()=vrt_195
}

from Function func, Parameter varg_192, Variable vrt_195, VariableAccess target_2, AssignExpr target_3
where
not func_0(vrt_195)
and func_2(varg_192, vrt_195, target_2)
and func_3(varg_192, vrt_195, target_3)
and varg_192.getType().hasName("fib_lookup_arg *")
and vrt_195.getType().hasName("rt6_info *")
and varg_192.getFunction() = func
and vrt_195.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
