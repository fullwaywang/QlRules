/**
 * @name linux-ac6e780070e30e4c35bd395acfe9191e6268bdd3-tcp_v6_do_rcv
 * @id cpp/linux/ac6e780070e30e4c35bd395acfe9191e6268bdd3/tcp-v6-do-rcv
 * @description linux-ac6e780070e30e4c35bd395acfe9191e6268bdd3-net/ipv6/tcp_ipv6.c-tcp_v6_do_rcv CVE-2016-8645
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vskb_1215, Parameter vsk_1215, FunctionCall target_0) {
	target_0.getTarget().hasName("sk_filter")
	and not target_0.getTarget().hasName("tcp_filter")
	and target_0.getArgument(0).(VariableAccess).getTarget()=vsk_1215
	and target_0.getArgument(1).(VariableAccess).getTarget()=vskb_1215
	and target_0.getParent().(IfStmt).getThen() instanceof GotoStmt
}

from Function func, Parameter vskb_1215, Parameter vsk_1215, FunctionCall target_0
where
func_0(vskb_1215, vsk_1215, target_0)
and vskb_1215.getType().hasName("sk_buff *")
and vsk_1215.getType().hasName("sock *")
and vskb_1215.getFunction() = func
and vsk_1215.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
