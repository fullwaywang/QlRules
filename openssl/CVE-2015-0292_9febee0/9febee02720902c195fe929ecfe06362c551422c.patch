commit 9febee02720902c195fe929ecfe06362c551422c	9febee02720902c195fe929ecfe06362c551422c
Author: Geoff Thorpe <geoff@openssl.org>
Date:   Sun May 4 18:44:14 2014 -0400

    evp: prevent underflow in base64 decoding
    
    This patch resolves RT ticket #2608.
    
    Thanks to Robert Dugal for originally spotting this, and to David
    Ramos for noticing that the ball had been dropped.
    
    Signed-off-by: Geoff Thorpe <geoff@openssl.org>

diff --git a/crypto/evp/encode.c b/crypto/evp/encode.c
index e8a521814a..69f7ccad69 100644
--- a/crypto/evp/encode.c
+++ b/crypto/evp/encode.c
@@ -324,6 +324,7 @@ int EVP_DecodeUpdate(EVP_ENCODE_CTX *ctx, unsigned char *out, int *outl,
 				v=EVP_DecodeBlock(out,d,n);
 				n=0;
 				if (v < 0) { rv=0; goto end; }
+				if (eof > v) { rv=-1; goto end; }
 				ret+=(v-eof);
 				}
 			else
