/**
 * @name linux-307c8de2b02344805ebead3440d8feed28f2f010-xennet_alloc_one_rx_buffer
 * @id cpp/linux/307c8de2b02344805ebead3440d8feed28f2f010/xennet-alloc-one-rx-buffer
 * @description linux-307c8de2b02344805ebead3440d8feed28f2f010-drivers/net/xen-netfront.c-xennet_alloc_one_rx_buffer CVE-2022-33740
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vqueue_263, FunctionCall target_0) {
	target_0.getTarget().hasName("page_pool_dev_alloc_pages")
	and not target_0.getTarget().hasName("page_pool_alloc_pages")
	and target_0.getArgument(0).(PointerFieldAccess).getTarget().getName()="page_pool"
	and target_0.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vqueue_263
	and target_0.getParent().(AssignExpr).getRValue() = target_0
	and target_0.getParent().(AssignExpr).getLValue().(VariableAccess).getTarget().getType().hasName("page *")
}

predicate func_1(Function func) {
exists(BitwiseOrExpr target_1 |
	target_1.getValue()="11040"
	and target_1.getParent().(FunctionCall).getParent().(AssignExpr).getRValue() instanceof FunctionCall
	and target_1.getEnclosingFunction() = func)
}

from Function func, Parameter vqueue_263, FunctionCall target_0
where
func_0(vqueue_263, target_0)
and not func_1(func)
and vqueue_263.getType().hasName("netfront_queue *")
and vqueue_263.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
