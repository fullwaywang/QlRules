/**
 * @name memcached-6987918e9a3094ec4fc8976f01f769f624d790fa-_process_request_metaflags
 * @id cpp/memcached/6987918e9a3094ec4fc8976f01f769f624d790fa/-process-request-metaflags
 * @description memcached-6987918e9a3094ec4fc8976f01f769f624d790fa-proxy_request.c-_process_request_metaflags CVE-2023-46853
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vpr_123, PointerFieldAccess target_0) {
		target_0.getTarget().getName()="reqlen"
		and target_0.getQualifier().(VariableAccess).getTarget()=vpr_123
}

predicate func_1(Parameter vpr_123, PointerArithmeticOperation target_1) {
		target_1.getLeftOperand().(PointerArithmeticOperation).getAnOperand().(PointerFieldAccess).getTarget().getName()="request"
		and target_1.getLeftOperand().(PointerArithmeticOperation).getAnOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vpr_123
		and target_1.getLeftOperand().(PointerArithmeticOperation).getAnOperand().(PointerFieldAccess).getTarget().getName()="reqlen"
		and target_1.getLeftOperand().(PointerArithmeticOperation).getAnOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vpr_123
		and target_1.getRightOperand().(Literal).getValue()="2"
}

from Function func, Parameter vpr_123, PointerFieldAccess target_0, PointerArithmeticOperation target_1
where
func_0(vpr_123, target_0)
and func_1(vpr_123, target_1)
and vpr_123.getType().hasName("mcp_parser_t *")
and vpr_123.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
