/**
 * @name linux-c929a230c84441e400c32e7b7b4ab763711fb63e-__alloc_and_insert_iova_range
 * @id cpp/linux/c929a230c84441e400c32e7b7b4ab763711fb63e/--alloc-and-insert-iova-range
 * @description linux-c929a230c84441e400c32e7b7b4ab763711fb63e-drivers/iommu/iova.c-__alloc_and_insert_iova_range CVE-2023-52910
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vcurr_iova_238, PointerFieldAccess target_0) {
	target_0.getTarget().getName()="pfn_hi"
	and target_0.getQualifier().(VariableAccess).getTarget()=vcurr_iova_238
}

predicate func_1(Variable vretry_pfn_240, VariableAccess target_1) {
	exists(AssignExpr obj_0 | obj_0=target_1.getParent() |
		obj_0.getRValue() = target_1
		and obj_0.getLValue().(VariableAccess).getTarget().getType().hasName("unsigned long")
	)
	and target_1.getTarget()=vretry_pfn_240
}

from Function func, Variable vcurr_iova_238, Variable vretry_pfn_240, PointerFieldAccess target_0, VariableAccess target_1
where
func_0(vcurr_iova_238, target_0)
and func_1(vretry_pfn_240, target_1)
and vcurr_iova_238.getType().hasName("iova *")
and vretry_pfn_240.getType().hasName("unsigned long")
and vcurr_iova_238.(LocalVariable).getFunction() = func
and vretry_pfn_240.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
