/**
 * @name chromium-79fc6aa09e7c3c502fb15befac2a140b65672888-printing__PrintPreviewDialogController__GetPrintPreviewForContents
 * @id cpp/chromium/79fc6aa09e7c3c502fb15befac2a140b65672888/printingprintpreviewdialogcontrollergetprintpreviewforcontents
 * @description chromium-79fc6aa09e7c3c502fb15befac2a140b65672888-chrome/browser/printing/print_preview_dialog_controller.cc-printing__PrintPreviewDialogController__GetPrintPreviewForContents CVE-2023-5852
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vcontents_242, Variable vit_248, BlockStmt target_4, ReferenceFieldAccess target_5) {
exists(FunctionCall target_0 |
	exists(ValueFieldAccess obj_0 | obj_0=target_0.getArgument(1) |
		exists(ReferenceFieldAccess obj_1 | obj_1=obj_0.getQualifier() |
			obj_1.getTarget().getName()="second"
			and obj_1.getQualifier().(VariableAccess).getTarget()=vit_248
		)
		and obj_0.getTarget().getName()="initiator"
	)
	and target_0.getTarget().hasName("operator==")
	and target_0.getArgument(0).(VariableAccess).getTarget()=vcontents_242
	and target_0.getParent().(IfStmt).getThen()=target_4
	and target_0.getArgument(1).(ValueFieldAccess).getQualifier().(ReferenceFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_5.getQualifier().(VariableAccess).getLocation())
)
}

predicate func_1(Variable vit_248, VariableAccess target_1) {
	target_1.getTarget()=vit_248
}

predicate func_2(Parameter vcontents_242, BlockStmt target_4, VariableAccess target_2) {
	exists(EQExpr obj_0 | obj_0=target_2.getParent() |
		obj_0.getRightOperand() instanceof ReferenceFieldAccess
		and obj_0.getParent().(IfStmt).getThen()=target_4
	)
	and target_2.getTarget()=vcontents_242
}

predicate func_3(Parameter vcontents_242, Variable vit_248, BlockStmt target_4, EqualityOperation target_3) {
	exists(ReferenceFieldAccess obj_0 | obj_0=target_3.getRightOperand() |
		obj_0.getTarget().getName()="second"
		and obj_0.getQualifier().(VariableAccess).getTarget()=vit_248
	)
	and target_3.getLeftOperand().(VariableAccess).getTarget()=vcontents_242
	and target_3.getParent().(IfStmt).getThen()=target_4
}

predicate func_4(Variable vit_248, BlockStmt target_4) {
	exists(ReturnStmt obj_0 | obj_0=target_4.getStmt(0) |
		exists(ReferenceFieldAccess obj_1 | obj_1=obj_0.getExpr() |
			obj_1.getTarget().getName()="first"
			and obj_1.getQualifier().(VariableAccess).getTarget()=vit_248
		)
	)
}

predicate func_5(Variable vit_248, ReferenceFieldAccess target_5) {
	target_5.getTarget().getName()="first"
	and target_5.getQualifier().(VariableAccess).getTarget()=vit_248
}

from Function func, Parameter vcontents_242, Variable vit_248, VariableAccess target_1, VariableAccess target_2, EqualityOperation target_3, BlockStmt target_4, ReferenceFieldAccess target_5
where
not func_0(vcontents_242, vit_248, target_4, target_5)
and func_1(vit_248, target_1)
and func_2(vcontents_242, target_4, target_2)
and func_3(vcontents_242, vit_248, target_4, target_3)
and func_4(vit_248, target_4)
and func_5(vit_248, target_5)
and vcontents_242.getType().hasName("WebContents *")
and vit_248.getType().hasName("const value_type &")
and vcontents_242.getFunction() = func
and vit_248.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
