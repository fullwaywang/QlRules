/**
 * @name curl-5fc28510a4664f4-curl_url_set
 * @id cpp/curl/5fc28510a4664f4/curl-url-set
 * @description curl-5fc28510a4664f4-lib/urlapi.c-curl_url_set CVE-2019-5435
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vnalloc_1280, VariableAccess target_1, AddExpr target_3) {
	exists(IfStmt target_0 |
		target_0.getCondition().(RelationalOperation).getGreaterOperand().(VariableAccess).getTarget()=vnalloc_1280
		and target_0.getCondition().(RelationalOperation).getLesserOperand().(Literal).getValue()="8000000"
		and target_0.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(2)=target_0
		and target_0.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_1
		and target_0.getCondition().(RelationalOperation).getGreaterOperand().(VariableAccess).getLocation().isBefore(target_3.getAnOperand().(MulExpr).getLeftOperand().(VariableAccess).getLocation()))
}

predicate func_1(Variable vstorep_1117, VariableAccess target_1) {
		target_1.getTarget()=vstorep_1117
}

predicate func_3(Variable vnalloc_1280, AddExpr target_3) {
		target_3.getAnOperand().(MulExpr).getLeftOperand().(VariableAccess).getTarget()=vnalloc_1280
		and target_3.getAnOperand().(MulExpr).getRightOperand().(Literal).getValue()="3"
		and target_3.getAnOperand().(Literal).getValue()="1"
}

from Function func, Variable vstorep_1117, Variable vnalloc_1280, VariableAccess target_1, AddExpr target_3
where
not func_0(vnalloc_1280, target_1, target_3)
and func_1(vstorep_1117, target_1)
and func_3(vnalloc_1280, target_3)
and vstorep_1117.getType().hasName("char **")
and vnalloc_1280.getType().hasName("size_t")
and vstorep_1117.(LocalVariable).getFunction() = func
and vnalloc_1280.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
