commit d270c3202539e8364c46410e15f7570800e33343	d270c3202539e8364c46410e15f7570800e33343
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Fri Jan 18 01:28:44 2013 +0100

    avcodec_decode_audio: do not trust the channel layout, use the channel count.
    
    Fixes memory corruption
    
    Found-by: Mateusz "j00ru" Jurczyk and Gynvael Coldwind
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavcodec/utils.c b/libavcodec/utils.c
index 8c0aa9818e..12265a95ea 100644
--- a/libavcodec/utils.c
+++ b/libavcodec/utils.c
@@ -1809,7 +1809,7 @@ int attribute_align_arg avcodec_decode_audio4(AVCodecContext *avctx,
      * extended_data are doing it correctly */
     if (*got_frame_ptr) {
         planar   = av_sample_fmt_is_planar(frame->format);
-        channels = av_get_channel_layout_nb_channels(frame->channel_layout);
+        channels = frame->channels;
         if (!(planar && channels > AV_NUM_DATA_POINTERS))
             frame->extended_data = frame->data;
     } else {
