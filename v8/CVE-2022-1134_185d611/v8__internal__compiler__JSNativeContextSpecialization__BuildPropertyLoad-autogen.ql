/**
 * @name v8-185d6116ae7d7771c590f38be8b08530f979d226-v8__internal__compiler__JSNativeContextSpecialization__BuildPropertyLoad
 * @id cpp/v8/185d6116ae7d7771c590f38be8b08530f979d226/v8internalcompilerjsnativecontextspecializationbuildpropertyload
 * @description v8-185d6116ae7d7771c590f38be8b08530f979d226-src/compiler/js-native-context-specialization.cc-v8__internal__compiler__JSNativeContextSpecialization__BuildPropertyLoad CVE-2022-1134
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_1(Variable vvalue_2283, ExprStmt target_4, ConstructorCall target_5, Function func) {
exists(IfStmt target_1 |
	target_1.getCondition().(EqualityOperation).getLeftOperand().(VariableAccess).getTarget()=vvalue_2283
	and target_1.getCondition().(EqualityOperation).getRightOperand().(Literal).getValue()="0"
	and target_1.getThen().(BlockStmt).getStmt(0) instanceof ReturnStmt
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_1
	and target_1.getFollowingStmt() instanceof ReturnStmt
	and target_4.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_1.getCondition().(EqualityOperation).getLeftOperand().(VariableAccess).getLocation())
	and target_1.getCondition().(EqualityOperation).getLeftOperand().(VariableAccess).getLocation().isBefore(target_5.getArgument(0).(VariableAccess).getLocation()))
}

predicate func_3(Parameter veffect_2272, Parameter vcontrol_2272, Variable vvalue_2283, Function func, ReturnStmt target_3) {
	target_3.getExpr().(ConstructorCall).getArgument(0).(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=vvalue_2283
	and target_3.getExpr().(ConstructorCall).getArgument(0).(ConstructorCall).getArgument(1).(VariableAccess).getTarget()=veffect_2272
	and target_3.getExpr().(ConstructorCall).getArgument(0).(ConstructorCall).getArgument(2).(VariableAccess).getTarget()=vcontrol_2272
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_3
}

predicate func_4(Parameter veffect_2272, Parameter vcontrol_2272, Variable vvalue_2283, ExprStmt target_4) {
	target_4.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vvalue_2283
	and target_4.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("BuildLoadDataField")
	and target_4.getExpr().(AssignExpr).getRValue().(FunctionCall).getQualifier().(VariableAccess).getTarget().getType().hasName("PropertyAccessBuilder")
	and target_4.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("const NameRef &")
	and target_4.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("const PropertyAccessInfo &")
	and target_4.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("Node *")
	and target_4.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(3).(AddressOfExpr).getOperand().(VariableAccess).getTarget()=veffect_2272
	and target_4.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(4).(AddressOfExpr).getOperand().(VariableAccess).getTarget()=vcontrol_2272
}

predicate func_5(Parameter veffect_2272, Parameter vcontrol_2272, Variable vvalue_2283, ConstructorCall target_5) {
	target_5.getArgument(0).(VariableAccess).getTarget()=vvalue_2283
	and target_5.getArgument(1).(VariableAccess).getTarget()=veffect_2272
	and target_5.getArgument(2).(VariableAccess).getTarget()=vcontrol_2272
}

from Function func, Parameter veffect_2272, Parameter vcontrol_2272, Variable vvalue_2283, ReturnStmt target_3, ExprStmt target_4, ConstructorCall target_5
where
not func_1(vvalue_2283, target_4, target_5, func)
and func_3(veffect_2272, vcontrol_2272, vvalue_2283, func, target_3)
and func_4(veffect_2272, vcontrol_2272, vvalue_2283, target_4)
and func_5(veffect_2272, vcontrol_2272, vvalue_2283, target_5)
and veffect_2272.getType().hasName("Node *")
and vcontrol_2272.getType().hasName("Node *")
and vvalue_2283.getType().hasName("Node *")
and veffect_2272.getFunction() = func
and vcontrol_2272.getFunction() = func
and vvalue_2283.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
