commit 5944de192663f272033501dcd322b008fca72006
Author: Jia Jie Ho <jiajie.ho@starfivetech.com>
Date:   Mon Apr 29 14:06:39 2024 +0800

    crypto: starfive - Do not free stack buffer
    
    commit d7f01649f4eaf1878472d3d3f480ae1e50d98f6c upstream.
    
    RSA text data uses variable length buffer allocated in software stack.
    Calling kfree on it causes undefined behaviour in subsequent operations.
    
    Cc: <stable@vger.kernel.org> #6.7+
    Signed-off-by: Jia Jie Ho <jiajie.ho@starfivetech.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/crypto/starfive/jh7110-rsa.c b/drivers/crypto/starfive/jh7110-rsa.c
index cf8bda7f0855..7ec14b5b8490 100644
--- a/drivers/crypto/starfive/jh7110-rsa.c
+++ b/drivers/crypto/starfive/jh7110-rsa.c
@@ -273,7 +273,6 @@ static int starfive_rsa_enc_core(struct starfive_cryp_ctx *ctx, int enc)
 
 err_rsa_crypt:
 	writel(STARFIVE_RSA_RESET, cryp->base + STARFIVE_PKA_CACR_OFFSET);
-	kfree(rctx->rsa_data);
 	return ret;
 }
 
