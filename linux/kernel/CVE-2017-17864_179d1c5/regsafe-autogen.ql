/**
 * @name linux-179d1c5602997fef5a940c6ddcf31212cbfebd14-regsafe
 * @id cpp/linux/179d1c5602997fef5a940c6ddcf31212cbfebd14/regsafe
 * @description linux-179d1c5602997fef5a940c6ddcf31212cbfebd14-kernel/bpf/verifier.c-regsafe CVE-2017-17864
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_1(Parameter vrold_3448, LogicalAndExpr target_1) {
	target_1.getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getLeftOperand().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getTarget().getName()="umin_value"
	and target_1.getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getLeftOperand().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vrold_3448
	and target_1.getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getLeftOperand().(EqualityOperation).getRightOperand().(Literal).getValue()="0"
	and target_1.getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getRightOperand().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getTarget().getName()="umax_value"
	and target_1.getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getRightOperand().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vrold_3448
	and target_1.getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getRightOperand().(EqualityOperation).getRightOperand().(ComplementExpr).getValue()="18446744073709551615"
	and target_1.getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getRightOperand().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getTarget().getName()="smin_value"
	and target_1.getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getRightOperand().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vrold_3448
	and target_1.getLeftOperand().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getRightOperand().(EqualityOperation).getRightOperand().(SubExpr).getValue()="-9223372036854775808"
	and target_1.getLeftOperand().(LogicalAndExpr).getRightOperand().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getTarget().getName()="smax_value"
	and target_1.getLeftOperand().(LogicalAndExpr).getRightOperand().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vrold_3448
	and target_1.getLeftOperand().(LogicalAndExpr).getRightOperand().(EqualityOperation).getRightOperand().(BinaryBitwiseOperation).getValue()="9223372036854775807"
	and target_1.getRightOperand().(FunctionCall).getTarget().hasName("tnum_is_unknown")
	and target_1.getRightOperand().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="var_off"
	and target_1.getRightOperand().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vrold_3448
}

from Function func, Parameter vrold_3448, LogicalAndExpr target_1
where
func_1(vrold_3448, target_1)
and vrold_3448.getType().hasName("bpf_reg_state *")
and vrold_3448.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
