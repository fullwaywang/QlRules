/**
 * @name linux-423e0ab086ad8b33626e45fa94ac7613146b7ffa-anon_inode_init
 * @id cpp/linux/423e0ab086ad8b33626e45fa94ac7613146b7ffa/anon-inode-init
 * @description linux-423e0ab086ad8b33626e45fa94ac7613146b7ffa-fs/anon_inodes.c-anon_inode_init CVE-2012-2127
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vanon_inode_mnt, FunctionCall target_0) {
		target_0.getTarget().hasName("mntput")
		and not target_0.getTarget().hasName("kern_unmount")
		and target_0.getArgument(0).(VariableAccess).getTarget()=vanon_inode_mnt
}

from Function func, Variable vanon_inode_mnt, FunctionCall target_0
where
func_0(vanon_inode_mnt, target_0)
and vanon_inode_mnt.getType().hasName("vfsmount *")
and not vanon_inode_mnt.getParentScope+() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
