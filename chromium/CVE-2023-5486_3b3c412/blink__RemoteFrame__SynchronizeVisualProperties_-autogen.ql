/**
 * @name chromium-3b3c412dc32f81872e86337c998574e88036fd1b-blink__RemoteFrame__SynchronizeVisualProperties_
 * @id cpp/chromium/3b3c412dc32f81872e86337c998574e88036fd1b/blinkremoteframesynchronizevisualproperties
 * @description chromium-3b3c412dc32f81872e86337c998574e88036fd1b-third_party/blink/renderer/core/frame/web_frame_widget_impl.cc-blink__RemoteFrame__SynchronizeVisualProperties_ CVE-2023-5486
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func) {
exists(LogicalOrExpr target_0 |
	exists(EqualityOperation obj_0 | obj_0=target_0.getRightOperand() |
		exists(PointerFieldAccess obj_1 | obj_1=obj_0.getLeftOperand() |
			exists(FunctionCall obj_2 | obj_2=obj_1.getQualifier() |
				exists(PointerFieldAccess obj_3 | obj_3=obj_2.getQualifier() |
					obj_3.getTarget().getName()="sent_visual_properties_"
					and obj_3.getQualifier().(ThisExpr).getType() instanceof PointerType
				)
			)
			and obj_1.getTarget().getName()="cursor_accessibility_scale_factor"
		)
		and exists(ValueFieldAccess obj_4 | obj_4=obj_0.getRightOperand() |
			exists(PointerFieldAccess obj_5 | obj_5=obj_4.getQualifier() |
				obj_5.getTarget().getName()="pending_visual_properties_"
				and obj_5.getQualifier().(ThisExpr).getType() instanceof PointerType
			)
			and obj_4.getTarget().getName()="cursor_accessibility_scale_factor"
		)
	)
	and target_0.getLeftOperand() instanceof LogicalOrExpr
	and target_0.getEnclosingFunction() = func
)
}

predicate func_1(Function func, LogicalOrExpr target_1) {
	exists(LogicalOrExpr obj_0 | obj_0=target_1.getLeftOperand() |
		exists(LogicalOrExpr obj_1 | obj_1=obj_0.getLeftOperand() |
			exists(LogicalOrExpr obj_2 | obj_2=obj_1.getLeftOperand() |
				exists(LogicalOrExpr obj_3 | obj_3=obj_2.getLeftOperand() |
					exists(FunctionCall obj_4 | obj_4=obj_3.getRightOperand() |
						obj_4.getTarget().hasName("operator!=")
						and obj_4.getArgument(0).(FunctionCall).getTarget().hasName("size")
						and obj_4.getArgument(1).(FunctionCall).getTarget().hasName("size")
					)
					and obj_3.getLeftOperand().(LogicalOrExpr).getRightOperand().(FunctionCall).getTarget().hasName("operator!=")
				)
				and exists(FunctionCall obj_5 | obj_5=obj_2.getRightOperand() |
					exists(ValueFieldAccess obj_6 | obj_6=obj_5.getArgument(0) |
						obj_6.getTarget().getName()="screen_infos"
						and obj_6.getQualifier().(PointerFieldAccess).getTarget().getName()="pending_visual_properties_"
					)
					and obj_5.getTarget().hasName("operator!=")
					and obj_5.getQualifier().(PointerFieldAccess).getTarget().getName()="screen_infos"
				)
			)
			and exists(EqualityOperation obj_7 | obj_7=obj_1.getRightOperand() |
				exists(PointerFieldAccess obj_8 | obj_8=obj_7.getLeftOperand() |
					obj_8.getTarget().getName()="zoom_level"
					and obj_8.getQualifier().(FunctionCall).getQualifier().(PointerFieldAccess).getTarget().getName()="sent_visual_properties_"
				)
				and exists(ValueFieldAccess obj_9 | obj_9=obj_7.getRightOperand() |
					exists(PointerFieldAccess obj_10 | obj_10=obj_9.getQualifier() |
						obj_10.getTarget().getName()="pending_visual_properties_"
						and obj_10.getQualifier().(ThisExpr).getType() instanceof PointerType
					)
					and obj_9.getTarget().getName()="zoom_level"
				)
			)
		)
		and exists(EqualityOperation obj_11 | obj_11=obj_0.getRightOperand() |
			exists(PointerFieldAccess obj_12 | obj_12=obj_11.getLeftOperand() |
				exists(FunctionCall obj_13 | obj_13=obj_12.getQualifier() |
					exists(PointerFieldAccess obj_14 | obj_14=obj_13.getQualifier() |
						obj_14.getTarget().getName()="sent_visual_properties_"
						and obj_14.getQualifier().(ThisExpr).getType() instanceof PointerType
					)
				)
				and obj_12.getTarget().getName()="page_scale_factor"
			)
			and exists(ValueFieldAccess obj_15 | obj_15=obj_11.getRightOperand() |
				exists(PointerFieldAccess obj_16 | obj_16=obj_15.getQualifier() |
					obj_16.getTarget().getName()="pending_visual_properties_"
					and obj_16.getQualifier().(ThisExpr).getType() instanceof PointerType
				)
				and obj_15.getTarget().getName()="page_scale_factor"
			)
		)
	)
	and exists(EqualityOperation obj_17 | obj_17=target_1.getRightOperand() |
		exists(PointerFieldAccess obj_18 | obj_18=obj_17.getLeftOperand() |
			exists(FunctionCall obj_19 | obj_19=obj_18.getQualifier() |
				exists(PointerFieldAccess obj_20 | obj_20=obj_19.getQualifier() |
					obj_20.getTarget().getName()="sent_visual_properties_"
					and obj_20.getQualifier().(ThisExpr).getType() instanceof PointerType
				)
			)
			and obj_18.getTarget().getName()="compositing_scale_factor"
		)
		and exists(ValueFieldAccess obj_21 | obj_21=obj_17.getRightOperand() |
			exists(PointerFieldAccess obj_22 | obj_22=obj_21.getQualifier() |
				obj_22.getTarget().getName()="pending_visual_properties_"
				and obj_22.getQualifier().(ThisExpr).getType() instanceof PointerType
			)
			and obj_21.getTarget().getName()="compositing_scale_factor"
		)
	)
	and target_1.getEnclosingFunction() = func
}

from Function func, LogicalOrExpr target_1
where
not func_0(func)
and func_1(func, target_1)
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
