commit 4f5d33f4f798b1c6d92b613f0087f639d9836971
Author: Jay Vosburgh <jay.vosburgh@canonical.com>
Date:   Wed Aug 10 22:06:53 2022 -0700

    bonding: fix reference count leak in balance-alb mode
    
    Commit d5410ac7b0ba ("net:bonding:support balance-alb interface
    with vlan to bridge") introduced a reference count leak by not releasing
    the reference acquired by ip_dev_find().  Remedy this by insuring the
    reference is released.
    
    Fixes: d5410ac7b0ba ("net:bonding:support balance-alb interface with vlan to bridge")
    Signed-off-by: Jay Vosburgh <jay.vosburgh@canonical.com>
    Reviewed-by: Nikolay Aleksandrov <razor@blackwall.org>
    Link: https://lore.kernel.org/r/26758.1660194413@famine
    Signed-off-by: Jakub Kicinski <kuba@kernel.org>

diff --git a/drivers/net/bonding/bond_alb.c b/drivers/net/bonding/bond_alb.c
index 60cb9a0225aa..b9dbad3a8af8 100644
--- a/drivers/net/bonding/bond_alb.c
+++ b/drivers/net/bonding/bond_alb.c
@@ -668,8 +668,11 @@ static struct slave *rlb_arp_xmit(struct sk_buff *skb, struct bonding *bond)
 
 	dev = ip_dev_find(dev_net(bond->dev), arp->ip_src);
 	if (dev) {
-		if (netif_is_bridge_master(dev))
+		if (netif_is_bridge_master(dev)) {
+			dev_put(dev);
 			return NULL;
+		}
+		dev_put(dev);
 	}
 
 	if (arp->op_code == htons(ARPOP_REPLY)) {
