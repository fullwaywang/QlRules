/**
 * @name linux-5fdb55c1ac9585eb23bb2541d5819224429e103d-binder_transaction
 * @id cpp/linux/5fdb55c1ac9585eb23bb2541d5819224429e103d/binder-transaction
 * @description linux-5fdb55c1ac9585eb23bb2541d5819224429e103d-drivers/android/binder.c-binder_transaction CVE-2021-47360
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vreturn_error_line_2457, Literal target_0) {
	target_0.getValue()="2484"
	and not target_0.getValue()="2493"
	and target_0.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_1(Variable vreturn_error_line_2457, Literal target_1) {
	target_1.getValue()="2499"
	and not target_1.getValue()="2508"
	and target_1.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_2(Variable vreturn_error_line_2457, ExprStmt target_39, Literal target_2) {
	target_2.getValue()="2511"
	and not target_2.getValue()="2520"
	and target_2.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
	and target_39.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_2.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation())
}

predicate func_3(Variable vreturn_error_line_2457, Literal target_3) {
	target_3.getValue()="2523"
	and not target_3.getValue()="2532"
	and target_3.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_4(Variable vreturn_error_line_2457, Literal target_4) {
	target_4.getValue()="2570"
	and not target_4.getValue()="2579"
	and target_4.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_5(Variable vreturn_error_line_2457, Literal target_5) {
	target_5.getValue()="2579"
	and not target_5.getValue()="2588"
	and target_5.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_6(Variable vreturn_error_line_2457, Literal target_6) {
	target_6.getValue()="2586"
	and not target_6.getValue()="2595"
	and target_6.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_7(Variable vreturn_error_line_2457, Literal target_7) {
	target_7.getValue()="2593"
	and not target_7.getValue()="2602"
	and target_7.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_8(Variable vreturn_error_line_2457, Literal target_8) {
	target_8.getValue()="2616"
	and not target_8.getValue()="2625"
	and target_8.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_9(Variable vreturn_error_line_2457, Literal target_9) {
	target_9.getValue()="2635"
	and not target_9.getValue()="2644"
	and target_9.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_10(Variable vreturn_error_line_2457, Literal target_10) {
	target_10.getValue()="2664"
	and not target_10.getValue()="2673"
	and target_10.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_11(Variable vreturn_error_line_2457, Literal target_11) {
	target_11.getValue()="2675"
	and not target_11.getValue()="2684"
	and target_11.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_12(Variable vreturn_error_line_2457, Literal target_12) {
	target_12.getValue()="2730"
	and not target_12.getValue()="2739"
	and target_12.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_13(Variable vreturn_error_line_2457, Literal target_13) {
	target_13.getValue()="2739"
	and not target_13.getValue()="2748"
	and target_13.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_14(Variable vreturn_error_line_2457, Literal target_14) {
	target_14.getValue()="2756"
	and not target_14.getValue()="2765"
	and target_14.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_15(Variable vreturn_error_line_2457, Literal target_15) {
	target_15.getValue()="2794"
	and not target_15.getValue()="2803"
	and target_15.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_16(Variable vreturn_error_line_2457, Literal target_16) {
	target_16.getValue()="2808"
	and not target_16.getValue()="2817"
	and target_16.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_17(Variable vreturn_error_line_2457, Literal target_17) {
	target_17.getValue()="2816"
	and not target_17.getValue()="2825"
	and target_17.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_18(Variable vreturn_error_line_2457, Literal target_18) {
	target_18.getValue()="2825"
	and not target_18.getValue()="2834"
	and target_18.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_19(Variable vreturn_error_line_2457, Literal target_19) {
	target_19.getValue()="2849"
	and not target_19.getValue()="2858"
	and target_19.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_20(Variable vreturn_error_line_2457, Literal target_20) {
	target_20.getValue()="2862"
	and not target_20.getValue()="2871"
	and target_20.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_21(Variable vreturn_error_line_2457, Literal target_21) {
	target_21.getValue()="2883"
	and not target_21.getValue()="2892"
	and target_21.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_22(Variable vreturn_error_line_2457, Literal target_22) {
	target_22.getValue()="2900"
	and not target_22.getValue()="2909"
	and target_22.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_23(Variable vreturn_error_line_2457, Literal target_23) {
	target_23.getValue()="2920"
	and not target_23.getValue()="2929"
	and target_23.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_24(Variable vreturn_error_line_2457, Literal target_24) {
	target_24.getValue()="2942"
	and not target_24.getValue()="2951"
	and target_24.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_25(Variable vreturn_error_line_2457, Literal target_25) {
	target_25.getValue()="2955"
	and not target_25.getValue()="2964"
	and target_25.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_26(Variable vreturn_error_line_2457, Literal target_26) {
	target_26.getValue()="2963"
	and not target_26.getValue()="2972"
	and target_26.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_27(Variable vreturn_error_line_2457, Literal target_27) {
	target_27.getValue()="2981"
	and not target_27.getValue()="2990"
	and target_27.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_28(Variable vreturn_error_line_2457, Literal target_28) {
	target_28.getValue()="2995"
	and not target_28.getValue()="3004"
	and target_28.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_29(Variable vreturn_error_line_2457, Literal target_29) {
	target_29.getValue()="3017"
	and not target_29.getValue()="3026"
	and target_29.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_30(Variable vreturn_error_line_2457, Literal target_30) {
	target_30.getValue()="3028"
	and not target_30.getValue()="3037"
	and target_30.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_31(Variable vreturn_error_line_2457, Literal target_31) {
	target_31.getValue()="3098"
	and not target_31.getValue()="2588"
	and target_31.getParent().(AssignExpr).getParent().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
}

predicate func_32(Variable vreturn_error_line_2457, RelationalOperation target_40) {
exists(ExprStmt target_32 |
	target_32.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
	and target_32.getExpr().(AssignExpr).getRValue().(Literal).getValue()="2748"
	and target_32.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(2)=target_32
	and target_32.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_40)
}

predicate func_33(Variable vreturn_error_line_2457, NotExpr target_41) {
exists(ExprStmt target_33 |
	target_33.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
	and target_33.getExpr().(AssignExpr).getRValue().(Literal).getValue()="2834"
	and target_33.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(3)=target_33
	and target_33.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_41)
}

predicate func_34(Variable vreturn_error_line_2457, ExprStmt target_42, ExprStmt target_43, Function func) {
exists(ExprStmt target_34 |
	target_34.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
	and target_34.getExpr().(AssignExpr).getRValue().(Literal).getValue()="3107"
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_34
	and target_34.getLocation().isBefore(target_42.getLocation())
	and target_43.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_34.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation()))
}

predicate func_36(Variable vreturn_error_line_2457, NotExpr target_44, ExprStmt target_36) {
	target_36.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
	and target_36.getExpr().(AssignExpr).getRValue() instanceof Literal
	and target_36.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_44
}

predicate func_37(Variable vreturn_error_line_2457, NotExpr target_41, ExprStmt target_37) {
	target_37.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
	and target_37.getExpr().(AssignExpr).getRValue() instanceof Literal
	and target_37.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_41
}

predicate func_38(Variable vreturn_error_line_2457, RelationalOperation target_40, ExprStmt target_38) {
	target_38.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
	and target_38.getExpr().(AssignExpr).getRValue() instanceof Literal
	and target_38.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_40
}

predicate func_39(Variable vreturn_error_line_2457, ExprStmt target_39) {
	target_39.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
	and target_39.getExpr().(AssignExpr).getRValue() instanceof Literal
}

predicate func_40(Function func, RelationalOperation target_40) {
	 (target_40 instanceof GTExpr or target_40 instanceof LTExpr)
	and target_40.getLesserOperand().(VariableAccess).getTarget().getType().hasName("binder_size_t")
	and target_40.getGreaterOperand().(VariableAccess).getTarget().getType().hasName("size_t")
	and target_40.getEnclosingFunction() = func
}

predicate func_41(Function func, NotExpr target_41) {
	target_41.getOperand().(EqualityOperation).getLeftOperand().(BitwiseAndExpr).getLeftOperand().(VariableAccess).getTarget().getType().hasName("binder_size_t")
	and target_41.getOperand().(EqualityOperation).getLeftOperand().(BitwiseAndExpr).getRightOperand().(SubExpr).getValue()="7"
	and target_41.getOperand().(EqualityOperation).getRightOperand().(Literal).getValue()="0"
	and target_41.getEnclosingFunction() = func
}

predicate func_42(Variable vreturn_error_line_2457, ExprStmt target_42) {
	target_42.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
	and target_42.getExpr().(AssignExpr).getRValue() instanceof Literal
}

predicate func_43(Variable vreturn_error_line_2457, ExprStmt target_43) {
	target_43.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vreturn_error_line_2457
	and target_43.getExpr().(AssignExpr).getRValue() instanceof Literal
}

predicate func_44(Function func, NotExpr target_44) {
	target_44.getOperand().(VariableAccess).getTarget().getType().hasName("binder_node *")
	and target_44.getEnclosingFunction() = func
}

from Function func, Variable vreturn_error_line_2457, Literal target_0, Literal target_1, Literal target_2, Literal target_3, Literal target_4, Literal target_5, Literal target_6, Literal target_7, Literal target_8, Literal target_9, Literal target_10, Literal target_11, Literal target_12, Literal target_13, Literal target_14, Literal target_15, Literal target_16, Literal target_17, Literal target_18, Literal target_19, Literal target_20, Literal target_21, Literal target_22, Literal target_23, Literal target_24, Literal target_25, Literal target_26, Literal target_27, Literal target_28, Literal target_29, Literal target_30, Literal target_31, ExprStmt target_36, ExprStmt target_37, ExprStmt target_38, ExprStmt target_39, RelationalOperation target_40, NotExpr target_41, ExprStmt target_42, ExprStmt target_43, NotExpr target_44
where
func_0(vreturn_error_line_2457, target_0)
and func_1(vreturn_error_line_2457, target_1)
and func_2(vreturn_error_line_2457, target_39, target_2)
and func_3(vreturn_error_line_2457, target_3)
and func_4(vreturn_error_line_2457, target_4)
and func_5(vreturn_error_line_2457, target_5)
and func_6(vreturn_error_line_2457, target_6)
and func_7(vreturn_error_line_2457, target_7)
and func_8(vreturn_error_line_2457, target_8)
and func_9(vreturn_error_line_2457, target_9)
and func_10(vreturn_error_line_2457, target_10)
and func_11(vreturn_error_line_2457, target_11)
and func_12(vreturn_error_line_2457, target_12)
and func_13(vreturn_error_line_2457, target_13)
and func_14(vreturn_error_line_2457, target_14)
and func_15(vreturn_error_line_2457, target_15)
and func_16(vreturn_error_line_2457, target_16)
and func_17(vreturn_error_line_2457, target_17)
and func_18(vreturn_error_line_2457, target_18)
and func_19(vreturn_error_line_2457, target_19)
and func_20(vreturn_error_line_2457, target_20)
and func_21(vreturn_error_line_2457, target_21)
and func_22(vreturn_error_line_2457, target_22)
and func_23(vreturn_error_line_2457, target_23)
and func_24(vreturn_error_line_2457, target_24)
and func_25(vreturn_error_line_2457, target_25)
and func_26(vreturn_error_line_2457, target_26)
and func_27(vreturn_error_line_2457, target_27)
and func_28(vreturn_error_line_2457, target_28)
and func_29(vreturn_error_line_2457, target_29)
and func_30(vreturn_error_line_2457, target_30)
and func_31(vreturn_error_line_2457, target_31)
and not func_32(vreturn_error_line_2457, target_40)
and not func_33(vreturn_error_line_2457, target_41)
and not func_34(vreturn_error_line_2457, target_42, target_43, func)
and func_36(vreturn_error_line_2457, target_44, target_36)
and func_37(vreturn_error_line_2457, target_41, target_37)
and func_38(vreturn_error_line_2457, target_40, target_38)
and func_39(vreturn_error_line_2457, target_39)
and func_40(func, target_40)
and func_41(func, target_41)
and func_42(vreturn_error_line_2457, target_42)
and func_43(vreturn_error_line_2457, target_43)
and func_44(func, target_44)
and vreturn_error_line_2457.getType().hasName("uint32_t")
and vreturn_error_line_2457.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
