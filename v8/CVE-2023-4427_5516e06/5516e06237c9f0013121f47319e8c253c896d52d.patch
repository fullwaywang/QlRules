commit 5516e06237c9f0013121f47319e8c253c896d52d	5516e06237c9f0013121f47319e8c253c896d52d
Author: Olivier Flückiger <olivf@chromium.org>
Date:   Mon Aug 14 09:05:22 2023 +0200

    [runtime] Don't try to create empty enum cache.
    
    When copying maps and the new map has no enumerable properties we
    should not try to initialize an enum cache.
    
    This happens if the deprecation is due to making the only property in
    a map non enumerable.
    
    Bug: chromium:1472317, chromium:1470668
    Change-Id: I7a6af63e50dc30592e2caacce0caccfb31f534cf
    Reviewed-on: https://chromium-review.googlesource.com/c/v8/v8/+/4775581
    Reviewed-by: Tobias Tebbi <tebbi@chromium.org>
    Commit-Queue: Olivier Flückiger <olivf@chromium.org>
    Cr-Commit-Position: refs/heads/main@{#89534}

diff --git a/src/objects/map-updater.cc b/src/objects/map-updater.cc
index 7a864d98800..9c204911dcf 100644
--- a/src/objects/map-updater.cc
+++ b/src/objects/map-updater.cc
@@ -1040,7 +1040,8 @@ MapUpdater::State MapUpdater::ConstructNewMap() {
   split_map->ReplaceDescriptors(isolate_, *new_descriptors);
 
   // If the old descriptors had an enum cache, make sure the new ones do too.
-  if (old_descriptors_->enum_cache()->keys()->length() > 0) {
+  if (old_descriptors_->enum_cache()->keys()->length() > 0 &&
+      new_map->NumberOfEnumerableProperties() > 0) {
     FastKeyAccumulator::InitializeFastPropertyEnumCache(
         isolate_, new_map, new_map->NumberOfEnumerableProperties());
   }
