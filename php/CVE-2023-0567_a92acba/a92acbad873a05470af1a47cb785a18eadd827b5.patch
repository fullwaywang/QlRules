commit a92acbad873a05470af1a47cb785a18eadd827b5
Author: Tim DÃ¼sterhus <tim@bastelstu.be>
Date:   Mon Jan 23 22:13:57 2023 +0100

    crypt: Fix possible buffer overread in php_crypt()

diff --git a/ext/standard/crypt.c b/ext/standard/crypt.c
index 8c105cf910..8316c8b960 100644
--- a/ext/standard/crypt.c
+++ b/ext/standard/crypt.c
@@ -135,6 +135,7 @@ PHPAPI zend_string *php_crypt(const char *password, const int pass_len, const ch
 		} else if (
 				salt[0] == '$' &&
 				salt[1] == '2' &&
+				salt[2] != 0 &&
 				salt[3] == '$') {
 			char output[PHP_MAX_SALT_LEN + 1];
 
diff --git a/ext/standard/tests/password/password_bcrypt_short.phpt b/ext/standard/tests/password/password_bcrypt_short.phpt
new file mode 100644
index 0000000000..085bc8a239
--- /dev/null
+++ b/ext/standard/tests/password/password_bcrypt_short.phpt
@@ -0,0 +1,8 @@
+--TEST--
+Test that password_hash() does not overread buffers when a short hash is passed
+--FILE--
+<?php
+var_dump(password_verify("foo", '$2'));
+?>
+--EXPECT--
+bool(false)
