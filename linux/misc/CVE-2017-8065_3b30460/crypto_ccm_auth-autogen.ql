/**
 * @name linux-3b30460c5b0ed762be75a004e924ec3f8711e032-crypto_ccm_auth
 * @id cpp/linux/3b30460c5b0ed762be75a004e924ec3f8711e032/crypto-ccm-auth
 * @description linux-3b30460c5b0ed762be75a004e924ec3f8711e032-crypto/ccm.c-crypto_ccm_auth CVE-2017-8065
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_10(Variable vodata_1_186, VariableAccess target_10) {
	target_10.getTarget()=vodata_1_186
	and target_10.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("format_input")
	and target_10.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("aead_request *")
	and target_10.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("unsigned int")
}

predicate func_11(Variable vodata_1_186, VariableAccess target_11) {
	target_11.getTarget()=vodata_1_186
	and target_11.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("sg_set_buf")
	and target_11.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ArrayExpr).getArrayBase().(VariableAccess).getTarget().getType().hasName("scatterlist[3]")
	and target_11.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ArrayExpr).getArrayOffset().(Literal).getValue()="0"
	and target_11.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(Literal).getValue()="16"
}

predicate func_12(Variable vidata_1_187, VariableAccess target_12) {
	target_12.getTarget()=vidata_1_187
	and target_12.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("format_adata")
	and target_12.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("unsigned int")
}

predicate func_13(Variable vidata_1_187, VariableAccess target_13) {
	target_13.getTarget()=vidata_1_187
	and target_13.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("sg_set_buf")
	and target_13.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ArrayExpr).getArrayBase().(VariableAccess).getTarget().getType().hasName("scatterlist[3]")
	and target_13.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ArrayExpr).getArrayOffset().(Literal).getValue()="1"
	and target_13.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("int")
}

predicate func_14(Variable vidata_1_187, VariableAccess target_14) {
	target_14.getTarget()=vidata_1_187
	and target_14.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__memset")
	and target_14.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(Literal).getValue()="0"
	and target_14.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("int")
}

predicate func_15(Variable vidata_1_187, VariableAccess target_15) {
	target_15.getTarget()=vidata_1_187
	and target_15.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("sg_set_buf")
	and target_15.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ArrayExpr).getArrayBase().(VariableAccess).getTarget().getType().hasName("scatterlist[3]")
	and target_15.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ArrayExpr).getArrayOffset().(Literal).getValue()="0"
	and target_15.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("int")
}

from Function func, Variable vodata_1_186, Variable vidata_1_187, VariableAccess target_10, VariableAccess target_11, VariableAccess target_12, VariableAccess target_13, VariableAccess target_14, VariableAccess target_15
where
func_10(vodata_1_186, target_10)
and func_11(vodata_1_186, target_11)
and func_12(vidata_1_187, target_12)
and func_13(vidata_1_187, target_13)
and func_14(vidata_1_187, target_14)
and func_15(vidata_1_187, target_15)
and vodata_1_186.getType().hasName("u8[16]")
and vidata_1_187.getType().hasName("u8[16]")
and vodata_1_186.(LocalVariable).getFunction() = func
and vidata_1_187.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
