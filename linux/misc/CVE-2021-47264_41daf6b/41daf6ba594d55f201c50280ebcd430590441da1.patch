commit 41daf6ba594d55f201c50280ebcd430590441da1
Author: Kefeng Wang <wangkefeng.wang@huawei.com>
Date:   Mon May 24 10:49:41 2021 +0800

    ASoC: core: Fix Null-point-dereference in fmt_single_name()
    
    Check the return value of devm_kstrdup() in case of
    Null-point-dereference.
    
    Fixes: 45dd9943fce0 ("ASoC: core: remove artificial component and DAI name constraint")
    Cc: Dmitry Baryshkov <dmitry.baryshkov@linaro.org>
    Reported-by: Hulk Robot <hulkci@huawei.com>
    Signed-off-by: Kefeng Wang <wangkefeng.wang@huawei.com>
    Link: https://lore.kernel.org/r/20210524024941.159952-1-wangkefeng.wang@huawei.com
    Signed-off-by: Mark Brown <broonie@kernel.org>

diff --git a/sound/soc/soc-core.c b/sound/soc/soc-core.c
index 1c0904acb935..a76974ccfce1 100644
--- a/sound/soc/soc-core.c
+++ b/sound/soc/soc-core.c
@@ -2225,6 +2225,8 @@ static char *fmt_single_name(struct device *dev, int *id)
 		return NULL;
 
 	name = devm_kstrdup(dev, devname, GFP_KERNEL);
+	if (!name)
+		return NULL;
 
 	/* are we a "%s.%d" name (platform and SPI components) */
 	found = strstr(name, dev->driver->name);
