/**
 * @name linux-9ca9fb24d5febccea354089c41f96a8ad0d853f8-io_poll_task_func
 * @id cpp/linux/9ca9fb24d5febccea354089c41f96a8ad0d853f8/io-poll-task-func
 * @description linux-9ca9fb24d5febccea354089c41f96a8ad0d853f8-io_uring/poll.c-io_poll_task_func CVE-2023-3389
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vreq_218, Variable vctx_220, FunctionCall target_0) {
		target_0.getTarget().hasName("io_poll_req_delete")
		and not target_0.getTarget().hasName("io_poll_tw_hash_eject")
		and target_0.getArgument(0).(VariableAccess).getTarget()=vreq_218
		and target_0.getArgument(1).(VariableAccess).getTarget()=vctx_220
}

predicate func_2(Function func, DeclStmt target_2) {
		func.getEntryPoint().(BlockStmt).getAStmt()=target_2
}

from Function func, Parameter vreq_218, Variable vctx_220, FunctionCall target_0, DeclStmt target_2
where
func_0(vreq_218, vctx_220, target_0)
and func_2(func, target_2)
and vreq_218.getType().hasName("io_kiocb *")
and vctx_220.getType().hasName("io_ring_ctx *")
and vreq_218.getFunction() = func
and vctx_220.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
