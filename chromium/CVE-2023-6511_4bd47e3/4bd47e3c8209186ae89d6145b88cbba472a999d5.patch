commit 4bd47e3c8209186ae89d6145b88cbba472a999d5	4bd47e3c8209186ae89d6145b88cbba472a999d5
Author: Jan Keitel <jkeitel@google.com>
Date:   Mon Jan 22 13:08:46 2024 +0000

    Clean up kAutofillPopupMultiWindowCursorSuppression feature.
    
    The feature was default-enabled on M120 and can be cleaned up. It only
    served as a kill-switch in the first place.
    
    Bug: 1478613
    Change-Id: I2eff5cb232ed99d135169d2daf493e5474f0dd49
    Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/5222563
    Auto-Submit: Jan Keitel <jkeitel@google.com>
    Reviewed-by: Bruno Braga <brunobraga@google.com>
    Commit-Queue: Bruno Braga <brunobraga@google.com>
    Cr-Commit-Position: refs/heads/main@{#1250130}

diff --git a/chrome/browser/ui/views/autofill/popup/popup_base_view.cc b/chrome/browser/ui/views/autofill/popup/popup_base_view.cc
index ad66015dd1fed..9efc2e07ef108 100644
--- a/chrome/browser/ui/views/autofill/popup/popup_base_view.cc
+++ b/chrome/browser/ui/views/autofill/popup/popup_base_view.cc
@@ -13,7 +13,6 @@
 #include "base/functional/bind.h"
 #include "base/i18n/rtl.h"
 #include "base/location.h"
-#include "base/task/single_thread_task_runner.h"
 #include "chrome/browser/platform_util.h"
 #include "chrome/browser/themes/theme_service.h"
 #include "chrome/browser/ui/browser_finder.h"
@@ -255,14 +254,8 @@ bool PopupBaseView::DoShow() {
   }
 
   if (content::WebContents* web_contents = GetWebContents()) {
-    if (base::FeatureList::IsEnabled(
-            features::kAutofillPopupMultiWindowCursorSuppression)) {
-      custom_cursor_suppressor_.Start(
-          /*max_dimension_dips=*/kMaximumAllowedCustomCursorDimension + 1);
-    } else {
-      custom_cursor_blocker_ = web_contents->CreateDisallowCustomCursorScope(
-          /*max_dimension_dips=*/kMaximumAllowedCustomCursorDimension + 1);
-    }
+    custom_cursor_suppressor_.Start(
+        /*max_dimension_dips=*/kMaximumAllowedCustomCursorDimension + 1);
   } else {
     // `delegate_` is already gone and `WebContents` is destroying itself.
     return false;
diff --git a/chrome/browser/ui/views/autofill/popup/popup_base_view.h b/chrome/browser/ui/views/autofill/popup/popup_base_view.h
index 37ecd999d4d70..47890edbd6195 100644
--- a/chrome/browser/ui/views/autofill/popup/popup_base_view.h
+++ b/chrome/browser/ui/views/autofill/popup/popup_base_view.h
@@ -6,7 +6,6 @@
 #define CHROME_BROWSER_UI_VIEWS_AUTOFILL_POPUP_POPUP_BASE_VIEW_H_
 
 #include <array>
-#include <memory>
 #include <vector>
 
 #include "base/containers/span.h"
@@ -155,13 +154,6 @@ class PopupBaseView : public PopupRowView::AccessibilitySelectionDelegate,
   // Ensures that the menu start event is not fired redundantly.
   bool is_ax_menu_start_event_fired_ = false;
 
-  // Responsible for re-enabling custom cursors in the triggered tab on popup
-  // destruction.
-  // TODO(crbug.com/1478613): Remove once
-  // `kAutofillPopupMultiWindowCursorSuppression` is removed, since it is
-  // superseded by `custom_cursor_suppressor_`.
-  base::ScopedClosureRunner custom_cursor_blocker_;
-
   // Responsible for blocking (and re-enabling) custom cursors across all
   // browser windows.
   CustomCursorSuppressor custom_cursor_suppressor_;
diff --git a/components/autofill/core/common/autofill_features.cc b/components/autofill/core/common/autofill_features.cc
index fa9a74cbcb1e3..557d605cb9ffb 100644
--- a/components/autofill/core/common/autofill_features.cc
+++ b/components/autofill/core/common/autofill_features.cc
@@ -455,9 +455,7 @@ BASE_FEATURE(kAutofillPopupDoesNotOverlapWithContextMenu,
              base::FEATURE_DISABLED_BY_DEFAULT);
 
 // If the feature is enabled, then custom cursor exceeding the (24 dips)
-// dimension limit are disallowed in extension-hosted content. This feature is
-// dependent on `kAutofillPopupMultiWindowCursorSuppression` - if the latter is
-// disabled, so is this.
+// dimension limit are disallowed in extension-hosted content.
 BASE_FEATURE(kAutofillPopupExtensionCursorSuppression,
              "AutofillPopupExtensionCursorSuppression",
              base::FEATURE_ENABLED_BY_DEFAULT);
@@ -471,12 +469,6 @@ BASE_FEATURE(kAutofillPopupImprovedTimingChecks,
              "AutofillPopupImprovedTimingChecks",
              base::FEATURE_DISABLED_BY_DEFAULT);
 
-// If the feature is enabled, custom cursors exceeding the (24 dips) dimension
-// limit are disallowed for all active tabs in all active windows.
-BASE_FEATURE(kAutofillPopupMultiWindowCursorSuppression,
-             "AutofillPopupMultiWindowCursorSuppression",
-             base::FEATURE_ENABLED_BY_DEFAULT);
-
 // Controls whether the threshold for accepting Autofill popup suggestions
 // should take into account latency information of the user event.
 BASE_FEATURE(kAutofillPopupUseLatencyInformationForAcceptThreshold,
diff --git a/components/autofill/core/common/autofill_features.h b/components/autofill/core/common/autofill_features.h
index 35e0009aaac75..60af8426c1a6a 100644
--- a/components/autofill/core/common/autofill_features.h
+++ b/components/autofill/core/common/autofill_features.h
@@ -150,8 +150,6 @@ BASE_DECLARE_FEATURE(kAutofillPopupExtensionCursorSuppression);
 COMPONENT_EXPORT(AUTOFILL)
 BASE_DECLARE_FEATURE(kAutofillPopupImprovedTimingChecks);
 COMPONENT_EXPORT(AUTOFILL)
-BASE_DECLARE_FEATURE(kAutofillPopupMultiWindowCursorSuppression);
-COMPONENT_EXPORT(AUTOFILL)
 BASE_DECLARE_FEATURE(kAutofillPopupUseLatencyInformationForAcceptThreshold);
 COMPONENT_EXPORT(AUTOFILL)
 BASE_DECLARE_FEATURE(kAutofillPreferLabelsInSomeCountries);
