/**
 * @name linux-49c47cc21b5b7a3d8deb18fc57b0aa2ab1286962-do_tls_getsockopt_conf
 * @id cpp/linux/49c47cc21b5b7a3d8deb18fc57b0aa2ab1286962/do-tls-getsockopt-conf
 * @description linux-49c47cc21b5b7a3d8deb18fc57b0aa2ab1286962-net/tls/tls_main.c-do_tls_getsockopt_conf CVE-2023-28466
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func, StringLiteral target_0) {
		target_0.getValue()="field \"crypto_info_aes_gcm_128->iv\" at net/tls/tls_main.c:411"
		and not target_0.getValue()="field \"crypto_info_aes_gcm_128->iv\" at net/tls/tls_main.c:410"
		and target_0.getEnclosingFunction() = func
}

predicate func_1(Function func, StringLiteral target_1) {
		target_1.getValue()="field \"crypto_info_aes_gcm_128->rec_seq\" at net/tls/tls_main.c:413"
		and not target_1.getValue()="field \"crypto_info_aes_gcm_128->rec_seq\" at net/tls/tls_main.c:412"
		and target_1.getEnclosingFunction() = func
}

predicate func_2(Function func, StringLiteral target_2) {
		target_2.getValue()="field \"crypto_info_aes_gcm_256->iv\" at net/tls/tls_main.c:435"
		and not target_2.getValue()="field \"crypto_info_aes_gcm_256->iv\" at net/tls/tls_main.c:432"
		and target_2.getEnclosingFunction() = func
}

predicate func_3(Function func, StringLiteral target_3) {
		target_3.getValue()="field \"crypto_info_aes_gcm_256->rec_seq\" at net/tls/tls_main.c:437"
		and not target_3.getValue()="field \"crypto_info_aes_gcm_256->rec_seq\" at net/tls/tls_main.c:434"
		and target_3.getEnclosingFunction() = func
}

predicate func_4(Function func, StringLiteral target_4) {
		target_4.getValue()="field \"aes_ccm_128->iv\" at net/tls/tls_main.c:457"
		and not target_4.getValue()="field \"aes_ccm_128->iv\" at net/tls/tls_main.c:452"
		and target_4.getEnclosingFunction() = func
}

predicate func_5(Function func, StringLiteral target_5) {
		target_5.getValue()="field \"aes_ccm_128->rec_seq\" at net/tls/tls_main.c:459"
		and not target_5.getValue()="field \"aes_ccm_128->rec_seq\" at net/tls/tls_main.c:454"
		and target_5.getEnclosingFunction() = func
}

predicate func_6(Function func, StringLiteral target_6) {
		target_6.getValue()="field \"chacha20_poly1305->iv\" at net/tls/tls_main.c:478"
		and not target_6.getValue()="field \"chacha20_poly1305->iv\" at net/tls/tls_main.c:471"
		and target_6.getEnclosingFunction() = func
}

predicate func_7(Function func, StringLiteral target_7) {
		target_7.getValue()="field \"chacha20_poly1305->rec_seq\" at net/tls/tls_main.c:480"
		and not target_7.getValue()="field \"chacha20_poly1305->rec_seq\" at net/tls/tls_main.c:473"
		and target_7.getEnclosingFunction() = func
}

predicate func_8(Function func, StringLiteral target_8) {
		target_8.getValue()="field \"sm4_gcm_info->iv\" at net/tls/tls_main.c:499"
		and not target_8.getValue()="field \"sm4_gcm_info->iv\" at net/tls/tls_main.c:490"
		and target_8.getEnclosingFunction() = func
}

predicate func_9(Function func, StringLiteral target_9) {
		target_9.getValue()="field \"sm4_gcm_info->rec_seq\" at net/tls/tls_main.c:501"
		and not target_9.getValue()="field \"sm4_gcm_info->rec_seq\" at net/tls/tls_main.c:492"
		and target_9.getEnclosingFunction() = func
}

predicate func_10(Function func, StringLiteral target_10) {
		target_10.getValue()="field \"sm4_ccm_info->iv\" at net/tls/tls_main.c:519"
		and not target_10.getValue()="field \"sm4_ccm_info->iv\" at net/tls/tls_main.c:508"
		and target_10.getEnclosingFunction() = func
}

predicate func_11(Function func, StringLiteral target_11) {
		target_11.getValue()="field \"sm4_ccm_info->rec_seq\" at net/tls/tls_main.c:521"
		and not target_11.getValue()="field \"sm4_ccm_info->rec_seq\" at net/tls/tls_main.c:510"
		and target_11.getEnclosingFunction() = func
}

predicate func_12(Function func, StringLiteral target_12) {
		target_12.getValue()="field \"crypto_info_aria_gcm_128->iv\" at net/tls/tls_main.c:541"
		and not target_12.getValue()="field \"crypto_info_aria_gcm_128->iv\" at net/tls/tls_main.c:528"
		and target_12.getEnclosingFunction() = func
}

predicate func_13(Function func, StringLiteral target_13) {
		target_13.getValue()="field \"crypto_info_aria_gcm_128->rec_seq\" at net/tls/tls_main.c:543"
		and not target_13.getValue()="field \"crypto_info_aria_gcm_128->rec_seq\" at net/tls/tls_main.c:530"
		and target_13.getEnclosingFunction() = func
}

predicate func_14(Function func, StringLiteral target_14) {
		target_14.getValue()="field \"crypto_info_aria_gcm_256->iv\" at net/tls/tls_main.c:565"
		and not target_14.getValue()="field \"crypto_info_aria_gcm_256->iv\" at net/tls/tls_main.c:550"
		and target_14.getEnclosingFunction() = func
}

predicate func_15(Function func, StringLiteral target_15) {
		target_15.getValue()="field \"crypto_info_aria_gcm_256->rec_seq\" at net/tls/tls_main.c:567"
		and not target_15.getValue()="field \"crypto_info_aria_gcm_256->rec_seq\" at net/tls/tls_main.c:552"
		and target_15.getEnclosingFunction() = func
}

predicate func_16(Parameter vsk_354, FunctionCall target_32, ExprStmt target_17, ExprStmt target_16) {
		target_16.getExpr().(FunctionCall).getTarget().hasName("lock_sock")
		and target_16.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_32.getArgument(0).(VariableAccess).getLocation().isBefore(target_16.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_16.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_17.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_17(Parameter vsk_354, ExprStmt target_16, ExprStmt target_18, ExprStmt target_17) {
		target_17.getExpr().(FunctionCall).getTarget().hasName("release_sock")
		and target_17.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_16.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_17.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_17.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_18.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_18(Parameter vsk_354, ExprStmt target_17, ExprStmt target_19, ExprStmt target_18) {
		target_18.getExpr().(FunctionCall).getTarget().hasName("lock_sock")
		and target_18.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_17.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_18.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_18.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_19.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_19(Parameter vsk_354, ExprStmt target_18, ExprStmt target_20, ExprStmt target_19) {
		target_19.getExpr().(FunctionCall).getTarget().hasName("release_sock")
		and target_19.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_18.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_19.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_19.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_20.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_20(Parameter vsk_354, ExprStmt target_19, ExprStmt target_21, ExprStmt target_20) {
		target_20.getExpr().(FunctionCall).getTarget().hasName("lock_sock")
		and target_20.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_19.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_20.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_20.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_21.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_21(Parameter vsk_354, ExprStmt target_20, ExprStmt target_22, ExprStmt target_21) {
		target_21.getExpr().(FunctionCall).getTarget().hasName("release_sock")
		and target_21.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_20.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_21.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_21.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_22.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_22(Parameter vsk_354, ExprStmt target_21, ExprStmt target_23, ExprStmt target_22) {
		target_22.getExpr().(FunctionCall).getTarget().hasName("lock_sock")
		and target_22.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_21.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_22.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_22.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_23.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_23(Parameter vsk_354, ExprStmt target_22, ExprStmt target_24, ExprStmt target_23) {
		target_23.getExpr().(FunctionCall).getTarget().hasName("release_sock")
		and target_23.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_22.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_23.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_23.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_24.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_24(Parameter vsk_354, ExprStmt target_23, ExprStmt target_25, ExprStmt target_24) {
		target_24.getExpr().(FunctionCall).getTarget().hasName("lock_sock")
		and target_24.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_23.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_24.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_24.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_25.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_25(Parameter vsk_354, ExprStmt target_24, ExprStmt target_26, ExprStmt target_25) {
		target_25.getExpr().(FunctionCall).getTarget().hasName("release_sock")
		and target_25.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_24.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_25.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_25.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_26.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_26(Parameter vsk_354, ExprStmt target_25, ExprStmt target_27, ExprStmt target_26) {
		target_26.getExpr().(FunctionCall).getTarget().hasName("lock_sock")
		and target_26.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_25.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_26.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_26.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_27.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_27(Parameter vsk_354, ExprStmt target_26, ExprStmt target_28, ExprStmt target_27) {
		target_27.getExpr().(FunctionCall).getTarget().hasName("release_sock")
		and target_27.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_26.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_27.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_27.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_28.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_28(Parameter vsk_354, ExprStmt target_27, ExprStmt target_29, ExprStmt target_28) {
		target_28.getExpr().(FunctionCall).getTarget().hasName("lock_sock")
		and target_28.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_27.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_28.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_28.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_29.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_29(Parameter vsk_354, ExprStmt target_28, ExprStmt target_30, ExprStmt target_29) {
		target_29.getExpr().(FunctionCall).getTarget().hasName("release_sock")
		and target_29.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_28.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_29.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_29.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_30.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_30(Parameter vsk_354, ExprStmt target_29, ExprStmt target_31, ExprStmt target_30) {
		target_30.getExpr().(FunctionCall).getTarget().hasName("lock_sock")
		and target_30.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_29.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_30.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
		and target_30.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_31.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_31(Parameter vsk_354, ExprStmt target_30, ExprStmt target_31) {
		target_31.getExpr().(FunctionCall).getTarget().hasName("release_sock")
		and target_31.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsk_354
		and target_30.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_31.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
}

predicate func_32(Parameter vsk_354, FunctionCall target_32) {
		target_32.getTarget().hasName("tls_get_ctx")
		and target_32.getArgument(0).(VariableAccess).getTarget()=vsk_354
}

from Function func, Parameter vsk_354, StringLiteral target_0, StringLiteral target_1, StringLiteral target_2, StringLiteral target_3, StringLiteral target_4, StringLiteral target_5, StringLiteral target_6, StringLiteral target_7, StringLiteral target_8, StringLiteral target_9, StringLiteral target_10, StringLiteral target_11, StringLiteral target_12, StringLiteral target_13, StringLiteral target_14, StringLiteral target_15, ExprStmt target_16, ExprStmt target_17, ExprStmt target_18, ExprStmt target_19, ExprStmt target_20, ExprStmt target_21, ExprStmt target_22, ExprStmt target_23, ExprStmt target_24, ExprStmt target_25, ExprStmt target_26, ExprStmt target_27, ExprStmt target_28, ExprStmt target_29, ExprStmt target_30, ExprStmt target_31, FunctionCall target_32
where
func_0(func, target_0)
and func_1(func, target_1)
and func_2(func, target_2)
and func_3(func, target_3)
and func_4(func, target_4)
and func_5(func, target_5)
and func_6(func, target_6)
and func_7(func, target_7)
and func_8(func, target_8)
and func_9(func, target_9)
and func_10(func, target_10)
and func_11(func, target_11)
and func_12(func, target_12)
and func_13(func, target_13)
and func_14(func, target_14)
and func_15(func, target_15)
and func_16(vsk_354, target_32, target_17, target_16)
and func_17(vsk_354, target_16, target_18, target_17)
and func_18(vsk_354, target_17, target_19, target_18)
and func_19(vsk_354, target_18, target_20, target_19)
and func_20(vsk_354, target_19, target_21, target_20)
and func_21(vsk_354, target_20, target_22, target_21)
and func_22(vsk_354, target_21, target_23, target_22)
and func_23(vsk_354, target_22, target_24, target_23)
and func_24(vsk_354, target_23, target_25, target_24)
and func_25(vsk_354, target_24, target_26, target_25)
and func_26(vsk_354, target_25, target_27, target_26)
and func_27(vsk_354, target_26, target_28, target_27)
and func_28(vsk_354, target_27, target_29, target_28)
and func_29(vsk_354, target_28, target_30, target_29)
and func_30(vsk_354, target_29, target_31, target_30)
and func_31(vsk_354, target_30, target_31)
and func_32(vsk_354, target_32)
and vsk_354.getType().hasName("sock *")
and vsk_354.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
