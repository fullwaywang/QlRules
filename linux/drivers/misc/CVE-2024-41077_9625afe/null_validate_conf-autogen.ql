/**
 * @name linux-9625afe1dd4a158a14bb50f81af9e2dac634c0b1-null_validate_conf
 * @id cpp/linux/9625afe1dd4a158a14bb50f81af9e2dac634c0b1/null-validate-conf
 * @description linux-9625afe1dd4a158a14bb50f81af9e2dac634c0b1-drivers/block/null_blk/main.c-null_validate_conf CVE-2024-41077
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vdev_1739, PointerFieldAccess target_0) {
	target_0.getTarget().getName()="blocksize"
	and target_0.getQualifier().(VariableAccess).getTarget()=vdev_1739
}

predicate func_1(Parameter vdev_1739, Initializer target_1) {
	exists(PointerFieldAccess obj_0 | obj_0=target_1.getExpr() |
		obj_0.getTarget().getName()="blocksize"
		and obj_0.getQualifier().(VariableAccess).getTarget()=vdev_1739
	)
}

predicate func_2(Parameter vdev_1739, Initializer target_2) {
	exists(PointerFieldAccess obj_0 | obj_0=target_2.getExpr() |
		obj_0.getTarget().getName()="blocksize"
		and obj_0.getQualifier().(VariableAccess).getTarget()=vdev_1739
	)
}

predicate func_3(Parameter vdev_1739, Initializer target_3) {
	exists(PointerFieldAccess obj_0 | obj_0=target_3.getExpr() |
		obj_0.getTarget().getName()="queue_mode"
		and obj_0.getQualifier().(VariableAccess).getTarget()=vdev_1739
	)
}

predicate func_5(Variable v__UNIQUE_ID___y1245_1757, Variable v__UNIQUE_ID___x1244_1757, VariableAccess target_5) {
	target_5.getTarget()=v__UNIQUE_ID___x1244_1757
	and target_5.getParent().(LTExpr).getGreaterOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___y1245_1757
}

/*predicate func_6(Variable v__UNIQUE_ID___y1245_1757, Variable v__UNIQUE_ID___x1244_1757, VariableAccess target_6) {
	target_6.getTarget()=v__UNIQUE_ID___y1245_1757
	and target_6.getParent().(LTExpr).getLesserOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___x1244_1757
}

*/
predicate func_7(Variable v__UNIQUE_ID___x1244_1757, VariableAccess target_7) {
	target_7.getTarget()=v__UNIQUE_ID___x1244_1757
}

predicate func_8(Variable v__UNIQUE_ID___y1245_1757, VariableAccess target_8) {
	target_8.getTarget()=v__UNIQUE_ID___y1245_1757
}

predicate func_9(Parameter vdev_1739, Initializer target_9) {
	exists(PointerFieldAccess obj_0 | obj_0=target_9.getExpr() |
		obj_0.getTarget().getName()="irqmode"
		and obj_0.getQualifier().(VariableAccess).getTarget()=vdev_1739
	)
}

predicate func_11(Variable v__UNIQUE_ID___x1246_1758, Variable v__UNIQUE_ID___y1247_1758, VariableAccess target_11) {
	target_11.getTarget()=v__UNIQUE_ID___x1246_1758
	and target_11.getParent().(LTExpr).getGreaterOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___y1247_1758
}

/*predicate func_12(Variable v__UNIQUE_ID___x1246_1758, Variable v__UNIQUE_ID___y1247_1758, VariableAccess target_12) {
	target_12.getTarget()=v__UNIQUE_ID___y1247_1758
	and target_12.getParent().(LTExpr).getLesserOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___x1246_1758
}

*/
predicate func_13(Variable v__UNIQUE_ID___x1246_1758, VariableAccess target_13) {
	target_13.getTarget()=v__UNIQUE_ID___x1246_1758
}

predicate func_14(Variable v__UNIQUE_ID___y1247_1758, VariableAccess target_14) {
	target_14.getTarget()=v__UNIQUE_ID___y1247_1758
}

predicate func_15(Function func, Initializer target_15) {
	target_15.getExpr().(DivExpr).getValue()="17592186044415"
	and target_15.getExpr().getEnclosingFunction() = func
}

predicate func_16(Parameter vdev_1739, Initializer target_16) {
	exists(PointerFieldAccess obj_0 | obj_0=target_16.getExpr() |
		obj_0.getTarget().getName()="cache_size"
		and obj_0.getQualifier().(VariableAccess).getTarget()=vdev_1739
	)
}

predicate func_17(Variable v__UNIQUE_ID___x1248_1765, Variable v__UNIQUE_ID___y1249_1765, VariableAccess target_17) {
	target_17.getTarget()=v__UNIQUE_ID___x1248_1765
	and target_17.getParent().(LTExpr).getGreaterOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___y1249_1765
}

/*predicate func_18(Variable v__UNIQUE_ID___x1248_1765, Variable v__UNIQUE_ID___y1249_1765, VariableAccess target_18) {
	target_18.getTarget()=v__UNIQUE_ID___y1249_1765
	and target_18.getParent().(LTExpr).getLesserOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___x1248_1765
}

*/
predicate func_19(Variable v__UNIQUE_ID___x1248_1765, VariableAccess target_19) {
	target_19.getTarget()=v__UNIQUE_ID___x1248_1765
}

predicate func_20(Variable v__UNIQUE_ID___y1249_1765, VariableAccess target_20) {
	target_20.getTarget()=v__UNIQUE_ID___y1249_1765
}

predicate func_21(Function func, Initializer target_21) {
	target_21.getExpr().(MulExpr).getValue()="40960"
	and target_21.getExpr().getEnclosingFunction() = func
}

predicate func_22(Parameter vdev_1739, Initializer target_22) {
	exists(PointerFieldAccess obj_0 | obj_0=target_22.getExpr() |
		obj_0.getTarget().getName()="mbps"
		and obj_0.getQualifier().(VariableAccess).getTarget()=vdev_1739
	)
}

predicate func_23(Variable v__UNIQUE_ID___x1250_1767, Variable v__UNIQUE_ID___y1251_1767, VariableAccess target_23) {
	target_23.getTarget()=v__UNIQUE_ID___x1250_1767
	and target_23.getParent().(LTExpr).getGreaterOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___y1251_1767
}

/*predicate func_24(Variable v__UNIQUE_ID___x1250_1767, Variable v__UNIQUE_ID___y1251_1767, VariableAccess target_24) {
	target_24.getTarget()=v__UNIQUE_ID___y1251_1767
	and target_24.getParent().(LTExpr).getLesserOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___x1250_1767
}

*/
predicate func_25(Variable v__UNIQUE_ID___x1250_1767, VariableAccess target_25) {
	target_25.getTarget()=v__UNIQUE_ID___x1250_1767
}

predicate func_26(Variable v__UNIQUE_ID___y1251_1767, VariableAccess target_26) {
	target_26.getTarget()=v__UNIQUE_ID___y1251_1767
}

predicate func_27(Function func, Literal target_27) {
	target_27.getValue()="512"
	and not target_27.getValue()="22"
	and target_27.getParent().(SubExpr).getParent().(ComplementExpr).getOperand() instanceof SubExpr
	and target_27.getEnclosingFunction() = func
}

predicate func_28(Parameter vdev_1739, ExprStmt target_35, ExprStmt target_36, Function func) {
exists(IfStmt target_28 |
	exists(FunctionCall obj_0 | obj_0=target_28.getCondition() |
		exists(PointerFieldAccess obj_1 | obj_1=obj_0.getArgument(0) |
			obj_1.getTarget().getName()="blocksize"
			and obj_1.getQualifier().(VariableAccess).getTarget()=vdev_1739
		)
		and obj_0.getTarget().hasName("blk_validate_block_size")
	)
	and target_28.getThen().(ReturnStmt).getExpr().(UnaryMinusExpr).getValue()="-22"
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_28
	and target_28.getLocation().isBefore(target_35.getLocation())
	and target_28.getCondition().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_36.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
)
}

predicate func_29(Function func, NotExpr target_29) {
	target_29.getValue()="1"
	and target_29.getEnclosingFunction() = func
}

predicate func_30(Function func, NotExpr target_30) {
	target_30.getValue()="1"
	and target_30.getEnclosingFunction() = func
}

predicate func_31(Function func, NotExpr target_31) {
	target_31.getValue()="1"
	and target_31.getEnclosingFunction() = func
}

predicate func_32(Parameter vdev_1739, PointerFieldAccess target_32) {
	target_32.getTarget().getName()="blocksize"
	and target_32.getQualifier().(VariableAccess).getTarget()=vdev_1739
}

predicate func_33(Variable v__UNIQUE_ID___x1242_1747, Variable v__UNIQUE_ID___y1243_1747, ExprStmt target_33) {
	exists(ConditionalExpr obj_0 | obj_0=target_33.getExpr() |
		exists(RelationalOperation obj_1 | obj_1=obj_0.getCondition() |
			obj_1.getLesserOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___x1242_1747
			and obj_1.getGreaterOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___y1243_1747
		)
		and obj_0.getThen().(VariableAccess).getTarget()=v__UNIQUE_ID___x1242_1747
		and obj_0.getElse().(VariableAccess).getTarget()=v__UNIQUE_ID___y1243_1747
	)
}

predicate func_34(Variable v__UNIQUE_ID___x1246_1758, Variable v__UNIQUE_ID___y1247_1758, ExprStmt target_34) {
	exists(ConditionalExpr obj_0 | obj_0=target_34.getExpr() |
		exists(RelationalOperation obj_1 | obj_1=obj_0.getCondition() |
			obj_1.getLesserOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___x1246_1758
			and obj_1.getGreaterOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___y1247_1758
		)
		and obj_0.getThen().(VariableAccess).getTarget()=v__UNIQUE_ID___x1246_1758
		and obj_0.getElse().(VariableAccess).getTarget()=v__UNIQUE_ID___y1247_1758
	)
}

predicate func_35(Parameter vdev_1739, Function func, ExprStmt target_35) {
	exists(AssignExpr obj_0 | obj_0=target_35.getExpr() |
		exists(PointerFieldAccess obj_1 | obj_1=obj_0.getLValue() |
			obj_1.getTarget().getName()="blocksize"
			and obj_1.getQualifier().(VariableAccess).getTarget()=vdev_1739
		)
		and exists(BitwiseAndExpr obj_2 | obj_2=obj_0.getRValue() |
			exists(PointerFieldAccess obj_3 | obj_3=obj_2.getLeftOperand() |
				obj_3.getTarget().getName()="blocksize"
				and obj_3.getQualifier().(VariableAccess).getTarget()=vdev_1739
			)
			and obj_2.getRightOperand().(ComplementExpr).getValue()="4294966784"
		)
	)
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_35
}

predicate func_36(Parameter vdev_1739, Function func, ExprStmt target_36) {
	exists(AssignExpr obj_0 | obj_0=target_36.getExpr() |
		exists(PointerFieldAccess obj_1 | obj_1=obj_0.getLValue() |
			obj_1.getTarget().getName()="blocksize"
			and obj_1.getQualifier().(VariableAccess).getTarget()=vdev_1739
		)
		and exists(BuiltInChooseExpr obj_2 | obj_2=obj_0.getRValue() |
			exists(ConditionalExpr obj_3 | obj_3=obj_2.getChild(1) |
				exists(BuiltInChooseExpr obj_4 | obj_4=obj_3.getThen() |
					exists(ConditionalExpr obj_5 | obj_5=obj_4.getChild(1) |
						obj_5.getThen().(PointerFieldAccess).getTarget().getName()="blocksize"
						and obj_5.getElse().(Literal).getValue()="512"
					)
					and obj_4.getChild(0).(LogicalAndExpr).getValue()="0"
				)
				and obj_3.getCondition().(RelationalOperation).getGreaterOperand().(Literal).getValue()="4096"
				and obj_3.getElse().(Literal).getValue()="4096"
			)
			and obj_2.getChild(0).(LogicalAndExpr).getValue()="0"
			and obj_2.getChild(2).(StmtExpr).getStmt().(BlockStmt).getStmt(2) instanceof ExprStmt
		)
	)
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_36
}

predicate func_38(Variable v__UNIQUE_ID___x1240_1747, Variable v__UNIQUE_ID___y1241_1747, ExprStmt target_38) {
	exists(ConditionalExpr obj_0 | obj_0=target_38.getExpr() |
		exists(RelationalOperation obj_1 | obj_1=obj_0.getCondition() |
			obj_1.getGreaterOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___x1240_1747
			and obj_1.getLesserOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___y1241_1747
		)
		and obj_0.getThen().(VariableAccess).getTarget()=v__UNIQUE_ID___x1240_1747
		and obj_0.getElse().(VariableAccess).getTarget()=v__UNIQUE_ID___y1241_1747
	)
}

/*predicate func_40(Variable v__UNIQUE_ID___x1240_1_1747, Variable v__UNIQUE_ID___y1241_1_1747, ExprStmt target_40) {
	exists(ConditionalExpr obj_0 | obj_0=target_40.getExpr() |
		exists(RelationalOperation obj_1 | obj_1=obj_0.getCondition() |
			obj_1.getGreaterOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___x1240_1_1747
			and obj_1.getLesserOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___y1241_1_1747
		)
		and obj_0.getThen().(VariableAccess).getTarget()=v__UNIQUE_ID___x1240_1_1747
		and obj_0.getElse().(VariableAccess).getTarget()=v__UNIQUE_ID___y1241_1_1747
	)
}

*/
/*predicate func_42(Variable v__UNIQUE_ID___x1240_2_1747, Variable v__UNIQUE_ID___y1241_2_1747, ExprStmt target_42) {
	exists(ConditionalExpr obj_0 | obj_0=target_42.getExpr() |
		exists(RelationalOperation obj_1 | obj_1=obj_0.getCondition() |
			obj_1.getGreaterOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___x1240_2_1747
			and obj_1.getLesserOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___y1241_2_1747
		)
		and obj_0.getThen().(VariableAccess).getTarget()=v__UNIQUE_ID___x1240_2_1747
		and obj_0.getElse().(VariableAccess).getTarget()=v__UNIQUE_ID___y1241_2_1747
	)
}

*/
predicate func_46(Variable v__UNIQUE_ID___x1240_3_1747, Variable v__UNIQUE_ID___y1241_3_1747, ExprStmt target_46) {
	exists(ConditionalExpr obj_0 | obj_0=target_46.getExpr() |
		exists(RelationalOperation obj_1 | obj_1=obj_0.getCondition() |
			obj_1.getGreaterOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___x1240_3_1747
			and obj_1.getLesserOperand().(VariableAccess).getTarget()=v__UNIQUE_ID___y1241_3_1747
		)
		and obj_0.getThen().(VariableAccess).getTarget()=v__UNIQUE_ID___x1240_3_1747
		and obj_0.getElse().(VariableAccess).getTarget()=v__UNIQUE_ID___y1241_3_1747
	)
}

from Function func, Variable v__UNIQUE_ID___y1245_1757, Variable v__UNIQUE_ID___x1246_1758, Variable v__UNIQUE_ID___y1247_1758, Variable v__UNIQUE_ID___x1248_1765, Variable v__UNIQUE_ID___y1249_1765, Variable v__UNIQUE_ID___x1250_1767, Variable v__UNIQUE_ID___y1251_1767, Parameter vdev_1739, Variable v__UNIQUE_ID___x1240_1747, Variable v__UNIQUE_ID___y1241_1747, Variable v__UNIQUE_ID___x1240_1_1747, Variable v__UNIQUE_ID___y1241_1_1747, Variable v__UNIQUE_ID___x1240_2_1747, Variable v__UNIQUE_ID___y1241_2_1747, Variable v__UNIQUE_ID___x1242_1747, Variable v__UNIQUE_ID___x1240_3_1747, Variable v__UNIQUE_ID___y1241_3_1747, Variable v__UNIQUE_ID___y1243_1747, Variable v__UNIQUE_ID___x1244_1757, PointerFieldAccess target_0, Initializer target_1, Initializer target_2, Initializer target_3, VariableAccess target_5, VariableAccess target_7, VariableAccess target_8, Initializer target_9, VariableAccess target_11, VariableAccess target_13, VariableAccess target_14, Initializer target_15, Initializer target_16, VariableAccess target_17, VariableAccess target_19, VariableAccess target_20, Initializer target_21, Initializer target_22, VariableAccess target_23, VariableAccess target_25, VariableAccess target_26, Literal target_27, NotExpr target_29, NotExpr target_30, NotExpr target_31, PointerFieldAccess target_32, ExprStmt target_33, ExprStmt target_34, ExprStmt target_35, ExprStmt target_36, ExprStmt target_38, ExprStmt target_46
where
func_0(vdev_1739, target_0)
and func_1(vdev_1739, target_1)
and func_2(vdev_1739, target_2)
and func_3(vdev_1739, target_3)
and func_5(v__UNIQUE_ID___y1245_1757, v__UNIQUE_ID___x1244_1757, target_5)
and func_7(v__UNIQUE_ID___x1244_1757, target_7)
and func_8(v__UNIQUE_ID___y1245_1757, target_8)
and func_9(vdev_1739, target_9)
and func_11(v__UNIQUE_ID___x1246_1758, v__UNIQUE_ID___y1247_1758, target_11)
and func_13(v__UNIQUE_ID___x1246_1758, target_13)
and func_14(v__UNIQUE_ID___y1247_1758, target_14)
and func_15(func, target_15)
and func_16(vdev_1739, target_16)
and func_17(v__UNIQUE_ID___x1248_1765, v__UNIQUE_ID___y1249_1765, target_17)
and func_19(v__UNIQUE_ID___x1248_1765, target_19)
and func_20(v__UNIQUE_ID___y1249_1765, target_20)
and func_21(func, target_21)
and func_22(vdev_1739, target_22)
and func_23(v__UNIQUE_ID___x1250_1767, v__UNIQUE_ID___y1251_1767, target_23)
and func_25(v__UNIQUE_ID___x1250_1767, target_25)
and func_26(v__UNIQUE_ID___y1251_1767, target_26)
and func_27(func, target_27)
and not func_28(vdev_1739, target_35, target_36, func)
and func_29(func, target_29)
and func_30(func, target_30)
and func_31(func, target_31)
and func_32(vdev_1739, target_32)
and func_33(v__UNIQUE_ID___x1242_1747, v__UNIQUE_ID___y1243_1747, target_33)
and func_34(v__UNIQUE_ID___x1246_1758, v__UNIQUE_ID___y1247_1758, target_34)
and func_35(vdev_1739, func, target_35)
and func_36(vdev_1739, func, target_36)
and func_38(v__UNIQUE_ID___x1240_1747, v__UNIQUE_ID___y1241_1747, target_38)
and func_46(v__UNIQUE_ID___x1240_3_1747, v__UNIQUE_ID___y1241_3_1747, target_46)
and v__UNIQUE_ID___y1245_1757.getType().hasName("unsigned int")
and v__UNIQUE_ID___x1246_1758.getType().hasName("unsigned int")
and v__UNIQUE_ID___y1247_1758.getType().hasName("unsigned int")
and v__UNIQUE_ID___x1248_1765.getType().hasName("unsigned long")
and v__UNIQUE_ID___y1249_1765.getType().hasName("unsigned long")
and v__UNIQUE_ID___x1250_1767.getType().hasName("unsigned int")
and v__UNIQUE_ID___y1251_1767.getType().hasName("unsigned int")
and vdev_1739.getType().hasName("nullb_device *")
and v__UNIQUE_ID___x1240_1747.getType().hasName("unsigned int")
and v__UNIQUE_ID___y1241_1747.getType().hasName("unsigned int")
and v__UNIQUE_ID___x1240_1_1747.getType().hasName("unsigned int")
and v__UNIQUE_ID___y1241_1_1747.getType().hasName("unsigned int")
and v__UNIQUE_ID___x1240_2_1747.getType().hasName("unsigned int")
and v__UNIQUE_ID___y1241_2_1747.getType().hasName("unsigned int")
and v__UNIQUE_ID___x1242_1747.getType().hasName("unsigned int")
and v__UNIQUE_ID___x1240_3_1747.getType().hasName("unsigned int")
and v__UNIQUE_ID___y1241_3_1747.getType().hasName("unsigned int")
and v__UNIQUE_ID___y1243_1747.getType().hasName("unsigned int")
and v__UNIQUE_ID___x1244_1757.getType().hasName("unsigned int")
and v__UNIQUE_ID___y1245_1757.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___x1246_1758.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___y1247_1758.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___x1248_1765.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___y1249_1765.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___x1250_1767.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___y1251_1767.(LocalVariable).getFunction() = func
and vdev_1739.getFunction() = func
and v__UNIQUE_ID___x1240_1747.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___y1241_1747.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___x1240_1_1747.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___y1241_1_1747.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___x1240_2_1747.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___y1241_2_1747.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___x1242_1747.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___x1240_3_1747.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___y1241_3_1747.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___y1243_1747.(LocalVariable).getFunction() = func
and v__UNIQUE_ID___x1244_1757.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
