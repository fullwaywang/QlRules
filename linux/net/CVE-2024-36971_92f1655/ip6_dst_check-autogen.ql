/**
 * @name linux-92f1655aa2b2294d0b49925f3b875a634bd3b59e-ip6_dst_check
 * @id cpp/linux/92f1655aa2b2294d0b49925f3b875a634bd3b59e/ip6-dst-check
 * @description linux-92f1655aa2b2294d0b49925f3b875a634bd3b59e-net/ipv6/route.c-ip6_dst_check CVE-2024-36971
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func, Initializer target_0) {
	exists(StmtExpr obj_0 | obj_0=target_0.getExpr() |
		exists(BlockStmt obj_1 | obj_1=obj_0.getStmt() |
			obj_1.getStmt(0).(DoStmt).getCondition() instanceof Literal
			and obj_1.getStmt(1).(ExprStmt).getExpr().(PointerDereferenceExpr).getOperand().(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="from"
		)
	)
	and target_0.getExpr().getEnclosingFunction() = func
}

predicate func_1(Variable v__UNIQUE_ID_rcu2154_2759, VariableAccess target_1) {
	target_1.getTarget()=v__UNIQUE_ID_rcu2154_2759
}

from Function func, Variable v__UNIQUE_ID_rcu2154_2759, Initializer target_0, VariableAccess target_1
where
func_0(func, target_0)
and func_1(v__UNIQUE_ID_rcu2154_2759, target_1)
and v__UNIQUE_ID_rcu2154_2759.getType().hasName("fib6_info *")
and v__UNIQUE_ID_rcu2154_2759.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
