/**
 * @name v8-d125c7329f6e22af4523de3c55de3a22f168acc9-v8__internal__Object__SetSuperProperty_
 * @id cpp/v8/d125c7329f6e22af4523de3c55de3a22f168acc9/v8internalobjectsetsuperproperty
 * @description v8-d125c7329f6e22af4523de3c55de3a22f168acc9-test/unittests/api/interceptor-unittest.cc-v8__internal__Object__SetSuperProperty_ CVE-2023-2935
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func, Literal target_0) {
	target_0.getValue()="2757"
	and not target_0.getValue()="2756"
	and target_0.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("V8_Fatal")
	and target_0.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(StringLiteral).getValue()="../../src/objects/objects.cc"
	and target_0.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("const char *")
	and target_0.getEnclosingFunction() = func
}

predicate func_1(Variable visolate_2673, Variable vreceiver_2690, Variable vc_2694, Parameter vit_2670) {
exists(FunctionCall target_1 |
	target_1.getTarget().hasName("GetKey")
	and target_1.getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_1.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=visolate_2673
	and target_1.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
	and target_1.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(2) instanceof FunctionCall
	and target_1.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(3).(VariableAccess).getTarget()=vc_2694)
}

predicate func_2(Variable vown_lookup_2695, NotExpr target_10, AddressOfExpr target_11, AddressOfExpr target_12) {
exists(ExprStmt target_2 |
	target_2.getExpr().(FunctionCall).getTarget().hasName("Restart")
	and target_2.getExpr().(FunctionCall).getQualifier().(VariableAccess).getTarget()=vown_lookup_2695
	and target_2.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(0)=target_2
	and target_2.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_10
	and target_11.getOperand().(VariableAccess).getLocation().isBefore(target_2.getExpr().(FunctionCall).getQualifier().(VariableAccess).getLocation())
	and target_2.getExpr().(FunctionCall).getQualifier().(VariableAccess).getLocation().isBefore(target_12.getOperand().(VariableAccess).getLocation()))
}

predicate func_3(Parameter vit_2670, VariableAccess target_3) {
	target_3.getTarget()=vit_2670
}

predicate func_6(Function func, DeclStmt target_6) {
	func.getEntryPoint().(BlockStmt).getAStmt()=target_6
}

predicate func_7(Variable visolate_2673, Variable vreceiver_2690, Variable vc_2694, Parameter vit_2670, ConditionalExpr target_7) {
	target_7.getCondition().(FunctionCall).getTarget().hasName("IsElement")
	and target_7.getCondition().(FunctionCall).getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_7.getThen().(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=visolate_2673
	and target_7.getThen().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
	and target_7.getThen().(ConstructorCall).getArgument(2).(FunctionCall).getTarget().hasName("index")
	and target_7.getThen().(ConstructorCall).getArgument(2).(FunctionCall).getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_7.getThen().(ConstructorCall).getArgument(3).(VariableAccess).getTarget()=vc_2694
	and target_7.getElse().(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=visolate_2673
	and target_7.getElse().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
	and target_7.getElse().(ConstructorCall).getArgument(2).(FunctionCall).getTarget().hasName("name")
	and target_7.getElse().(ConstructorCall).getArgument(2).(FunctionCall).getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_7.getElse().(ConstructorCall).getArgument(3).(VariableAccess).getTarget()=vc_2694
}

/*predicate func_8(Variable visolate_2673, Variable vreceiver_2690, Variable vc_2694, Parameter vit_2670, FunctionCall target_8) {
	target_8.getTarget().hasName("index")
	and target_8.getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_8.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=visolate_2673
	and target_8.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
	and target_8.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(3).(VariableAccess).getTarget()=vc_2694
}

*/
/*predicate func_9(Variable visolate_2673, Variable vreceiver_2690, Variable vc_2694, Parameter vit_2670, ConditionalExpr target_7, ConstructorCall target_15, FunctionCall target_17, VariableAccess target_9) {
	target_9.getTarget()=vc_2694
	and target_9.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=visolate_2673
	and target_9.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
	and target_9.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(2).(FunctionCall).getTarget().hasName("index")
	and target_9.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(2).(FunctionCall).getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_9.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_7.getThen().(ConstructorCall).getArgument(0).(VariableAccess).getLocation())
	and target_9.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_15.getArgument(0).(VariableAccess).getLocation())
	and target_9.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(2).(FunctionCall).getQualifier().(VariableAccess).getLocation().isBefore(target_17.getQualifier().(VariableAccess).getLocation())
}

*/
predicate func_10(Function func, NotExpr target_10) {
	target_10.getOperand().(FunctionCall).getTarget().hasName("FromJust")
	and target_10.getOperand().(FunctionCall).getQualifier().(VariableAccess).getTarget().getType().hasName("Maybe<bool>")
	and target_10.getEnclosingFunction() = func
}

predicate func_11(Variable vown_lookup_2695, AddressOfExpr target_11) {
	target_11.getOperand().(VariableAccess).getTarget()=vown_lookup_2695
	and target_11.getParent().(FunctionCall).getParent().(Initializer).getExpr().(FunctionCall).getTarget().hasName("GetOwnPropertyDescriptor")
	and target_11.getParent().(FunctionCall).getParent().(Initializer).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(VariableAccess).getTarget().getType().hasName("PropertyDescriptor")
}

predicate func_12(Variable vown_lookup_2695, AddressOfExpr target_12) {
	target_12.getOperand().(VariableAccess).getTarget()=vown_lookup_2695
	and target_12.getParent().(FunctionCall).getParent().(NotExpr).getOperand().(FunctionCall).getTarget().hasName("CheckContextualStoreToJSGlobalObject")
	and target_12.getParent().(FunctionCall).getParent().(NotExpr).getOperand().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("Maybe<ShouldThrow>")
}

predicate func_15(Variable vreceiver_2690, ConstructorCall target_15) {
	target_15.getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
}

predicate func_17(Parameter vit_2670, FunctionCall target_17) {
	target_17.getTarget().hasName("name")
	and target_17.getQualifier().(VariableAccess).getTarget()=vit_2670
}

from Function func, Variable visolate_2673, Variable vreceiver_2690, Variable vc_2694, Variable vown_lookup_2695, Parameter vit_2670, Literal target_0, VariableAccess target_3, DeclStmt target_6, ConditionalExpr target_7, NotExpr target_10, AddressOfExpr target_11, AddressOfExpr target_12, ConstructorCall target_15, FunctionCall target_17
where
func_0(func, target_0)
and not func_1(visolate_2673, vreceiver_2690, vc_2694, vit_2670)
and not func_2(vown_lookup_2695, target_10, target_11, target_12)
and func_3(vit_2670, target_3)
and func_6(func, target_6)
and func_7(visolate_2673, vreceiver_2690, vc_2694, vit_2670, target_7)
and func_10(func, target_10)
and func_11(vown_lookup_2695, target_11)
and func_12(vown_lookup_2695, target_12)
and func_15(vreceiver_2690, target_15)
and func_17(vit_2670, target_17)
and visolate_2673.getType().hasName("Isolate *")
and vreceiver_2690.getType().hasName("Handle<JSReceiver>")
and vc_2694.getType().hasName("Configuration")
and vown_lookup_2695.getType().hasName("LookupIterator")
and vit_2670.getType().hasName("LookupIterator *")
and visolate_2673.(LocalVariable).getFunction() = func
and vreceiver_2690.(LocalVariable).getFunction() = func
and vc_2694.(LocalVariable).getFunction() = func
and vown_lookup_2695.(LocalVariable).getFunction() = func
and vit_2670.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
