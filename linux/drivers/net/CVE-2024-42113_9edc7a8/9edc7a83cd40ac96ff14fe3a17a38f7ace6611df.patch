commit 9edc7a83cd40ac96ff14fe3a17a38f7ace6611df
Author: Jiawen Wu <jiawenwu@trustnetic.com>
Date:   Mon Jul 1 15:14:13 2024 +0800

    net: txgbe: initialize num_q_vectors for MSI/INTx interrupts
    
    [ Upstream commit 7c36711a2cd8059c2d24f5e5c1d76e8ea2d5613c ]
    
    When using MSI/INTx interrupts, wx->num_q_vectors is uninitialized.
    Thus there will be kernel panic in wx_alloc_q_vectors() to allocate
    queue vectors.
    
    Fixes: 3f703186113f ("net: libwx: Add irq flow functions")
    Signed-off-by: Jiawen Wu <jiawenwu@trustnetic.com>
    Signed-off-by: Paolo Abeni <pabeni@redhat.com>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

diff --git a/drivers/net/ethernet/wangxun/libwx/wx_lib.c b/drivers/net/ethernet/wangxun/libwx/wx_lib.c
index e9310d9ca67c..bba44ff0e287 100644
--- a/drivers/net/ethernet/wangxun/libwx/wx_lib.c
+++ b/drivers/net/ethernet/wangxun/libwx/wx_lib.c
@@ -1657,6 +1657,7 @@ static int wx_set_interrupt_capability(struct wx *wx)
 	}
 
 	pdev->irq = pci_irq_vector(pdev, 0);
+	wx->num_q_vectors = 1;
 
 	return 0;
 }
