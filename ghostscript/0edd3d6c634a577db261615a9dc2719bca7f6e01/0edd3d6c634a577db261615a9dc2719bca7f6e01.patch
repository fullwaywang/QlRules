commit 0edd3d6c634a577db261615a9dc2719bca7f6e01	0edd3d6c634a577db261615a9dc2719bca7f6e01
Author: Chris Liddell <chris.liddell@artifex.com>
Date:   Tue Aug 21 20:36:52 2018 +0100

    Bug 699659: Don't just assume an object is a t_(a)struct

diff --git a/psi/ztype.c b/psi/ztype.c
index ad248d96c..830795631 100644
--- a/psi/ztype.c
+++ b/psi/ztype.c
@@ -76,7 +76,7 @@ ztype(i_ctx_t *i_ctx_p)
         /* Must be either a stack underflow or a t_[a]struct. */
         check_op(2);
         {                       /* Get the type name from the structure. */
-            if (op[-1].value.pstruct != 0x00) {
+            if ((r_has_type(&op[-1], t_struct) || r_has_type(&op[-1], t_astruct)) && op[-1].value.pstruct != 0x00) {
             const char *sname =
                 gs_struct_type_name_string(gs_object_type(imemory,
                                                           op[-1].value.pstruct));
