commit 6b319c8c7a29e9c353dec83dc92f01905f6c8966	6b319c8c7a29e9c353dec83dc92f01905f6c8966
Author: dormando <dormando@rydia.net>
Date:   Mon Oct 26 16:29:07 2020 -0700

    udp: crash fix when receiving multi-packet uploads
    
    multi-packet sets aren't supported in UDP. It was trying to write an
    error message in response, but no mc_resp object was initialized at the
    time, leading to a null reference crash.
    
    Instead drop the packet quietly since that's a pretty fatal bug anyway
    and keeps the parser simplified.
    
    For credits see accompanying release notes.

diff --git a/memcached.c b/memcached.c
index a21b4aa..ebcbdee 100644
--- a/memcached.c
+++ b/memcached.c
@@ -1183,9 +1183,9 @@ bool resp_has_stack(conn *c) {
 
 void out_string(conn *c, const char *str) {
     size_t len;
+    assert(c != NULL);
     mc_resp *resp = c->resp;
 
-    assert(c != NULL);
     // if response was original filled with something, but we're now writing
     // out an error or similar, have to reset the object first.
     // TODO: since this is often redundant with allocation, how many callers
@@ -2604,7 +2604,6 @@ static enum try_read_result try_read_udp(conn *c) {
 
         /* If this is a multi-packet request, drop it. */
         if (buf[4] != 0 || buf[5] != 1) {
-            out_string(c, "SERVER_ERROR multi-packet request not supported");
             return READ_NO_DATA_RECEIVED;
         }
 
