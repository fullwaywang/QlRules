commit 283db1b08aa23b55723d044093d10b6cfe5a5905	283db1b08aa23b55723d044093d10b6cfe5a5905
Author: Felipe Andrade <fsandrade@chromium.org>
Date:   Mon May 8 10:08:38 2023 +0000

    Add 'LineTooLong' error to Kerberos config errors
    
    As the new error code has been rolled out to Chrome (added in
    https://crrev.com/c/4354635) we need to support this error in the UI,
    with a correct message.
    
    Added a label to skip translation screenshots check, because the
    presubmit was complaining about a change in the example value of the
    arg in the IDS_SETTINGS_KERBEROS_CONFIG_ERROR_TOO_MANY_NESTED_GROUPS
    message.
    
    Bug: 1398986
    Skip-Translation-Screenshots-Check: True
    Change-Id: Idd8ebd5a18ccb02b437d3698db4490b85369b1d9
    Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/4505959
    Reviewed-by: Scott Violet <sky@chromium.org>
    Commit-Queue: Felipe Andrade <fsandrade@chromium.org>
    Reviewed-by: Roman Sorokin <rsorokin@google.com>
    Cr-Commit-Position: refs/heads/main@{#1140772}

diff --git a/chrome/app/os_settings_strings.grdp b/chrome/app/os_settings_strings.grdp
index a72e4627ee25c..7345b1c93af9d 100644
--- a/chrome/app/os_settings_strings.grdp
+++ b/chrome/app/os_settings_strings.grdp
@@ -4312,7 +4312,10 @@ Press an assigned switch or key to remove assignment.
     Failed to parse configuration
   </message>
   <message name="IDS_SETTINGS_KERBEROS_CONFIG_ERROR_TOO_MANY_NESTED_GROUPS" desc="Error message displayed in the Kerberos configuration dialog when the user tries to save a configuration that contains too many nested groups. See https://web.mit.edu/kerberos/krb5-1.12/doc/admin/conf_files/krb5_conf.html.">
-    Too many nested groups: <ph name="ERROR_LINE">$1<ex>[appdefaults]</ex></ph>
+    Too many nested groups: <ph name="ERROR_LINE">$1<ex>A{ (after many opening curly braces that haven't been closed yet)</ex></ph>
+  </message>
+  <message name="IDS_SETTINGS_KERBEROS_CONFIG_ERROR_LINE_TOO_LONG" desc="Error message displayed in the Kerberos configuration dialog when the user tries to save a configuration that contains a line that is too long. See https://web.mit.edu/kerberos/krb5-1.12/doc/admin/conf_files/krb5_conf.html.">
+    Line is too long: <ph name="ERROR_LINE">$1<ex># A very long comment line...</ex></ph>
   </message>
   <message name="IDS_SETTINGS_ADD_KERBEROS_ACCOUNT_REFRESH_BUTTON_LABEL" desc="Label of the action button on the 'Refresh a Kerberos tickets' dialog.">
     Refresh
diff --git a/chrome/app/os_settings_strings_grdp/IDS_SETTINGS_KERBEROS_CONFIG_ERROR_LINE_TOO_LONG.png.sha1 b/chrome/app/os_settings_strings_grdp/IDS_SETTINGS_KERBEROS_CONFIG_ERROR_LINE_TOO_LONG.png.sha1
new file mode 100644
index 0000000000000..f0cd7ef88bed7
--- /dev/null
+++ b/chrome/app/os_settings_strings_grdp/IDS_SETTINGS_KERBEROS_CONFIG_ERROR_LINE_TOO_LONG.png.sha1
@@ -0,0 +1 @@
+d88cf852372f5645a8f7d602f082d538c0d04770
\ No newline at end of file
diff --git a/chrome/browser/resources/settings/chromeos/kerberos_page/kerberos_accounts_browser_proxy.ts b/chrome/browser/resources/settings/chromeos/kerberos_page/kerberos_accounts_browser_proxy.ts
index 706ded7eed03f..49a30749793d1 100644
--- a/chrome/browser/resources/settings/chromeos/kerberos_page/kerberos_accounts_browser_proxy.ts
+++ b/chrome/browser/resources/settings/chromeos/kerberos_page/kerberos_accounts_browser_proxy.ts
@@ -74,6 +74,7 @@ export enum KerberosConfigErrorCode {
   SECTION_NOT_SUPPORTED = 7,
   KRB5_FAILED_TO_PARSE = 8,
   TOO_MANY_NESTED_GROUPS = 9,
+  LINE_TOO_LONG = 10,
 }
 
 export interface KerberosAccountsBrowserProxy {
diff --git a/chrome/browser/resources/settings/chromeos/kerberos_page/kerberos_add_account_dialog.ts b/chrome/browser/resources/settings/chromeos/kerberos_page/kerberos_add_account_dialog.ts
index ffabadc892c0c..bce3628b598a4 100644
--- a/chrome/browser/resources/settings/chromeos/kerberos_page/kerberos_add_account_dialog.ts
+++ b/chrome/browser/resources/settings/chromeos/kerberos_page/kerberos_add_account_dialog.ts
@@ -460,6 +460,8 @@ class KerberosAddAccountDialogElement extends
         return this.i18n('kerberosConfigErrorKrb5FailedToParse');
       case KerberosConfigErrorCode.TOO_MANY_NESTED_GROUPS:
         return this.i18n('kerberosConfigErrorTooManyNestedGroups', errorLine);
+      case KerberosConfigErrorCode.LINE_TOO_LONG:
+        return this.i18n('kerberosConfigErrorLineTooLong', errorLine);
       default:
         assertNotReached();
     }
diff --git a/chrome/browser/ui/webui/settings/ash/kerberos_accounts_handler.cc b/chrome/browser/ui/webui/settings/ash/kerberos_accounts_handler.cc
index 8741f77b0e52d..fce6f000aeb08 100644
--- a/chrome/browser/ui/webui/settings/ash/kerberos_accounts_handler.cc
+++ b/chrome/browser/ui/webui/settings/ash/kerberos_accounts_handler.cc
@@ -107,6 +107,8 @@ void AddKerberosAddAccountDialogStrings(content::WebUIDataSource* html_source) {
        IDS_SETTINGS_KERBEROS_CONFIG_ERROR_KRB5_FAILED_TO_PARSE},
       {"kerberosConfigErrorTooManyNestedGroups",
        IDS_SETTINGS_KERBEROS_CONFIG_ERROR_TOO_MANY_NESTED_GROUPS},
+      {"kerberosConfigErrorLineTooLong",
+       IDS_SETTINGS_KERBEROS_CONFIG_ERROR_LINE_TOO_LONG},
       {"addKerberosAccountRefreshButtonLabel",
        IDS_SETTINGS_ADD_KERBEROS_ACCOUNT_REFRESH_BUTTON_LABEL},
       {"addKerberosAccount", IDS_SETTINGS_ADD_KERBEROS_ACCOUNT},
diff --git a/tools/metrics/histograms/enums.xml b/tools/metrics/histograms/enums.xml
index 8b809ed331135..dd0e8d3cf995e 100644
--- a/tools/metrics/histograms/enums.xml
+++ b/tools/metrics/histograms/enums.xml
@@ -55253,6 +55253,7 @@ Unsupported non-ascii characters will cause issues with xml presubmits.
   <int value="7" label="Section not supported"/>
   <int value="8" label="Krb5 failed to parse"/>
   <int value="9" label="Too many nested groups"/>
+  <int value="10" label="Line too long"/>
 </enum>
 
 <enum name="KerberosEncryptionTypes">
