commit 0da0b06165d83a8ecbb6582d9d5a135f9d38a52a
Author: Joshua Ashton <joshua@froggi.es>
Date:   Thu Mar 7 19:04:31 2024 +0000

    drm/amdgpu: Forward soft recovery errors to userspace
    
    commit 829798c789f567ef6ba4b084c15b7b5f3bd98d51 upstream.
    
    As we discussed before[1], soft recovery should be
    forwarded to userspace, or we can get into a really
    bad state where apps will keep submitting hanging
    command buffers cascading us to a hard reset.
    
    1: https://lore.kernel.org/all/bf23d5ed-9a6b-43e7-84ee-8cbfd0d60f18@froggi.es/
    Signed-off-by: Joshua Ashton <joshua@froggi.es>
    Reviewed-by: Marek Olšák <marek.olsak@amd.com>
    Signed-off-by: Christian König <christian.koenig@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
    (cherry picked from commit 434967aadbbbe3ad9103cc29e9a327de20fdba01)
    Cc: stable@vger.kernel.org
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

diff --git a/drivers/gpu/drm/amd/amdgpu/amdgpu_job.c b/drivers/gpu/drm/amd/amdgpu/amdgpu_job.c
index de9d7f3dc233..99dd86337e84 100644
--- a/drivers/gpu/drm/amd/amdgpu/amdgpu_job.c
+++ b/drivers/gpu/drm/amd/amdgpu/amdgpu_job.c
@@ -258,9 +258,8 @@ amdgpu_job_prepare_job(struct drm_sched_job *sched_job,
 	struct dma_fence *fence = NULL;
 	int r;
 
-	/* Ignore soft recovered fences here */
 	r = drm_sched_entity_error(s_entity);
-	if (r && r != -ENODATA)
+	if (r)
 		goto error;
 
 	if (!fence && job->gang_submit)
