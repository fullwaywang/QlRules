commit 9cb4eb772839c5e1de2855d126bf74ff16d13382
Author: Michael Niedermayer <michael@niedermayer.cc>
Date:   Tue Sep 5 00:16:29 2017 +0200

    avformat/mov: Fix DoS in read_tfra()
    
    Fixes: Missing EOF check in loop
    No testcase
    
    Found-by: Xiaohei and Wangchu from Alibaba Security Team
    Signed-off-by: Michael Niedermayer <michael@niedermayer.cc>

diff --git a/libavformat/mov.c b/libavformat/mov.c
index 994e9c6eba..2519707345 100644
--- a/libavformat/mov.c
+++ b/libavformat/mov.c
@@ -6094,6 +6094,13 @@ static int read_tfra(MOVContext *mov, AVIOContext *f)
     }
     for (i = 0; i < index->item_count; i++) {
         int64_t time, offset;
+
+        if (avio_feof(f)) {
+            index->item_count = 0;
+            av_freep(&index->items);
+            return AVERROR_INVALIDDATA;
+        }
+
         if (version == 1) {
             time   = avio_rb64(f);
             offset = avio_rb64(f);
