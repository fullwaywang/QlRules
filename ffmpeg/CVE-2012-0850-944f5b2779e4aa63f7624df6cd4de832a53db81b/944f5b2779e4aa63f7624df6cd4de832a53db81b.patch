commit 944f5b2779e4aa63f7624df6cd4de832a53db81b	944f5b2779e4aa63f7624df6cd4de832a53db81b
Author: Michael Niedermayer <michaelni@gmx.at>
Date:   Thu Dec 15 03:59:29 2011 +0100

    aacsbr: Fix memory corruption.
    Fixes Ticket760 and Ticket761
    Bug Found by: Diana Elena Muscalu
    
    Signed-off-by: Michael Niedermayer <michaelni@gmx.at>

diff --git a/libavcodec/aacsbr.c b/libavcodec/aacsbr.c
index a213827132..d2f37c5e10 100644
--- a/libavcodec/aacsbr.c
+++ b/libavcodec/aacsbr.c
@@ -1187,7 +1187,7 @@ static void sbr_qmf_synthesis(DSPContext *dsp, FFTContext *mdct,
     const float *sbr_qmf_window = div ? sbr_qmf_window_ds : sbr_qmf_window_us;
     float *v;
     for (i = 0; i < 32; i++) {
-        if (*v_off == 0) {
+        if (*v_off < 128 >> div) {
             int saved_samples = (1280 - 128) >> div;
             memcpy(&v0[SBR_SYNTHESIS_BUF_SIZE - saved_samples], v0, saved_samples * sizeof(float));
             *v_off = SBR_SYNTHESIS_BUF_SIZE - saved_samples - (128 >> div);
