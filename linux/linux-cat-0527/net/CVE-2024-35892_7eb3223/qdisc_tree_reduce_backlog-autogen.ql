/**
 * @name linux-7eb322360b0266481e560d1807ee79e0cef5742b-qdisc_tree_reduce_backlog
 * @id cpp/linux/7eb322360b0266481e560d1807ee79e0cef5742b/qdisc-tree-reduce-backlog
 * @description linux-7eb322360b0266481e560d1807ee79e0cef5742b-net/sched/sch_api.c-qdisc_tree_reduce_backlog CVE-2024-35892
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vsch_781, Variable vparentid_786, FunctionCall target_0) {
	target_0.getTarget().hasName("qdisc_lookup")
	and not target_0.getTarget().hasName("qdisc_lookup_rcu")
	and target_0.getArgument(0).(FunctionCall).getTarget().hasName("qdisc_dev")
	and target_0.getArgument(0).(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsch_781
	and target_0.getArgument(1).(BitwiseAndExpr).getLeftOperand().(VariableAccess).getTarget()=vparentid_786
	and target_0.getArgument(1).(BitwiseAndExpr).getRightOperand().(Literal).getValue()="4294901760"
	and target_0.getParent().(AssignExpr).getRValue() = target_0
	and target_0.getParent().(AssignExpr).getLValue().(VariableAccess).getTarget()=vsch_781
}

from Function func, Parameter vsch_781, Variable vparentid_786, FunctionCall target_0
where
func_0(vsch_781, vparentid_786, target_0)
and vsch_781.getType().hasName("Qdisc *")
and vparentid_786.getType().hasName("u32")
and vsch_781.getFunction() = func
and vparentid_786.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
