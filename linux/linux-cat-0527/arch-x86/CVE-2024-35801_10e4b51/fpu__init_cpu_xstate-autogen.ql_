/**
 * @name linux-10e4b5166df9ff7a2d5316138ca668b42d004422-fpu__init_cpu_xstate
 * @id cpp/linux/10e4b5166df9ff7a2d5316138ca668b42d004422/fpu--init-cpu-xstate
 * @description linux-10e4b5166df9ff7a2d5316138ca668b42d004422-arch/x86/kernel/fpu/xstate.c-fpu__init_cpu_xstate CVE-2024-35801
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vinit_fpstate, FunctionCall target_0) {
	target_0.getTarget().hasName("wrmsrl")
	and not target_0.getTarget().hasName("xfd_set_state")
	and target_0.getArgument(0).(Literal).getValue()="452"
	and target_0.getArgument(1).(ValueFieldAccess).getTarget().getName()="xfd"
	and target_0.getArgument(1).(ValueFieldAccess).getQualifier().(VariableAccess).getTarget()=vinit_fpstate
}

from Function func, Variable vinit_fpstate, FunctionCall target_0
where
func_0(vinit_fpstate, target_0)
and vinit_fpstate.getType().hasName("fpstate")
and not vinit_fpstate.getParentScope+() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
