/**
 * @name linux-29fa6825463c97e5157284db80107d1bfac5d77b-kvmclock_init
 * @id cpp/linux/29fa6825463c97e5157284db80107d1bfac5d77b/kvmclock-init
 * @description linux-29fa6825463c97e5157284db80107d1bfac5d77b-arch/x86/kernel/kvmclock.c-kvmclock_init CVE-2014-8134
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vpv_info, Function func, ExprStmt target_0) {
	target_0.getExpr().(AssignExpr).getLValue().(ValueFieldAccess).getTarget().getName()="paravirt_enabled"
	and target_0.getExpr().(AssignExpr).getLValue().(ValueFieldAccess).getQualifier().(VariableAccess).getTarget()=vpv_info
	and target_0.getExpr().(AssignExpr).getRValue().(Literal).getValue()="1"
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_0
}

from Function func, Variable vpv_info, ExprStmt target_0
where
func_0(vpv_info, func, target_0)
and vpv_info.getType().hasName("pv_info")
and not vpv_info.getParentScope+() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
