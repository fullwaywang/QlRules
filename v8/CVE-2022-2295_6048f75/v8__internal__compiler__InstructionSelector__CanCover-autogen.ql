/**
 * @name v8-6048f754931e0971cab58fb0de785482d175175b-v8__internal__compiler__InstructionSelector__CanCover
 * @id cpp/v8/6048f754931e0971cab58fb0de785482d175175b/v8internalcompilerinstructionselectorcancover
 * @description v8-6048f754931e0971cab58fb0de785482d175175b-src/compiler/backend/instruction-selector.cc-v8__internal__compiler__InstructionSelector__CanCover CVE-2022-2295
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func) {
exists(PointerFieldAccess target_0 |
	target_0.getTarget().getName()="current_block_"
	and target_0.getQualifier() instanceof ThisExpr
	and target_0.getEnclosingFunction() = func)
}

predicate func_1(Function func) {
exists(PointerFieldAccess target_1 |
	target_1.getTarget().getName()="current_effect_level_"
	and target_1.getQualifier() instanceof ThisExpr
	and target_1.getEnclosingFunction() = func)
}

predicate func_2(Function func, ThisExpr target_2) {
	target_2.getType() instanceof PointerType
	and target_2.getEnclosingFunction() = func
}

predicate func_3(Function func, ThisExpr target_3) {
	target_3.getType() instanceof PointerType
	and target_3.getEnclosingFunction() = func
}

predicate func_4(Parameter vuser_285, BlockStmt target_6, FunctionCall target_4) {
	target_4.getTarget().hasName("block")
	and target_4.getQualifier().(FunctionCall).getTarget().hasName("schedule")
	and target_4.getQualifier().(FunctionCall).getQualifier() instanceof ThisExpr
	and target_4.getArgument(0).(VariableAccess).getTarget()=vuser_285
	and target_4.getParent().(NEExpr).getLeftOperand().(FunctionCall).getTarget().hasName("block")
	and target_4.getParent().(NEExpr).getLeftOperand().(FunctionCall).getQualifier().(FunctionCall).getTarget().hasName("schedule")
	and target_4.getParent().(NEExpr).getLeftOperand().(FunctionCall).getQualifier().(FunctionCall).getQualifier().(ThisExpr).getType() instanceof PointerType
	and target_4.getParent().(NEExpr).getLeftOperand().(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("Node *")
	and target_4.getParent().(NEExpr).getParent().(IfStmt).getThen()=target_6
}

predicate func_5(Parameter vuser_285, BlockStmt target_7, FunctionCall target_5) {
	target_5.getTarget().hasName("GetEffectLevel")
	and target_5.getQualifier() instanceof ThisExpr
	and target_5.getArgument(0).(VariableAccess).getTarget()=vuser_285
	and target_5.getParent().(NEExpr).getLeftOperand().(FunctionCall).getTarget().hasName("GetEffectLevel")
	and target_5.getParent().(NEExpr).getLeftOperand().(FunctionCall).getQualifier().(ThisExpr).getType() instanceof PointerType
	and target_5.getParent().(NEExpr).getLeftOperand().(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("Node *")
	and target_5.getParent().(NEExpr).getParent().(IfStmt).getThen()=target_7
}

predicate func_6(EqualityOperation target_8, Function func, BlockStmt target_6) {
	target_6.getStmt(0).(ReturnStmt).getExpr().(Literal).getValue()="0"
	and target_6.getParent().(IfStmt).getCondition()=target_8
	and target_6.getEnclosingFunction() = func
}

predicate func_7(EqualityOperation target_9, Function func, BlockStmt target_7) {
	target_7.getStmt(0).(ReturnStmt).getExpr().(Literal).getValue()="0"
	and target_7.getParent().(IfStmt).getCondition()=target_9
	and target_7.getEnclosingFunction() = func
}

predicate func_8(Function func, EqualityOperation target_8) {
	target_8.getLeftOperand().(FunctionCall).getTarget().hasName("block")
	and target_8.getLeftOperand().(FunctionCall).getQualifier().(FunctionCall).getTarget().hasName("schedule")
	and target_8.getLeftOperand().(FunctionCall).getQualifier().(FunctionCall).getQualifier().(ThisExpr).getType() instanceof PointerType
	and target_8.getLeftOperand().(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("Node *")
	and target_8.getRightOperand() instanceof FunctionCall
	and target_8.getEnclosingFunction() = func
}

predicate func_9(Function func, EqualityOperation target_9) {
	target_9.getLeftOperand().(FunctionCall).getTarget().hasName("GetEffectLevel")
	and target_9.getLeftOperand().(FunctionCall).getQualifier().(ThisExpr).getType() instanceof PointerType
	and target_9.getLeftOperand().(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("Node *")
	and target_9.getRightOperand() instanceof FunctionCall
	and target_9.getEnclosingFunction() = func
}

from Function func, Parameter vuser_285, ThisExpr target_2, ThisExpr target_3, FunctionCall target_4, FunctionCall target_5, BlockStmt target_6, BlockStmt target_7, EqualityOperation target_8, EqualityOperation target_9
where
not func_0(func)
and not func_1(func)
and func_2(func, target_2)
and func_3(func, target_3)
and func_4(vuser_285, target_6, target_4)
and func_5(vuser_285, target_7, target_5)
and func_6(target_8, func, target_6)
and func_7(target_9, func, target_7)
and func_8(func, target_8)
and func_9(func, target_9)
and vuser_285.getType().hasName("Node *")
and vuser_285.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
