/**
 * @name curl-c97ec984fb2bc919a3aa86-parsenetrc
 * @id cpp/curl/c97ec984fb2bc919a3aa86/parsenetrc
 * @description curl-c97ec984fb2bc919a3aa86-lib/netrc.c-parsenetrc CVE-2022-35260
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vnetrcbuffer_82, Variable vnetrcbuffsize_83, Variable vfile_63, FunctionCall target_0) {
		target_0.getTarget().hasName("fgets")
		and not target_0.getTarget().hasName("Curl_get_line")
		and target_0.getArgument(0).(VariableAccess).getTarget()=vnetrcbuffer_82
		and target_0.getArgument(1).(VariableAccess).getTarget()=vnetrcbuffsize_83
		and target_0.getArgument(2).(VariableAccess).getTarget()=vfile_63
		and target_0.getParent().(LogicalAndExpr).getAnOperand().(NotExpr).getOperand().(VariableAccess).getTarget().getType().hasName("bool")
}

from Function func, Variable vnetrcbuffer_82, Variable vnetrcbuffsize_83, Variable vfile_63, FunctionCall target_0
where
func_0(vnetrcbuffer_82, vnetrcbuffsize_83, vfile_63, target_0)
and vnetrcbuffer_82.getType().hasName("char[4096]")
and vnetrcbuffsize_83.getType().hasName("int")
and vfile_63.getType().hasName("FILE *")
and vnetrcbuffer_82.(LocalVariable).getFunction() = func
and vnetrcbuffsize_83.(LocalVariable).getFunction() = func
and vfile_63.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
