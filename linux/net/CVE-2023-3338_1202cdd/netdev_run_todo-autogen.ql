/**
 * @name linux-1202cdd665315c525b5237e96e0bedc76d7e754f-netdev_run_todo
 * @id cpp/linux/1202cdd665315c525b5237e96e0bedc76d7e754f/netdev-run-todo
 * @description linux-1202cdd665315c525b5237e96e0bedc76d7e754f-net/core/dev.c-netdev_run_todo CVE-2023-3338
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func, Literal target_0) {
	target_0.getValue()="2527"
	and not target_0.getValue()="2525"
	and target_0.getEnclosingFunction() = func
}

predicate func_1(Function func, Literal target_1) {
	target_1.getValue()="2528"
	and not target_1.getValue()="2526"
	and target_1.getEnclosingFunction() = func
}

predicate func_2(Function func, Literal target_2) {
	target_2.getValue()="2529"
	and not target_2.getValue()="2527"
	and target_2.getEnclosingFunction() = func
}

predicate func_3(Function func, Literal target_3) {
	target_3.getValue()="2530"
	and not target_3.getValue()="2528"
	and target_3.getEnclosingFunction() = func
}

predicate func_4(Function func, Literal target_4) {
	target_4.getValue()="2531"
	and not target_4.getValue()="2529"
	and target_4.getEnclosingFunction() = func
}

predicate func_5(Function func, Literal target_5) {
	target_5.getValue()="2532"
	and not target_5.getValue()="2530"
	and target_5.getEnclosingFunction() = func
}

predicate func_6(Function func, Literal target_6) {
	target_6.getValue()="2533"
	and not target_6.getValue()="2531"
	and target_6.getEnclosingFunction() = func
}

predicate func_7(Function func, Initializer target_7) {
	target_7.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(0).(DoStmt).getCondition() instanceof Literal
	and target_7.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(PointerDereferenceExpr).getOperand().(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="ip_ptr"
	and target_7.getExpr().getEnclosingFunction() = func
}

predicate func_8(Variable v__UNIQUE_ID_rcu2534_10371, VariableAccess target_8) {
	target_8.getTarget()=v__UNIQUE_ID_rcu2534_10371
}

predicate func_9(Function func, Literal target_9) {
	target_9.getValue()="2536"
	and not target_9.getValue()="2534"
	and target_9.getEnclosingFunction() = func
}

predicate func_10(Function func, Literal target_10) {
	target_10.getValue()="2537"
	and not target_10.getValue()="2535"
	and target_10.getEnclosingFunction() = func
}

predicate func_11(Function func, Initializer target_11) {
	target_11.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(0).(DoStmt).getCondition() instanceof Literal
	and target_11.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(PointerDereferenceExpr).getOperand().(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="ip6_ptr"
	and target_11.getExpr().getEnclosingFunction() = func
}

predicate func_12(Variable v__UNIQUE_ID_rcu2538_10372, VariableAccess target_12) {
	target_12.getTarget()=v__UNIQUE_ID_rcu2538_10372
}

predicate func_13(Function func, Literal target_13) {
	target_13.getValue()="2540"
	and not target_13.getValue()="2538"
	and target_13.getEnclosingFunction() = func
}

predicate func_14(Function func, Literal target_14) {
	target_14.getValue()="2541"
	and not target_14.getValue()="2539"
	and target_14.getEnclosingFunction() = func
}

predicate func_15(Function func, Literal target_15) {
	target_15.getValue()="2542"
	and not target_15.getValue()="2526"
	and target_15.getEnclosingFunction() = func
}

predicate func_16(Function func, Literal target_16) {
	target_16.getValue()="2543"
	and not target_16.getValue()="2527"
	and target_16.getEnclosingFunction() = func
}

predicate func_17(Function func, ExprStmt target_17) {
	target_17.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(0) instanceof Literal
	and target_17.getEnclosingFunction() = func
}

predicate func_18(Function func, ExprStmt target_18) {
	target_18.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(0) instanceof Literal
	and target_18.getEnclosingFunction() = func
}

predicate func_19(Function func, ExprStmt target_19) {
	target_19.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(0) instanceof Literal
	and target_19.getEnclosingFunction() = func
}

predicate func_20(Function func, ExprStmt target_20) {
	target_20.getExpr().(FunctionCall).getTarget().hasName("__builtin_unreachable")
	and target_20.getEnclosingFunction() = func
}

predicate func_21(Function func, ExprStmt target_21) {
	target_21.getExpr().(FunctionCall).getTarget().hasName("__builtin_unreachable")
	and target_21.getEnclosingFunction() = func
}

predicate func_22(Function func, BlockStmt target_22) {
	target_22.getStmt(0).(AsmStmt).getChild(0) instanceof Literal
	and target_22.getEnclosingFunction() = func
}

predicate func_23(Function func, ExprStmt target_23) {
	target_23.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(FunctionCall).getTarget().hasName("__builtin_expect")
	and target_23.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(FunctionCall).getArgument(1) instanceof Literal
	and target_23.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(DoStmt).getCondition() instanceof Literal
	and target_23.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(2).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__builtin_expect")
	and target_23.getExpr().(StmtExpr).getStmt().(BlockStmt).getStmt(2).(ExprStmt).getExpr().(FunctionCall).getArgument(1) instanceof Literal
	and target_23.getEnclosingFunction() = func
}

/*predicate func_25(Variable v__ret_warn_on_10374, Variable v__flags_10374, IfStmt target_25) {
	target_25.getCondition().(FunctionCall).getTarget().hasName("__builtin_expect")
	and target_25.getCondition().(FunctionCall).getArgument(0).(NotExpr).getOperand().(NotExpr).getOperand().(VariableAccess).getTarget()=v__ret_warn_on_10374
	and target_25.getCondition().(FunctionCall).getArgument(1) instanceof Literal
	and target_25.getThen().(DoStmt).getCondition() instanceof Literal
	and target_25.getThen().(DoStmt).getStmt().(BlockStmt).getStmt(2).(DoStmt).getCondition() instanceof Literal
	and target_25.getThen().(DoStmt).getStmt().(BlockStmt).getStmt(2).(DoStmt).getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(0) instanceof StringLiteral
	and target_25.getThen().(DoStmt).getStmt().(BlockStmt).getStmt(2).(DoStmt).getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(1) instanceof Literal
	and target_25.getThen().(DoStmt).getStmt().(BlockStmt).getStmt(2).(DoStmt).getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(2).(VariableAccess).getTarget()=v__flags_10374
	and target_25.getThen().(DoStmt).getStmt().(BlockStmt).getStmt(2).(DoStmt).getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(3).(SizeofTypeOperator).getType() instanceof LongType
	and target_25.getThen().(DoStmt).getStmt().(BlockStmt).getStmt(2).(DoStmt).getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(3).(SizeofTypeOperator).getValue()="12"
}

*/
/*predicate func_27(Variable v__flags_10374, DoStmt target_27) {
	target_27.getCondition() instanceof Literal
	and target_27.getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(0) instanceof StringLiteral
	and target_27.getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(1) instanceof Literal
	and target_27.getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(2).(VariableAccess).getTarget()=v__flags_10374
	and target_27.getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(3).(SizeofTypeOperator).getType() instanceof LongType
	and target_27.getStmt().(BlockStmt).getStmt(0).(AsmStmt).getChild(3).(SizeofTypeOperator).getValue()="12"
}

*/
/*predicate func_28(Variable v__flags_10374, VariableAccess target_28) {
	target_28.getTarget()=v__flags_10374
}

*/
/*predicate func_29(Function func, SizeofTypeOperator target_29) {
	target_29.getType() instanceof LongType
	and target_29.getValue()="12"
	and target_29.getEnclosingFunction() = func
}

*/
/*predicate func_30(Variable v__ret_warn_on_10374, ExprStmt target_30) {
	target_30.getExpr().(FunctionCall).getTarget().hasName("__builtin_expect")
	and target_30.getExpr().(FunctionCall).getArgument(0).(NotExpr).getOperand().(NotExpr).getOperand().(VariableAccess).getTarget()=v__ret_warn_on_10374
	and target_30.getExpr().(FunctionCall).getArgument(1) instanceof Literal
}

*/
from Function func, Variable v__UNIQUE_ID_rcu2534_10371, Variable v__UNIQUE_ID_rcu2538_10372, Variable v__ret_warn_on_10374, Variable v__flags_10374, Literal target_0, Literal target_1, Literal target_2, Literal target_3, Literal target_4, Literal target_5, Literal target_6, Initializer target_7, VariableAccess target_8, Literal target_9, Literal target_10, Initializer target_11, VariableAccess target_12, Literal target_13, Literal target_14, Literal target_15, Literal target_16, ExprStmt target_17, ExprStmt target_18, ExprStmt target_19, ExprStmt target_20, ExprStmt target_21, BlockStmt target_22, ExprStmt target_23
where
func_0(func, target_0)
and func_1(func, target_1)
and func_2(func, target_2)
and func_3(func, target_3)
and func_4(func, target_4)
and func_5(func, target_5)
and func_6(func, target_6)
and func_7(func, target_7)
and func_8(v__UNIQUE_ID_rcu2534_10371, target_8)
and func_9(func, target_9)
and func_10(func, target_10)
and func_11(func, target_11)
and func_12(v__UNIQUE_ID_rcu2538_10372, target_12)
and func_13(func, target_13)
and func_14(func, target_14)
and func_15(func, target_15)
and func_16(func, target_16)
and func_17(func, target_17)
and func_18(func, target_18)
and func_19(func, target_19)
and func_20(func, target_20)
and func_21(func, target_21)
and func_22(func, target_22)
and func_23(func, target_23)
and v__UNIQUE_ID_rcu2534_10371.getType().hasName("in_device *")
and v__UNIQUE_ID_rcu2538_10372.getType().hasName("inet6_dev *")
and v__ret_warn_on_10374.getType().hasName("int")
and v__flags_10374.getType().hasName("int")
and v__UNIQUE_ID_rcu2534_10371.(LocalVariable).getFunction() = func
and v__UNIQUE_ID_rcu2538_10372.(LocalVariable).getFunction() = func
and v__ret_warn_on_10374.(LocalVariable).getFunction() = func
and v__flags_10374.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
