/**
 * @name frr-b1d33ec293e8e36fbb8766252f3b016d268e31ce-bgp_capability_llgr
 * @id cpp/frr/b1d33ec293e8e36fbb8766252f3b016d268e31ce/bgp-capability-llgr
 * @description frr-b1d33ec293e8e36fbb8766252f3b016d268e31ce-bgpd/bgp_open.c-bgp_capability_llgr CVE-2023-31489
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vs, Literal target_0) {
        target_0.getValue()="4"
        and not target_0.getValue()="7"
        and target_0.getParent().(AddExpr).getParent().(LEExpr).getLesserOperand().(AddExpr).getAnOperand().(FunctionCall).getTarget().hasName("stream_get_getp")
        and target_0.getParent().(AddExpr).getParent().(LEExpr).getLesserOperand().(AddExpr).getAnOperand().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vs
}

predicate func_1(Variable vs, FunctionCall target_1) {
        target_1.getTarget().hasName("stream_get3")
        and target_1.getArgument(0).(VariableAccess).getTarget()=vs

from Function func, Literal target_0, Literal target_1, Variable vs
where
func_0(vs, target_0)
and func_1(vs, target_1)
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
