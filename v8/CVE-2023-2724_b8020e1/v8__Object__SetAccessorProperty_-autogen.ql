/**
 * @name v8-b8020e1973d7d3a50b17c076cd948f079e59f9e5-v8__Object__SetAccessorProperty_
 * @id cpp/v8/b8020e1973d7d3a50b17c076cd948f079e59f9e5/v8objectsetaccessorproperty
 * @description v8-b8020e1973d7d3a50b17c076cd948f079e59f9e5-src/init/bootstrapper.cc-v8__Object__SetAccessorProperty_ CVE-2023-2724
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vattribute_5141, VariableAccess target_0) {
	target_0.getTarget()=vattribute_5141
	and vattribute_5141.getIndex() = 3
	and target_0.getParent().(FunctionCall).getParent().(ExprStmt).getExpr() instanceof FunctionCall
}

predicate func_1(Function func) {
exists(FunctionCall target_1 |
	target_1.getTarget().hasName("set_enumerable")
	and target_1.getQualifier().(VariableAccess).getType().hasName("PropertyDescriptor")
	and target_1.getArgument(0).(NotExpr).getOperand().(BitwiseAndExpr).getLeftOperand().(VariableAccess).getType().hasName("PropertyAttribute")
	and target_1.getEnclosingFunction() = func)
}

predicate func_2(Function func) {
exists(ExprStmt target_2 |
	target_2.getExpr().(FunctionCall).getTarget().hasName("set_configurable")
	and target_2.getExpr().(FunctionCall).getQualifier().(VariableAccess).getType().hasName("PropertyDescriptor")
	and target_2.getExpr().(FunctionCall).getArgument(0).(NotExpr).getOperand().(BitwiseAndExpr).getLeftOperand().(VariableAccess).getType().hasName("PropertyAttribute")
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_2
	and target_2.getFollowingStmt() instanceof ReturnStmt)
}

predicate func_3(Variable vgetter_i_5150, Function func) {
exists(ExprStmt target_3 |
	target_3.getExpr().(FunctionCall).getTarget().hasName("set_get")
	and target_3.getExpr().(FunctionCall).getQualifier().(VariableAccess).getType().hasName("PropertyDescriptor")
	and target_3.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vgetter_i_5150
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_3
	and target_3.getFollowingStmt() instanceof ReturnStmt)
}

predicate func_4(Variable vsetter_i_5151, Function func) {
exists(ExprStmt target_4 |
	target_4.getExpr().(FunctionCall).getTarget().hasName("set_set")
	and target_4.getExpr().(FunctionCall).getQualifier().(VariableAccess).getType().hasName("PropertyDescriptor")
	and target_4.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vsetter_i_5151
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_4
	and target_4.getFollowingStmt() instanceof ReturnStmt)
}

predicate func_5(Function func) {
exists(DoStmt target_5 |
	target_5.getCondition().(Literal).getValue()="0"
	and target_5.getStmt().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(VariableAccess).getType().hasName("Use[1]")
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_5
	and target_5.getFollowingStmt() instanceof ReturnStmt)
}

predicate func_6(Parameter vname_5139, FunctionCall target_6) {
	target_6.getTarget().hasName("OpenHandle")
	and target_6.getArgument(0).(OverloadedPointerDereferenceExpr).getQualifier().(VariableAccess).getTarget()=vname_5139
	and target_6.getParent().(FunctionCall).getParent().(ExprStmt).getExpr() instanceof FunctionCall
}

predicate func_7(Variable vself_5145, VariableAccess target_7) {
	target_7.getTarget()=vself_5145
	and target_7.getParent().(FunctionCall).getParent().(FunctionCall).getArgument(0) instanceof FunctionCall
}

predicate func_8(Variable vgetter_i_5150, VariableAccess target_8) {
	target_8.getTarget()=vgetter_i_5150
	and target_8.getParent().(FunctionCall).getParent().(ExprStmt).getExpr() instanceof FunctionCall
}

predicate func_9(Variable vsetter_i_5151, VariableAccess target_9) {
	target_9.getTarget()=vsetter_i_5151
	and target_9.getParent().(FunctionCall).getParent().(ExprStmt).getExpr() instanceof FunctionCall
}

predicate func_10(Parameter vattribute_5141, Variable vself_5145, Variable vgetter_i_5150, Variable vsetter_i_5151, FunctionCall target_10) {
	target_10.getTarget().hasName("DefineAccessor")
	and target_10.getArgument(0).(FunctionCall).getTarget().hasName("cast")
	and target_10.getArgument(0).(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vself_5145
	and target_10.getArgument(1) instanceof FunctionCall
	and target_10.getArgument(2).(VariableAccess).getTarget()=vgetter_i_5150
	and target_10.getArgument(3).(VariableAccess).getTarget()=vsetter_i_5151
	and target_10.getArgument(4).(VariableAccess).getTarget()=vattribute_5141
}

from Function func, Parameter vname_5139, Parameter vattribute_5141, Variable vself_5145, Variable vgetter_i_5150, Variable vsetter_i_5151, VariableAccess target_0, FunctionCall target_6, VariableAccess target_7, VariableAccess target_8, VariableAccess target_9, FunctionCall target_10
where
func_0(vattribute_5141, target_0)
and not func_1(func)
and not func_2(func)
and not func_3(vgetter_i_5150, func)
and not func_4(vsetter_i_5151, func)
and not func_5(func)
and func_6(vname_5139, target_6)
and func_7(vself_5145, target_7)
and func_8(vgetter_i_5150, target_8)
and func_9(vsetter_i_5151, target_9)
and func_10(vattribute_5141, vself_5145, vgetter_i_5150, vsetter_i_5151, target_10)
and vname_5139.getType().hasName("Local<Name>")
and vattribute_5141.getType().hasName("PropertyAttribute")
and vself_5145.getType().hasName("Handle<JSReceiver>")
and vgetter_i_5150.getType().hasName("Handle<Object>")
and vsetter_i_5151.getType().hasName("Handle<Object>")
and vname_5139.getFunction() = func
and vattribute_5141.getFunction() = func
and vself_5145.(LocalVariable).getFunction() = func
and vgetter_i_5150.(LocalVariable).getFunction() = func
and vsetter_i_5151.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
