/**
 * @name linux-410dd3cf4c9b36f27ed4542ee18b1af5e68645a4-parse_rock_ridge_inode
 * @id cpp/linux/410dd3cf4c9b36f27ed4542ee18b1af5e68645a4/parse-rock-ridge-inode
 * @description linux-410dd3cf4c9b36f27ed4542ee18b1af5e68645a4-fs/isofs/rock.c-parse_rock_ridge_inode CVE-2014-5472
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Function func, Literal target_0) {
	target_0.getValue()="14"
	and not target_0.getValue()="2"
	and target_0.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("parse_rock_ridge_inode_internal")
	and target_0.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("iso_directory_record *")
	and target_0.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("inode *")
	and target_0.getEnclosingFunction() = func
}

predicate func_3(Function func) {
exists(BitwiseOrExpr target_3 |
	target_3.getLeftOperand().(VariableAccess).getType().hasName("int")
	and target_3.getRightOperand().(Literal).getValue()="1"
	and target_3.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("parse_rock_ridge_inode_internal")
	and target_3.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("iso_directory_record *")
	and target_3.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("inode *")
	and target_3.getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(2) instanceof Literal
	and target_3.getEnclosingFunction() = func)
}

from Function func, Literal target_0
where
func_0(func, target_0)
and not func_3(func)
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
