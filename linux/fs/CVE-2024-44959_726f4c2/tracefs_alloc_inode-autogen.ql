/**
 * @name linux-726f4c241e17be75a9cf6870d80cd7479dc89e8f-tracefs_alloc_inode
 * @id cpp/linux/726f4c241e17be75a9cf6870d80cd7479dc89e8f/tracefs-alloc-inode
 * @description linux-726f4c241e17be75a9cf6870d80cd7479dc89e8f-fs/tracefs/inode.c-tracefs_alloc_inode CVE-2024-44959
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vti_42) {
exists(PointerFieldAccess target_0 |
	target_0.getTarget().getName()="vfs_inode"
	and target_0.getQualifier().(VariableAccess).getTarget()=vti_42
)
}

predicate func_1(Variable vti_42, VariableAccess target_1) {
	target_1.getTarget()=vti_42
}

predicate func_2(Variable vti_42, ValueFieldAccess target_2) {
	exists(PointerFieldAccess obj_0 | obj_0=target_2.getQualifier() |
		obj_0.getTarget().getName()="(unknown field)"
		and obj_0.getQualifier().(VariableAccess).getTarget()=vti_42
	)
	and target_2.getTarget().getName()="vfs_inode"
}

from Function func, Variable vti_42, VariableAccess target_1, ValueFieldAccess target_2
where
not func_0(vti_42)
and func_1(vti_42, target_1)
and func_2(vti_42, target_2)
and vti_42.getType().hasName("tracefs_inode *")
and vti_42.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
