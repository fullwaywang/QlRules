/**
 * @name linux-16c4770c75b1223998adbeb7286f9a15c65fba73-raid_preresume
 * @id cpp/linux/16c4770c75b1223998adbeb7286f9a15c65fba73/raid-preresume
 * @description linux-16c4770c75b1223998adbeb7286f9a15c65fba73-drivers/md/dm-raid.c-raid_preresume CVE-2024-35794
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vmddev_3974, AddressOfExpr target_0) {
	target_0.getOperand().(PointerFieldAccess).getTarget().getName()="recovery"
	and target_0.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vmddev_3974
	and target_0.getParent().(FunctionCall).getParent().(ExprStmt).getExpr() instanceof FunctionCall
}

predicate func_1(Function func, ExprStmt target_1) {
	target_1.getExpr().(FunctionCall).getTarget().hasName("set_bit")
	and target_1.getExpr().(FunctionCall).getArgument(1) instanceof AddressOfExpr
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_1
}

from Function func, Variable vmddev_3974, AddressOfExpr target_0, ExprStmt target_1
where
func_0(vmddev_3974, target_0)
and func_1(func, target_1)
and vmddev_3974.getType().hasName("mddev *")
and vmddev_3974.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
