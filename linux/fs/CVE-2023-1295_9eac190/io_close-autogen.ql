/**
 * @name linux-9eac1904d3364254d622bf2c771c4f85cd435fc2-io_close
 * @id cpp/linux/9eac1904d3364254d622bf2c771c4f85cd435fc2/io-close
 * @description linux-9eac1904d3364254d622bf2c771c4f85cd435fc2-fs/io_uring.c-io_close CVE-2023-1295
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vclose_4504, Variable vret_4505, FunctionCall target_0) {
	target_0.getTarget().hasName("close_fd_get_file")
	and not target_0.getTarget().hasName("debug_lockdep_rcu_enabled")
	and target_0.getArgument(0).(PointerFieldAccess).getTarget().getName()="fd"
	and target_0.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_0.getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="put_file"
	and target_0.getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_0.getParent().(AssignExpr).getRValue() = target_0
	and target_0.getParent().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
}

predicate func_2(Parameter vforce_nonblock_4501, Variable vclose_4504, ExprStmt target_57, IfStmt target_2) {
	target_2.getCondition().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getTarget().getName()="flush"
	and target_2.getCondition().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="f_op"
	and target_2.getCondition().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="put_file"
	and target_2.getCondition().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_2.getCondition().(LogicalAndExpr).getRightOperand().(VariableAccess).getTarget()=vforce_nonblock_4501
	and target_2.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr() instanceof AssignOrExpr
	and target_2.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr() instanceof AssignAndExpr
	and target_2.getThen().(BlockStmt).getStmt(2).(ExprStmt).getExpr() instanceof AssignOrExpr
	and target_2.getThen().(BlockStmt).getStmt(3) instanceof ReturnStmt
	and target_2.getLocation().isBefore(target_57.getLocation())
}

predicate func_3(Parameter vreq_4501, Variable vret_4505, ExprStmt target_58, IfStmt target_3) {
	target_3.getCondition().(RelationalOperation).getLesserOperand().(VariableAccess).getTarget()=vret_4505
	and target_3.getCondition().(RelationalOperation).getGreaterOperand().(Literal).getValue()="0"
	and target_3.getThen().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("req_set_fail_links")
	and target_3.getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vreq_4501
	and target_3.getLocation().isBefore(target_58.getLocation())
}

predicate func_5(Function func) {
exists(FunctionCall target_5 |
	target_5.getTarget().hasName("spin_lock")
	and target_5.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
	and target_5.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
	and target_5.getEnclosingFunction() = func)
}

predicate func_6(ExprStmt target_58, Function func) {
exists(ExprStmt target_6 |
	target_6.getExpr().(AssignExpr).getLValue().(VariableAccess).getType().hasName("fdtable *")
	and target_6.getExpr().(AssignExpr).getRValue().(StmtExpr).getStmt().(BlockStmt).getStmt(1).(DoStmt).getCondition() instanceof Literal
	and target_6.getExpr().(AssignExpr).getRValue().(StmtExpr).getStmt().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(VariableAccess).getType().hasName("fdtable *")
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_6
	and target_6.getLocation().isBefore(target_58.getLocation()))
}

predicate func_7(LogicalAndExpr target_59, Function func) {
exists(DoStmt target_7 |
	target_7.getCondition() instanceof Literal
	and target_7.getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(NotExpr).getValue()="0"
	and target_7.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(0)=target_7
	and target_7.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_59
	and target_7.getEnclosingFunction() = func)
}

/*predicate func_8(ReturnStmt target_48, Function func) {
exists(NotExpr target_8 |
	target_8.getValue()="0"
	and target_8.getParent().(IfStmt).getThen()=target_48
	and target_8.getEnclosingFunction() = func)
}

*/
/*predicate func_9(RelationalOperation target_39, Function func) {
exists(ExprStmt target_9 |
	target_9.getParent().(IfStmt).getCondition()=target_39
	and target_9.getEnclosingFunction() = func)
}

*/
predicate func_10(Function func) {
exists(PointerDereferenceExpr target_10 |
	target_10.getOperand().(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="fdt"
	and target_10.getOperand().(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
	and target_10.getEnclosingFunction() = func)
}

/*predicate func_11(NotExpr target_60, Function func) {
exists(DoStmt target_11 |
	target_11.getCondition() instanceof Literal
	and target_11.getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getLeftOperand().(FunctionCall).getTarget().hasName("debug_lockdep_rcu_enabled")
	and target_11.getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(LogicalAndExpr).getLeftOperand().(LogicalAndExpr).getRightOperand().(NotExpr).getOperand().(VariableAccess).getType().hasName("bool")
	and target_11.getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(LogicalAndExpr).getRightOperand().(NotExpr).getOperand().(LogicalOrExpr).getLeftOperand().(FunctionCall).getTarget().hasName("lock_is_held")
	and target_11.getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(LogicalAndExpr).getRightOperand().(NotExpr).getOperand().(LogicalOrExpr).getRightOperand().(FunctionCall).getTarget().hasName("rcu_read_lock_held")
	and target_11.getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getType().hasName("bool")
	and target_11.getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("lockdep_rcu_suspicious")
	and target_11.getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(FunctionCall).getArgument(0) instanceof StringLiteral
	and target_11.getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(FunctionCall).getArgument(1) instanceof Literal
	and target_11.getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(FunctionCall).getArgument(2).(StringLiteral).getValue()="suspicious rcu_dereference_check() usage"
	and target_11.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(1)=target_11
	and target_11.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_60
	and target_11.getEnclosingFunction() = func)
}

*/
/*predicate func_12(Parameter vforce_nonblock_4501, Variable vclose_4504, BlockStmt target_61) {
exists(LogicalAndExpr target_12 |
	target_12.getLeftOperand().(FunctionCall).getTarget().hasName("debug_lockdep_rcu_enabled")
	and target_12.getRightOperand().(NotExpr).getOperand().(VariableAccess).getType().hasName("bool")
	and target_12.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getTarget().getName()="flush"
	and target_12.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="f_op"
	and target_12.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="put_file"
	and target_12.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_12.getParent().(LogicalAndExpr).getRightOperand().(VariableAccess).getTarget()=vforce_nonblock_4501
	and target_12.getParent().(LogicalAndExpr).getParent().(IfStmt).getThen()=target_61)
}

*/
/*predicate func_13(Parameter vforce_nonblock_4501, Variable vclose_4504, BlockStmt target_61) {
exists(NotExpr target_13 |
	target_13.getOperand().(LogicalOrExpr).getLeftOperand().(FunctionCall).getTarget().hasName("lock_is_held")
	and target_13.getOperand().(LogicalOrExpr).getLeftOperand().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ValueFieldAccess).getTarget().getName()="dep_map"
	and target_13.getOperand().(LogicalOrExpr).getLeftOperand().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="(unknown field)"
	and target_13.getOperand().(LogicalOrExpr).getLeftOperand().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="(unknown field)"
	and target_13.getOperand().(LogicalOrExpr).getRightOperand().(FunctionCall).getTarget().hasName("rcu_read_lock_held")
	and target_13.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getTarget().getName()="flush"
	and target_13.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="f_op"
	and target_13.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="put_file"
	and target_13.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_13.getParent().(LogicalAndExpr).getRightOperand().(VariableAccess).getTarget()=vforce_nonblock_4501
	and target_13.getParent().(LogicalAndExpr).getParent().(IfStmt).getThen()=target_61)
}

*/
/*predicate func_14(Function func) {
exists(AssignExpr target_14 |
	target_14.getLValue().(VariableAccess).getType().hasName("bool")
	and target_14.getEnclosingFunction() = func)
}

*/
/*predicate func_15(NotExpr target_60, Function func) {
exists(ExprStmt target_15 |
	target_15.getExpr().(FunctionCall).getTarget().hasName("lockdep_rcu_suspicious")
	and target_15.getExpr().(FunctionCall).getArgument(0) instanceof StringLiteral
	and target_15.getExpr().(FunctionCall).getArgument(1) instanceof Literal
	and target_15.getExpr().(FunctionCall).getArgument(2).(StringLiteral).getValue()="suspicious rcu_dereference_check() usage"
	and target_15.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(1)=target_15
	and target_15.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_60
	and target_15.getEnclosingFunction() = func)
}

*/
/*predicate func_16(NotExpr target_60, Function func) {
exists(EmptyStmt target_16 |
	target_16.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(2)=target_16
	and target_16.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_60
	and target_16.getEnclosingFunction() = func)
}

*/
/*predicate func_17(NotExpr target_60, Function func) {
exists(ExprStmt target_17 |
	target_17.getExpr().(VariableAccess).getType().hasName("fdtable *")
	and target_17.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(3)=target_17
	and target_17.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_60
	and target_17.getEnclosingFunction() = func)
}

*/
predicate func_18(Variable vclose_4504, BlockStmt target_61) {
exists(RelationalOperation target_18 |
	 (target_18 instanceof GEExpr or target_18 instanceof LEExpr)
	and target_18.getGreaterOperand().(PointerFieldAccess).getTarget().getName()="fd"
	and target_18.getGreaterOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_18.getLesserOperand().(PointerFieldAccess).getTarget().getName()="max_fds"
	and target_18.getLesserOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("fdtable *")
	and target_18.getParent().(IfStmt).getThen()=target_61)
}

predicate func_19(Function func) {
exists(FunctionCall target_19 |
	target_19.getTarget().hasName("spin_unlock")
	and target_19.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
	and target_19.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
	and target_19.getEnclosingFunction() = func)
}

predicate func_20(LogicalAndExpr target_59, Function func) {
exists(GotoStmt target_20 |
	target_20.getName() ="err"
	and target_20.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(1)=target_20
	and target_20.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_59
	and target_20.getEnclosingFunction() = func)
}

predicate func_21(Variable vclose_4504, ExprStmt target_58, Function func) {
exists(ExprStmt target_21 |
	target_21.getExpr().(AssignExpr).getLValue().(VariableAccess).getType().hasName("file *")
	and target_21.getExpr().(AssignExpr).getRValue().(ArrayExpr).getArrayBase().(PointerFieldAccess).getTarget().getName()="fd"
	and target_21.getExpr().(AssignExpr).getRValue().(ArrayExpr).getArrayBase().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("fdtable *")
	and target_21.getExpr().(AssignExpr).getRValue().(ArrayExpr).getArrayOffset().(PointerFieldAccess).getTarget().getName()="fd"
	and target_21.getExpr().(AssignExpr).getRValue().(ArrayExpr).getArrayOffset().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_21
	and target_21.getLocation().isBefore(target_58.getLocation()))
}

predicate func_22(ExprStmt target_58, Function func) {
exists(IfStmt target_22 |
	target_22.getCondition().(NotExpr).getOperand().(VariableAccess).getType().hasName("file *")
	and target_22.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("spin_unlock")
	and target_22.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
	and target_22.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
	and target_22.getThen().(BlockStmt).getStmt(1).(GotoStmt).getName() ="err"
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_22
	and target_22.getLocation().isBefore(target_58.getLocation()))
}

predicate func_24(ExprStmt target_58, Function func) {
exists(IfStmt target_24 |
	target_24.getCondition().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getTarget().getName()="f_op"
	and target_24.getCondition().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("file *")
	and target_24.getCondition().(EqualityOperation).getRightOperand().(AddressOfExpr).getOperand().(VariableAccess).getType().hasName("const file_operations")
	and target_24.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("spin_unlock")
	and target_24.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
	and target_24.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
	and target_24.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getType().hasName("file *")
	and target_24.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getRValue().(Literal).getValue()="0"
	and target_24.getThen().(BlockStmt).getStmt(2).(GotoStmt).getName() ="err"
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_24
	and target_24.getLocation().isBefore(target_58.getLocation()))
}

predicate func_25(Parameter vforce_nonblock_4501, ExprStmt target_58, Function func) {
exists(IfStmt target_25 |
	target_25.getCondition().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getTarget().getName()="flush"
	and target_25.getCondition().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="f_op"
	and target_25.getCondition().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("file *")
	and target_25.getCondition().(LogicalAndExpr).getRightOperand().(VariableAccess).getTarget()=vforce_nonblock_4501
	and target_25.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("spin_unlock")
	and target_25.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
	and target_25.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
	and target_25.getThen().(BlockStmt).getStmt(1) instanceof ReturnStmt
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_25
	and target_25.getLocation().isBefore(target_58.getLocation()))
}

/*predicate func_27(Function func) {
exists(FunctionCall target_27 |
	target_27.getTarget().hasName("spin_unlock")
	and target_27.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
	and target_27.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
	and target_27.getEnclosingFunction() = func)
}

*/
predicate func_28(Variable vclose_4504, Variable vret_4505, ExprStmt target_58, LogicalAndExpr target_59, ConditionalExpr target_63, RelationalOperation target_64, Function func) {
exists(ExprStmt target_28 |
	target_28.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
	and target_28.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("__close_fd_get_file")
	and target_28.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="fd"
	and target_28.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_28.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(VariableAccess).getType().hasName("file *")
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_28
	and target_28.getLocation().isBefore(target_58.getLocation())
	and target_28.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_59.getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
	and target_63.getElse().(VariableAccess).getLocation().isBefore(target_28.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation())
	and target_28.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_64.getLesserOperand().(VariableAccess).getLocation()))
}

/*predicate func_29(Variable vclose_4504, Variable vret_4505, LogicalAndExpr target_59) {
exists(FunctionCall target_29 |
	target_29.getTarget().hasName("__close_fd_get_file")
	and target_29.getArgument(0).(PointerFieldAccess).getTarget().getName()="fd"
	and target_29.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_29.getArgument(1).(AddressOfExpr).getOperand().(VariableAccess).getType().hasName("file *")
	and target_29.getParent().(AssignExpr).getRValue() = target_29
	and target_29.getParent().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
	and target_29.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_59.getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation()))
}

*/
predicate func_31(ExprStmt target_58, Function func) {
exists(ExprStmt target_31 |
	target_31.getExpr().(FunctionCall).getTarget().hasName("spin_unlock")
	and target_31.getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
	and target_31.getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_31
	and target_31.getLocation().isBefore(target_58.getLocation()))
}

predicate func_32(Variable vret_4505, ExprStmt target_58, RelationalOperation target_64, Function func) {
exists(IfStmt target_32 |
	target_32.getCondition() instanceof RelationalOperation
	and target_32.getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition() instanceof EqualityOperation
	and target_32.getThen().(BlockStmt).getStmt(0).(IfStmt).getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
	and target_32.getThen().(BlockStmt).getStmt(0).(IfStmt).getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(UnaryMinusExpr).getValue()="-9"
	and target_32.getThen().(BlockStmt).getStmt(1).(GotoStmt).getName() ="err"
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_32
	and target_32.getLocation().isBefore(target_58.getLocation())
	and target_64.getLesserOperand().(VariableAccess).getLocation().isBefore(target_32.getThen().(BlockStmt).getStmt(0).(IfStmt).getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation()))
}

predicate func_33(Variable vret_4505, ExprStmt target_58, ExprStmt target_65, Function func) {
exists(ExprStmt target_33 |
	target_33.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
	and target_33.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("filp_close")
	and target_33.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getType().hasName("file *")
	and target_33.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="files"
	and target_33.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(FunctionCall).getTarget().hasName("get_current")
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_33
	and target_33.getLocation().isBefore(target_58.getLocation())
	and target_33.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_65.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getLocation()))
}

/*predicate func_35(Variable vclose_4504) {
exists(FunctionCall target_35 |
	target_35.getTarget().hasName("get_current")
	and target_35.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("filp_close")
	and target_35.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="put_file"
	and target_35.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_35.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="files"
	and target_35.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier() instanceof ValueFieldAccess)
}

*/
predicate func_36(ExprStmt target_66, Function func) {
exists(IfStmt target_36 |
	target_36.getCondition().(VariableAccess).getType().hasName("file *")
	and target_36.getThen().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("fput")
	and target_36.getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getType().hasName("file *")
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_36
	and target_36.getLocation().isBefore(target_66.getLocation()))
}

predicate func_38(Variable vclose_4504, PointerFieldAccess target_38) {
	target_38.getTarget().getName()="fd"
	and target_38.getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_38.getParent().(FunctionCall).getParent().(AssignExpr).getRValue() instanceof FunctionCall
}

predicate func_39(Variable vret_4505, ReturnStmt target_48, RelationalOperation target_39) {
	 (target_39 instanceof GTExpr or target_39 instanceof LTExpr)
	and target_39.getLesserOperand().(VariableAccess).getTarget()=vret_4505
	and target_39.getGreaterOperand().(Literal).getValue()="0"
	and target_39.getParent().(IfStmt).getThen()=target_48
}

predicate func_40(Variable vret_4505, EqualityOperation target_40) {
	target_40.getLeftOperand().(VariableAccess).getTarget()=vret_4505
	and target_40.getRightOperand().(UnaryMinusExpr).getValue()="-2"
}

predicate func_41(Function func, UnaryMinusExpr target_41) {
	target_41.getValue()="-9"
	and target_41.getEnclosingFunction() = func
}

predicate func_42(LogicalAndExpr target_59, Function func, ReturnStmt target_42) {
	target_42.getExpr().(UnaryMinusExpr).getValue()="-11"
	and target_42.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_59
	and target_42.getEnclosingFunction() = func
}

predicate func_43(Variable vclose_4504, VariableAccess target_43) {
	target_43.getTarget()=vclose_4504
}

predicate func_44(Variable vclose_4504, VariableAccess target_44) {
	target_44.getTarget()=vclose_4504
	and target_44.getParent().(PointerFieldAccess).getParent().(AddressOfExpr).getParent().(FunctionCall).getParent().(AssignExpr).getRValue() instanceof FunctionCall
}

predicate func_45(Parameter vforce_nonblock_4501, Variable vclose_4504, BlockStmt target_61, VariableAccess target_45) {
	target_45.getTarget()=vforce_nonblock_4501
	and target_45.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getTarget().getName()="flush"
	and target_45.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="f_op"
	and target_45.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="put_file"
	and target_45.getParent().(LogicalAndExpr).getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_45.getParent().(LogicalAndExpr).getParent().(IfStmt).getThen()=target_61
}

predicate func_46(Variable vclose_4504, PointerFieldAccess target_46) {
	target_46.getTarget().getName()="put_file"
	and target_46.getQualifier().(VariableAccess).getTarget()=vclose_4504
}

predicate func_47(Variable vclose_4504, LogicalAndExpr target_59, PointerFieldAccess target_47) {
	target_47.getTarget().getName()="put_file"
	and target_47.getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_47.getQualifier().(VariableAccess).getLocation().isBefore(target_59.getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_48(Variable vret_4505, RelationalOperation target_39, ReturnStmt target_48) {
	target_48.getExpr().(ConditionalExpr).getCondition() instanceof EqualityOperation
	and target_48.getExpr().(ConditionalExpr).getThen() instanceof UnaryMinusExpr
	and target_48.getExpr().(ConditionalExpr).getElse().(VariableAccess).getTarget()=vret_4505
	and target_48.getParent().(IfStmt).getCondition()=target_39
}

predicate func_49(Variable vclose_4504, AddressOfExpr target_68, ExprStmt target_57, PointerFieldAccess target_49) {
	target_49.getTarget().getName()="put_file"
	and target_49.getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_68.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_49.getQualifier().(VariableAccess).getLocation())
	and target_49.getQualifier().(VariableAccess).getLocation().isBefore(target_57.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_50(Parameter vreq_4501, AssignOrExpr target_50) {
	target_50.getLValue().(ValueFieldAccess).getTarget().getName()="flags"
	and target_50.getLValue().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="work"
	and target_50.getLValue().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vreq_4501
	and target_50.getRValue() instanceof EnumConstantAccess
}

predicate func_51(Parameter vreq_4501, AssignAndExpr target_51) {
	target_51.getLValue().(PointerFieldAccess).getTarget().getName()="flags"
	and target_51.getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vreq_4501
	and target_51.getRValue().(ComplementExpr).getValue()="4294966783"
}

predicate func_52(Parameter vreq_4501, AssignOrExpr target_52) {
	target_52.getLValue().(PointerFieldAccess).getTarget().getName()="flags"
	and target_52.getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vreq_4501
}

/*predicate func_53(Variable vclose_4504, LogicalAndExpr target_59, ExprStmt target_58, PointerFieldAccess target_53) {
	target_53.getTarget().getName()="put_file"
	and target_53.getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_59.getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_53.getQualifier().(VariableAccess).getLocation())
	and target_53.getQualifier().(VariableAccess).getLocation().isBefore(target_58.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

*/
predicate func_54(Parameter vreq_4501, Variable vclose_4504, ValueFieldAccess target_54) {
	target_54.getTarget().getName()="identity"
	and target_54.getQualifier().(PointerFieldAccess).getTarget().getName()="work"
	and target_54.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vreq_4501
	and target_54.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("filp_close")
	and target_54.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="put_file"
	and target_54.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_54.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="files"
}

predicate func_55(Variable vclose_4504, ExprStmt target_57, ExprStmt target_66, PointerFieldAccess target_55) {
	target_55.getTarget().getName()="put_file"
	and target_55.getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_57.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_55.getQualifier().(VariableAccess).getLocation())
	and target_55.getQualifier().(VariableAccess).getLocation().isBefore(target_66.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_56(Variable vclose_4504, ExprStmt target_58, PointerFieldAccess target_56) {
	target_56.getTarget().getName()="put_file"
	and target_56.getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_58.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_56.getQualifier().(VariableAccess).getLocation())
}

predicate func_57(Variable vclose_4504, Variable vret_4505, ExprStmt target_57) {
	target_57.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
	and target_57.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("filp_close")
	and target_57.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="put_file"
	and target_57.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_57.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="files"
	and target_57.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier() instanceof ValueFieldAccess
}

predicate func_58(Variable vclose_4504, ExprStmt target_58) {
	target_58.getExpr().(FunctionCall).getTarget().hasName("fput")
	and target_58.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="put_file"
	and target_58.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
}

predicate func_59(Parameter vforce_nonblock_4501, Variable vclose_4504, LogicalAndExpr target_59) {
	target_59.getLeftOperand().(PointerFieldAccess).getTarget().getName()="flush"
	and target_59.getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="f_op"
	and target_59.getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="put_file"
	and target_59.getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_59.getRightOperand().(VariableAccess).getTarget()=vforce_nonblock_4501
}

predicate func_60(Variable vclose_4504, NotExpr target_60) {
	target_60.getOperand().(PointerFieldAccess).getTarget().getName()="put_file"
	and target_60.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
}

predicate func_61(Function func, BlockStmt target_61) {
	target_61.getStmt(0).(ExprStmt).getExpr() instanceof AssignOrExpr
	and target_61.getStmt(1).(ExprStmt).getExpr() instanceof AssignAndExpr
	and target_61.getStmt(2).(ExprStmt).getExpr() instanceof AssignOrExpr
	and target_61.getStmt(3) instanceof ReturnStmt
	and target_61.getEnclosingFunction() = func
}

predicate func_63(Variable vret_4505, ConditionalExpr target_63) {
	target_63.getCondition() instanceof EqualityOperation
	and target_63.getThen() instanceof UnaryMinusExpr
	and target_63.getElse().(VariableAccess).getTarget()=vret_4505
}

predicate func_64(Variable vret_4505, RelationalOperation target_64) {
	 (target_64 instanceof GTExpr or target_64 instanceof LTExpr)
	and target_64.getLesserOperand().(VariableAccess).getTarget()=vret_4505
	and target_64.getGreaterOperand().(Literal).getValue()="0"
}

predicate func_65(Parameter vreq_4501, Variable vret_4505, ExprStmt target_65) {
	target_65.getExpr().(FunctionCall).getTarget().hasName("__io_req_complete")
	and target_65.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vreq_4501
	and target_65.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vret_4505
	and target_65.getExpr().(FunctionCall).getArgument(2).(Literal).getValue()="0"
	and target_65.getExpr().(FunctionCall).getArgument(3).(VariableAccess).getTarget().getType().hasName("io_comp_state *")
}

predicate func_66(Variable vclose_4504, ExprStmt target_66) {
	target_66.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="put_file"
	and target_66.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
	and target_66.getExpr().(AssignExpr).getRValue().(Literal).getValue()="0"
}

predicate func_68(Variable vclose_4504, AddressOfExpr target_68) {
	target_68.getOperand().(PointerFieldAccess).getTarget().getName()="put_file"
	and target_68.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
}

from Function func, Parameter vreq_4501, Parameter vforce_nonblock_4501, Variable vclose_4504, Variable vret_4505, FunctionCall target_0, IfStmt target_2, IfStmt target_3, PointerFieldAccess target_38, RelationalOperation target_39, EqualityOperation target_40, UnaryMinusExpr target_41, ReturnStmt target_42, VariableAccess target_43, VariableAccess target_44, VariableAccess target_45, PointerFieldAccess target_46, PointerFieldAccess target_47, ReturnStmt target_48, PointerFieldAccess target_49, AssignOrExpr target_50, AssignAndExpr target_51, AssignOrExpr target_52, ValueFieldAccess target_54, PointerFieldAccess target_55, PointerFieldAccess target_56, ExprStmt target_57, ExprStmt target_58, LogicalAndExpr target_59, NotExpr target_60, BlockStmt target_61, ConditionalExpr target_63, RelationalOperation target_64, ExprStmt target_65, ExprStmt target_66, AddressOfExpr target_68
where
func_0(vclose_4504, vret_4505, target_0)
and func_2(vforce_nonblock_4501, vclose_4504, target_57, target_2)
and func_3(vreq_4501, vret_4505, target_58, target_3)
and not func_5(func)
and not func_6(target_58, func)
and not func_7(target_59, func)
and not func_10(func)
and not func_18(vclose_4504, target_61)
and not func_19(func)
and not func_20(target_59, func)
and not func_21(vclose_4504, target_58, func)
and not func_22(target_58, func)
and not func_24(target_58, func)
and not func_25(vforce_nonblock_4501, target_58, func)
and not func_28(vclose_4504, vret_4505, target_58, target_59, target_63, target_64, func)
and not func_31(target_58, func)
and not func_32(vret_4505, target_58, target_64, func)
and not func_33(vret_4505, target_58, target_65, func)
and not func_36(target_66, func)
and func_38(vclose_4504, target_38)
and func_39(vret_4505, target_48, target_39)
and func_40(vret_4505, target_40)
and func_41(func, target_41)
and func_42(target_59, func, target_42)
and func_43(vclose_4504, target_43)
and func_44(vclose_4504, target_44)
and func_45(vforce_nonblock_4501, vclose_4504, target_61, target_45)
and func_46(vclose_4504, target_46)
and func_47(vclose_4504, target_59, target_47)
and func_48(vret_4505, target_39, target_48)
and func_49(vclose_4504, target_68, target_57, target_49)
and func_50(vreq_4501, target_50)
and func_51(vreq_4501, target_51)
and func_52(vreq_4501, target_52)
and func_54(vreq_4501, vclose_4504, target_54)
and func_55(vclose_4504, target_57, target_66, target_55)
and func_56(vclose_4504, target_58, target_56)
and func_57(vclose_4504, vret_4505, target_57)
and func_58(vclose_4504, target_58)
and func_59(vforce_nonblock_4501, vclose_4504, target_59)
and func_60(vclose_4504, target_60)
and func_61(func, target_61)
and func_63(vret_4505, target_63)
and func_64(vret_4505, target_64)
and func_65(vreq_4501, vret_4505, target_65)
and func_66(vclose_4504, target_66)
and func_68(vclose_4504, target_68)
and vreq_4501.getType().hasName("io_kiocb *")
and vforce_nonblock_4501.getType().hasName("bool")
and vclose_4504.getType().hasName("io_close *")
and vret_4505.getType().hasName("int")
and vreq_4501.getFunction() = func
and vforce_nonblock_4501.getFunction() = func
and vclose_4504.(LocalVariable).getFunction() = func
and vret_4505.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
