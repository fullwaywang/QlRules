/**
 * @name v8-d125c7329f6e22af4523de3c55de3a22f168acc9-v8__internal__Object__SetSuperProperty
 * @id cpp/v8/d125c7329f6e22af4523de3c55de3a22f168acc9/v8internalobjectsetsuperproperty
 * @description v8-d125c7329f6e22af4523de3c55de3a22f168acc9-src/objects/objects.cc-v8__internal__Object__SetSuperProperty CVE-2023-2935
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable visolate_2673, Variable vreceiver_2690, Variable vc_2694, Parameter vit_2670) {
exists(FunctionCall target_0 |
	target_0.getTarget().hasName("GetKey")
	and target_0.getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_0.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=visolate_2673
	and target_0.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
	and target_0.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(2) instanceof FunctionCall
	and target_0.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(3).(VariableAccess).getTarget()=vc_2694)
}

predicate func_1(Variable vown_lookup_2695, NotExpr target_9, AddressOfExpr target_10, AddressOfExpr target_11) {
exists(ExprStmt target_1 |
	target_1.getExpr().(FunctionCall).getTarget().hasName("Restart")
	and target_1.getExpr().(FunctionCall).getQualifier().(VariableAccess).getTarget()=vown_lookup_2695
	and target_1.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(0)=target_1
	and target_1.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_9
	and target_10.getOperand().(VariableAccess).getLocation().isBefore(target_1.getExpr().(FunctionCall).getQualifier().(VariableAccess).getLocation())
	and target_1.getExpr().(FunctionCall).getQualifier().(VariableAccess).getLocation().isBefore(target_11.getOperand().(VariableAccess).getLocation()))
}

predicate func_2(Parameter vit_2670, VariableAccess target_2) {
	target_2.getTarget()=vit_2670
}

predicate func_5(Function func, DeclStmt target_5) {
	func.getEntryPoint().(BlockStmt).getAStmt()=target_5
}

predicate func_6(Variable visolate_2673, Variable vreceiver_2690, Variable vc_2694, Parameter vit_2670, ConditionalExpr target_6) {
	target_6.getCondition().(FunctionCall).getTarget().hasName("IsElement")
	and target_6.getCondition().(FunctionCall).getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_6.getThen().(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=visolate_2673
	and target_6.getThen().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
	and target_6.getThen().(ConstructorCall).getArgument(2).(FunctionCall).getTarget().hasName("index")
	and target_6.getThen().(ConstructorCall).getArgument(2).(FunctionCall).getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_6.getThen().(ConstructorCall).getArgument(3).(VariableAccess).getTarget()=vc_2694
	and target_6.getElse().(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=visolate_2673
	and target_6.getElse().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
	and target_6.getElse().(ConstructorCall).getArgument(2).(FunctionCall).getTarget().hasName("name")
	and target_6.getElse().(ConstructorCall).getArgument(2).(FunctionCall).getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_6.getElse().(ConstructorCall).getArgument(3).(VariableAccess).getTarget()=vc_2694
}

/*predicate func_7(Variable visolate_2673, Variable vreceiver_2690, Variable vc_2694, Parameter vit_2670, FunctionCall target_7) {
	target_7.getTarget().hasName("index")
	and target_7.getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_7.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=visolate_2673
	and target_7.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
	and target_7.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(3).(VariableAccess).getTarget()=vc_2694
}

*/
/*predicate func_8(Variable visolate_2673, Variable vreceiver_2690, Variable vc_2694, Parameter vit_2670, ConditionalExpr target_6, ConstructorCall target_14, FunctionCall target_16, VariableAccess target_8) {
	target_8.getTarget()=vc_2694
	and target_8.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=visolate_2673
	and target_8.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
	and target_8.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(2).(FunctionCall).getTarget().hasName("index")
	and target_8.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(2).(FunctionCall).getQualifier().(VariableAccess).getTarget()=vit_2670
	and target_8.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_6.getThen().(ConstructorCall).getArgument(0).(VariableAccess).getLocation())
	and target_8.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(1).(ConstructorCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_14.getArgument(0).(VariableAccess).getLocation())
	and target_8.getParent().(ConstructorCall).getParent().(ConditionalExpr).getThen().(ConstructorCall).getArgument(2).(FunctionCall).getQualifier().(VariableAccess).getLocation().isBefore(target_16.getQualifier().(VariableAccess).getLocation())
}

*/
predicate func_9(Function func, NotExpr target_9) {
	target_9.getOperand().(FunctionCall).getTarget().hasName("FromJust")
	and target_9.getOperand().(FunctionCall).getQualifier().(VariableAccess).getTarget().getType().hasName("Maybe<bool>")
	and target_9.getEnclosingFunction() = func
}

predicate func_10(Variable vown_lookup_2695, AddressOfExpr target_10) {
	target_10.getOperand().(VariableAccess).getTarget()=vown_lookup_2695
	and target_10.getParent().(FunctionCall).getParent().(Initializer).getExpr().(FunctionCall).getTarget().hasName("GetOwnPropertyDescriptor")
	and target_10.getParent().(FunctionCall).getParent().(Initializer).getExpr().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(VariableAccess).getTarget().getType().hasName("PropertyDescriptor")
}

predicate func_11(Variable vown_lookup_2695, AddressOfExpr target_11) {
	target_11.getOperand().(VariableAccess).getTarget()=vown_lookup_2695
	and target_11.getParent().(FunctionCall).getParent().(NotExpr).getOperand().(FunctionCall).getTarget().hasName("CheckContextualStoreToJSGlobalObject")
	and target_11.getParent().(FunctionCall).getParent().(NotExpr).getOperand().(FunctionCall).getArgument(1).(VariableAccess).getTarget().getType().hasName("Maybe<ShouldThrow>")
}

predicate func_14(Variable vreceiver_2690, ConstructorCall target_14) {
	target_14.getArgument(0).(VariableAccess).getTarget()=vreceiver_2690
}

predicate func_16(Parameter vit_2670, FunctionCall target_16) {
	target_16.getTarget().hasName("name")
	and target_16.getQualifier().(VariableAccess).getTarget()=vit_2670
}

from Function func, Variable visolate_2673, Variable vreceiver_2690, Variable vc_2694, Variable vown_lookup_2695, Parameter vit_2670, VariableAccess target_2, DeclStmt target_5, ConditionalExpr target_6, NotExpr target_9, AddressOfExpr target_10, AddressOfExpr target_11, ConstructorCall target_14, FunctionCall target_16
where
not func_0(visolate_2673, vreceiver_2690, vc_2694, vit_2670)
and not func_1(vown_lookup_2695, target_9, target_10, target_11)
and func_2(vit_2670, target_2)
and func_5(func, target_5)
and func_6(visolate_2673, vreceiver_2690, vc_2694, vit_2670, target_6)
and func_9(func, target_9)
and func_10(vown_lookup_2695, target_10)
and func_11(vown_lookup_2695, target_11)
and func_14(vreceiver_2690, target_14)
and func_16(vit_2670, target_16)
and visolate_2673.getType().hasName("Isolate *")
and vreceiver_2690.getType().hasName("Handle<JSReceiver>")
and vc_2694.getType().hasName("Configuration")
and vown_lookup_2695.getType().hasName("LookupIterator")
and vit_2670.getType().hasName("LookupIterator *")
and visolate_2673.(LocalVariable).getFunction() = func
and vreceiver_2690.(LocalVariable).getFunction() = func
and vc_2694.(LocalVariable).getFunction() = func
and vown_lookup_2695.(LocalVariable).getFunction() = func
and vit_2670.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
