/**
 * @name chromium-3b3c412dc32f81872e86337c998574e88036fd1b-content__RenderWidgetHostImpl__StoredVisualPropertiesNeedsUpdate
 * @id cpp/chromium/3b3c412dc32f81872e86337c998574e88036fd1b/contentrenderwidgethostimplstoredvisualpropertiesneedsupdate
 * @description chromium-3b3c412dc32f81872e86337c998574e88036fd1b-content/browser/renderer_host/render_widget_host_impl.cc-content__RenderWidgetHostImpl__StoredVisualPropertiesNeedsUpdate CVE-2023-5486
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vold_visual_properties_2731, Parameter vnew_visual_properties_2732, EqualityOperation target_2, PointerFieldAccess target_3, ReferenceFieldAccess target_4) {
exists(LogicalOrExpr target_0 |
	exists(EqualityOperation obj_0 | obj_0=target_0.getRightOperand() |
		exists(PointerFieldAccess obj_1 | obj_1=obj_0.getLeftOperand() |
			obj_1.getTarget().getName()="cursor_accessibility_scale_factor"
			and obj_1.getQualifier().(FunctionCall).getQualifier().(VariableAccess).getTarget()=vold_visual_properties_2731
		)
		and exists(ReferenceFieldAccess obj_2 | obj_2=obj_0.getRightOperand() |
			obj_2.getTarget().getName()="cursor_accessibility_scale_factor"
			and obj_2.getQualifier().(VariableAccess).getTarget()=vnew_visual_properties_2732
		)
	)
	and exists(EqualityOperation obj_3 | obj_3=target_0.getRightOperand() |
		obj_3.getLeftOperand().(PointerFieldAccess).getQualifier().(FunctionCall).getQualifier().(VariableAccess).getLocation().isBefore(target_3.getQualifier().(FunctionCall).getQualifier().(VariableAccess).getLocation())
		and obj_3.getRightOperand().(ReferenceFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_4.getQualifier().(VariableAccess).getLocation())
	)
	and target_0.getLeftOperand() instanceof LogicalOrExpr
	and target_2.getLeftOperand().(PointerFieldAccess).getQualifier().(FunctionCall).getQualifier().(VariableAccess).getLocation().isBefore(target_0.getRightOperand().(EqualityOperation).getLeftOperand().(PointerFieldAccess).getQualifier().(FunctionCall).getQualifier().(VariableAccess).getLocation())
)
}

predicate func_1(Parameter vold_visual_properties_2731, Parameter vnew_visual_properties_2732, LogicalOrExpr target_1) {
	exists(LogicalOrExpr obj_0 | obj_0=target_1.getLeftOperand() |
		exists(LogicalOrExpr obj_1 | obj_1=obj_0.getLeftOperand() |
			exists(LogicalOrExpr obj_2 | obj_2=obj_1.getLeftOperand() |
				exists(LogicalOrExpr obj_3 | obj_3=obj_2.getLeftOperand() |
					exists(FunctionCall obj_4 | obj_4=obj_3.getRightOperand() |
						obj_4.getTarget().hasName("operator!=")
						and obj_4.getQualifier().(PointerFieldAccess).getTarget().getName()="browser_controls_params"
						and obj_4.getArgument(0).(ReferenceFieldAccess).getTarget().getName()="browser_controls_params"
					)
				)
				and exists(FunctionCall obj_5 | obj_5=obj_2.getRightOperand() |
					exists(ReferenceFieldAccess obj_6 | obj_6=obj_5.getArgument(1) |
						obj_6.getTarget().getName()="visible_viewport_size"
						and obj_6.getQualifier().(VariableAccess).getTarget()=vnew_visual_properties_2732
					)
					and obj_5.getTarget().hasName("operator!=")
					and obj_5.getArgument(0).(PointerFieldAccess).getTarget().getName()="visible_viewport_size"
				)
			)
			and exists(EqualityOperation obj_7 | obj_7=obj_1.getRightOperand() |
				exists(PointerFieldAccess obj_8 | obj_8=obj_7.getLeftOperand() |
					obj_8.getTarget().getName()="capture_sequence_number"
					and obj_8.getQualifier().(FunctionCall).getQualifier().(VariableAccess).getTarget()=vold_visual_properties_2731
				)
				and exists(ReferenceFieldAccess obj_9 | obj_9=obj_7.getRightOperand() |
					obj_9.getTarget().getName()="capture_sequence_number"
					and obj_9.getQualifier().(VariableAccess).getTarget()=vnew_visual_properties_2732
				)
			)
		)
		and exists(EqualityOperation obj_10 | obj_10=obj_0.getRightOperand() |
			exists(PointerFieldAccess obj_11 | obj_11=obj_10.getLeftOperand() |
				obj_11.getTarget().getName()="page_scale_factor"
				and obj_11.getQualifier().(FunctionCall).getQualifier().(VariableAccess).getTarget()=vold_visual_properties_2731
			)
			and exists(ReferenceFieldAccess obj_12 | obj_12=obj_10.getRightOperand() |
				obj_12.getTarget().getName()="page_scale_factor"
				and obj_12.getQualifier().(VariableAccess).getTarget()=vnew_visual_properties_2732
			)
		)
	)
	and exists(EqualityOperation obj_13 | obj_13=target_1.getRightOperand() |
		exists(PointerFieldAccess obj_14 | obj_14=obj_13.getLeftOperand() |
			obj_14.getTarget().getName()="compositing_scale_factor"
			and obj_14.getQualifier().(FunctionCall).getQualifier().(VariableAccess).getTarget()=vold_visual_properties_2731
		)
		and exists(ReferenceFieldAccess obj_15 | obj_15=obj_13.getRightOperand() |
			obj_15.getTarget().getName()="compositing_scale_factor"
			and obj_15.getQualifier().(VariableAccess).getTarget()=vnew_visual_properties_2732
		)
	)
}

predicate func_2(Parameter vold_visual_properties_2731, Parameter vnew_visual_properties_2732, EqualityOperation target_2) {
	exists(PointerFieldAccess obj_0 | obj_0=target_2.getLeftOperand() |
		obj_0.getTarget().getName()="zoom_level"
		and obj_0.getQualifier().(FunctionCall).getQualifier().(VariableAccess).getTarget()=vold_visual_properties_2731
	)
	and exists(ReferenceFieldAccess obj_1 | obj_1=target_2.getRightOperand() |
		obj_1.getTarget().getName()="zoom_level"
		and obj_1.getQualifier().(VariableAccess).getTarget()=vnew_visual_properties_2732
	)
}

predicate func_3(Parameter vold_visual_properties_2731, PointerFieldAccess target_3) {
	target_3.getTarget().getName()="screen_infos"
	and target_3.getQualifier().(FunctionCall).getQualifier().(VariableAccess).getTarget()=vold_visual_properties_2731
}

predicate func_4(Parameter vnew_visual_properties_2732, ReferenceFieldAccess target_4) {
	target_4.getTarget().getName()="screen_infos"
	and target_4.getQualifier().(VariableAccess).getTarget()=vnew_visual_properties_2732
}

from Function func, Parameter vold_visual_properties_2731, Parameter vnew_visual_properties_2732, LogicalOrExpr target_1, EqualityOperation target_2, PointerFieldAccess target_3, ReferenceFieldAccess target_4
where
not func_0(vold_visual_properties_2731, vnew_visual_properties_2732, target_2, target_3, target_4)
and func_1(vold_visual_properties_2731, vnew_visual_properties_2732, target_1)
and func_2(vold_visual_properties_2731, vnew_visual_properties_2732, target_2)
and func_3(vold_visual_properties_2731, target_3)
and func_4(vnew_visual_properties_2732, target_4)
and vold_visual_properties_2731.getType().hasName("const unique_ptr<VisualProperties, default_delete<VisualProperties>> &")
and vnew_visual_properties_2732.getType().hasName("const VisualProperties &")
and vold_visual_properties_2731.getFunction() = func
and vnew_visual_properties_2732.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
