commit 444b0a82fb9f59dd2c3c05dfbccc56fc16c124d2	444b0a82fb9f59dd2c3c05dfbccc56fc16c124d2
Author: Haxatron Sec <haxatron1@gmail.com>
Date:   Fri Aug 11 21:03:01 2023 +0000

    Disallow document pip for non-https / file resources. (browser-side)
    
    browser-side followup of https://chromium-review.googlesource.com/c/chromium/src/+/4595397
    
    Fixed: 1451543, 1460025
    Change-Id: Id726c087b3d9994ed5a152b8e40f2094338840de
    Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/4746980
    Commit-Queue: Ken Buchanan <kenrb@chromium.org>
    Reviewed-by: Tommy Steimel <steimel@chromium.org>
    Reviewed-by: Ken Buchanan <kenrb@chromium.org>
    Cr-Commit-Position: refs/heads/main@{#1182779}

diff --git a/content/browser/renderer_host/render_frame_host_impl.cc b/content/browser/renderer_host/render_frame_host_impl.cc
index ddad88664dbe3..f68ee39d0c9d2 100644
--- a/content/browser/renderer_host/render_frame_host_impl.cc
+++ b/content/browser/renderer_host/render_frame_host_impl.cc
@@ -8032,11 +8032,15 @@ void RenderFrameHostImpl::CreateNewWindow(
   TRACE_EVENT2("navigation", "RenderFrameHostImpl::CreateNewWindow",
                "render_frame_host", this, "url", params->target_url);
 
-  // Only top-most frames can open picture-in-picture windows.
+  // Only top-most frames from https:// or file:// URLs
+  // can open picture-in-picture windows.
   if (params->disposition == WindowOpenDisposition::NEW_PICTURE_IN_PICTURE &&
-      GetParentOrOuterDocumentOrEmbedder()) {
+      ((!GetLastCommittedURL().SchemeIs(url::kHttpsScheme) &&
+        !GetLastCommittedURL().SchemeIsFile()) ||
+       GetParentOrOuterDocumentOrEmbedder())) {
     frame_host_associated_receiver_.ReportBadMessage(
-        "Only top-most frames can open picture-in-picture windows.");
+        "Only top-most frames from https:// or file:// URLs "
+        "can open picture-in-picture windows.");
     return;
   }
 
