commit f91ca83a21a6a583050e5a5755ce1441b2bf1d7e	f91ca83a21a6a583050e5a5755ce1441b2bf1d7e
Author: Even Rouault <even.rouault@spatialys.com>
Date:   Wed Aug 23 13:21:41 2017 +0000

    * libtiff/tif_dirwrite.c: replace assertion related to not finding the
    SubIFD tag by runtime check.
    Fixes http://bugzilla.maptools.org/show_bug.cgi?id=2727
    Reported by team OWL337

diff --git a/ChangeLog b/ChangeLog
index 3da2b704..87554768 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,10 @@
+2017-08-23  Even Rouault <even.rouault at spatialys.com>
+
+	* libtiff/tif_dirwrite.c: replace assertion related to not finding the
+	SubIFD tag by runtime check.
+	Fixes http://bugzilla.maptools.org/show_bug.cgi?id=2727
+	Reported by team OWL337
+
 2017-07-24  Even Rouault <even.rouault at spatialys.com>
 
 	* libtiff/tif_luv.c: further reduce memory requirements for temporary
diff --git a/libtiff/tif_dirwrite.c b/libtiff/tif_dirwrite.c
index 38edb3fb..a85f0627 100644
--- a/libtiff/tif_dirwrite.c
+++ b/libtiff/tif_dirwrite.c
@@ -821,7 +821,12 @@ TIFFWriteDirectorySec(TIFF* tif, int isimage, int imagedone, uint64* pdiroff)
 			TIFFDirEntry* nb;
 			for (na=0, nb=dir; ; na++, nb++)
 			{
-				assert(na<ndir);
+				if( na == ndir )
+                                {
+                                    TIFFErrorExt(tif->tif_clientdata,module,
+                                                 "Cannot find SubIFD tag");
+                                    goto bad;
+                                }
 				if (nb->tdir_tag==TIFFTAG_SUBIFD)
 					break;
 			}
