/**
 * @name linux-53cefa802f070d46c0c518f4865be2c749818a18-ixgbe_x550em_a_has_mii
 * @id cpp/linux/53cefa802f070d46c0c518f4865be2c749818a18/ixgbe-x550em-a-has-mii
 * @description linux-53cefa802f070d46c0c518f4865be2c749818a18-drivers/net/ethernet/intel/ixgbe/ixgbe_phy.c-ixgbe_x550em_a_has_mii CVE-2022-48896
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(EqualityOperation target_11, Function func) {
exists(ExprStmt target_0 |
	exists(AssignExpr obj_0 | obj_0=target_0.getExpr() |
		obj_0.getLValue().(VariableAccess).getType().hasName("bool")
		and obj_0.getRValue() instanceof EnumConstantAccess
	)
	and target_0.getParent().(IfStmt).getCondition()=target_11
	and target_0.getEnclosingFunction() = func
)
}

predicate func_1(VariableAccess target_12, Function func) {
exists(GotoStmt target_1 |
	exists(BlockStmt obj_0 | obj_0=target_1.getParent() |
		exists(IfStmt obj_1 | obj_1=obj_0.getParent() |
			obj_1.getThen().(BlockStmt).getStmt(1)=target_1
			and obj_1.getCondition()=target_12
		)
	)
	and target_1.getName() ="out"
	and target_1.getEnclosingFunction() = func
)
}

predicate func_2(EqualityOperation target_13, Function func) {
exists(ExprStmt target_2 |
	exists(AssignExpr obj_0 | obj_0=target_2.getExpr() |
		obj_0.getLValue().(VariableAccess).getType().hasName("bool")
		and obj_0.getRValue() instanceof EnumConstantAccess
	)
	and target_2.getParent().(IfStmt).getCondition()=target_13
	and target_2.getEnclosingFunction() = func
)
}

predicate func_3(Variable vfunc0_pdev_872, EqualityOperation target_13, Function func) {
exists(ExprStmt target_3 |
	exists(FunctionCall obj_0 | obj_0=target_3.getExpr() |
		obj_0.getTarget().hasName("pci_dev_put")
		and obj_0.getArgument(0).(VariableAccess).getTarget()=vfunc0_pdev_872
	)
	and func.getEntryPoint().(BlockStmt).getAStmt()=target_3
	and target_3.getFollowingStmt() instanceof ReturnStmt
	and target_13.getLeftOperand().(VariableAccess).getLocation().isBefore(target_3.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
)
}

predicate func_8(EqualityOperation target_11, Function func, ReturnStmt target_8) {
	target_8.getExpr() instanceof EnumConstantAccess
	and target_8.getParent().(IfStmt).getCondition()=target_11
	and target_8.getEnclosingFunction() = func
}

predicate func_9(EqualityOperation target_13, Function func, ReturnStmt target_9) {
	target_9.getExpr() instanceof EnumConstantAccess
	and target_9.getParent().(IfStmt).getCondition()=target_13
	and target_9.getEnclosingFunction() = func
}

predicate func_10(Function func, ReturnStmt target_10) {
	func.getEntryPoint().(BlockStmt).getAStmt()=target_10
}

predicate func_11(Variable vfunc0_pdev_872, ReturnStmt target_14, EqualityOperation target_11) {
	target_11.getLeftOperand().(VariableAccess).getTarget()=vfunc0_pdev_872
	and target_11.getRightOperand().(VariableAccess).getTarget().getType().hasName("pci_dev *")
	and target_11.getParent().(IfStmt).getThen()=target_14
}

predicate func_12(Variable vfunc0_pdev_872, BlockStmt target_15, VariableAccess target_12) {
	target_12.getTarget()=vfunc0_pdev_872
	and target_12.getParent().(IfStmt).getThen()=target_15
}

predicate func_13(Variable vfunc0_pdev_872, ReturnStmt target_9, EqualityOperation target_13) {
	target_13.getLeftOperand().(VariableAccess).getTarget()=vfunc0_pdev_872
	and target_13.getRightOperand().(VariableAccess).getTarget().getType().hasName("pci_dev *")
	and target_13.getParent().(IfStmt).getThen()=target_9
}

predicate func_14(Function func, ReturnStmt target_14) {
	target_14.getExpr() instanceof EnumConstantAccess
	and target_14.getEnclosingFunction() = func
}

predicate func_15(Variable vfunc0_pdev_872, BlockStmt target_15) {
	exists(IfStmt obj_0 | obj_0=target_15.getStmt(0) |
		exists(EqualityOperation obj_1 | obj_1=obj_0.getCondition() |
			obj_1.getLeftOperand().(VariableAccess).getTarget()=vfunc0_pdev_872
			and obj_1.getRightOperand().(VariableAccess).getTarget().getType().hasName("pci_dev *")
		)
		and obj_0.getThen().(ReturnStmt).getExpr() instanceof EnumConstantAccess
		and obj_0.getElse() instanceof ReturnStmt
	)
}

from Function func, Variable vfunc0_pdev_872, ReturnStmt target_8, ReturnStmt target_9, ReturnStmt target_10, EqualityOperation target_11, VariableAccess target_12, EqualityOperation target_13, ReturnStmt target_14, BlockStmt target_15
where
not func_0(target_11, func)
and not func_1(target_12, func)
and not func_2(target_13, func)
and not func_3(vfunc0_pdev_872, target_13, func)
and func_8(target_11, func, target_8)
and func_9(target_13, func, target_9)
and func_10(func, target_10)
and func_11(vfunc0_pdev_872, target_14, target_11)
and func_12(vfunc0_pdev_872, target_15, target_12)
and func_13(vfunc0_pdev_872, target_9, target_13)
and func_14(func, target_14)
and func_15(vfunc0_pdev_872, target_15)
and vfunc0_pdev_872.getType().hasName("pci_dev *")
and vfunc0_pdev_872.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
