/**
 * @name linux-50145474f6ef4a9c19205b173da6264a644c7489-fbcon_invert_region
 * @id cpp/linux/50145474f6ef4a9c19205b173da6264a644c7489/fbcon-invert-region
 * @description linux-50145474f6ef4a9c19205b173da6264a644c7489-fbcon_invert_region CVE-2020-14390
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vp_2847, Variable vsoftback_end, Variable vsoftback_buf, IfStmt target_0) {
		target_0.getCondition().(EqualityOperation).getAnOperand().(VariableAccess).getTarget()=vp_2847
		and target_0.getCondition().(EqualityOperation).getAnOperand().(VariableAccess).getTarget()=vsoftback_end
		and target_0.getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vp_2847
		and target_0.getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(VariableAccess).getTarget()=vsoftback_buf
}

predicate func_1(Parameter vvc_2847, Parameter vp_2847, Variable vsoftback_in, IfStmt target_1) {
		target_1.getCondition().(EqualityOperation).getAnOperand().(VariableAccess).getTarget()=vp_2847
		and target_1.getCondition().(EqualityOperation).getAnOperand().(VariableAccess).getTarget()=vsoftback_in
		and target_1.getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vp_2847
		and target_1.getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getTarget().getName()="vc_origin"
		and target_1.getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vvc_2847
}

from Function func, Parameter vvc_2847, Parameter vp_2847, Variable vsoftback_end, Variable vsoftback_buf, Variable vsoftback_in, IfStmt target_0, IfStmt target_1
where
func_0(vp_2847, vsoftback_end, vsoftback_buf, target_0)
and func_1(vvc_2847, vp_2847, vsoftback_in, target_1)
and vvc_2847.getType().hasName("vc_data *")
and vp_2847.getType().hasName("u16 *")
and vsoftback_end.getType().hasName("unsigned long")
and vsoftback_buf.getType().hasName("unsigned long")
and vsoftback_in.getType().hasName("unsigned long")
and vvc_2847.getFunction() = func
and vp_2847.getFunction() = func
and not vsoftback_end.getParentScope+() = func
and not vsoftback_buf.getParentScope+() = func
and not vsoftback_in.getParentScope+() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
