/**
 * @name linux-eca94432934fe5f141d084f2e36ee2c0e614cc04-l2cap_check_enc_key_size
 * @id cpp/linux/eca94432934fe5f141d084f2e36ee2c0e614cc04/l2cap-check-enc-key-size
 * @description linux-eca94432934fe5f141d084f2e36ee2c0e614cc04-net/bluetooth/l2cap_core.c-l2cap_check_enc_key_size CVE-2019-9506
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vhcon_1344) {
exists(RelationalOperation target_0 |
	 (target_0 instanceof GEExpr or target_0 instanceof LEExpr)
	and target_0.getGreaterOperand().(PointerFieldAccess).getTarget().getName()="enc_key_size"
	and target_0.getGreaterOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vhcon_1344
	and target_0.getLesserOperand() instanceof Literal)
}

predicate func_1(Parameter vhcon_1344, PointerFieldAccess target_1) {
	target_1.getTarget().getName()="enc_key_size"
	and target_1.getQualifier().(VariableAccess).getTarget()=vhcon_1344
}

predicate func_3(Parameter vhcon_1344, RelationalOperation target_3) {
	 (target_3 instanceof GTExpr or target_3 instanceof LTExpr)
	and target_3.getGreaterOperand().(PointerFieldAccess).getTarget().getName()="enc_key_size"
	and target_3.getGreaterOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vhcon_1344
	and target_3.getLesserOperand() instanceof Literal
}

from Function func, Parameter vhcon_1344, PointerFieldAccess target_1, RelationalOperation target_3
where
not func_0(vhcon_1344)
and func_1(vhcon_1344, target_1)
and func_3(vhcon_1344, target_3)
and vhcon_1344.getType().hasName("hci_conn *")
and vhcon_1344.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
