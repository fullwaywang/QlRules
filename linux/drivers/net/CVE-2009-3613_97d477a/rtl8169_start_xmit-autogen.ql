/**
 * @name linux-97d477a914b146e7e6722ded21afa79886ae8ccd-rtl8169_start_xmit
 * @id cpp/linux/97d477a914b146e7e6722ded21afa79886ae8ccd/rtl8169-start-xmit
 * @description linux-97d477a914b146e7e6722ded21afa79886ae8ccd-drivers/net/r8169.c-rtl8169_start_xmit CVE-2009-3613
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_2(Variable v______r_2_3367, Variable v______f_2_3367, IfStmt target_2) {
		target_2.getCondition().(VariableAccess).getTarget()=v______r_2_3367
		and target_2.getThen().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getTarget().getName()="hit"
		and target_2.getThen().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="(unknown field)"
		and target_2.getThen().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="(unknown field)"
		and target_2.getThen().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(VariableAccess).getTarget()=v______f_2_3367
		and target_2.getElse().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getTarget().getName()="miss"
		and target_2.getElse().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="(unknown field)"
		and target_2.getElse().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="(unknown field)"
		and target_2.getElse().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(VariableAccess).getTarget()=v______f_2_3367
}

predicate func_3(Variable v______r_2_3367, ExprStmt target_3) {
		target_3.getExpr().(VariableAccess).getTarget()=v______r_2_3367
}

predicate func_4(Variable v______r_3368, Variable v______f_3368, IfStmt target_4) {
		target_4.getCondition().(VariableAccess).getTarget()=v______r_3368
		and target_4.getThen().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getTarget().getName()="hit"
		and target_4.getThen().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="(unknown field)"
		and target_4.getThen().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="(unknown field)"
		and target_4.getThen().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(VariableAccess).getTarget()=v______f_3368
		and target_4.getElse().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getTarget().getName()="miss"
		and target_4.getElse().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="(unknown field)"
		and target_4.getElse().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="(unknown field)"
		and target_4.getElse().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(VariableAccess).getTarget()=v______f_3368
}

predicate func_5(Variable v______r_3368, ExprStmt target_5) {
		target_5.getExpr().(VariableAccess).getTarget()=v______r_3368
}

predicate func_6(ConditionalExpr target_28, Function func, GotoStmt target_6) {
		target_6.getParent().(IfStmt).getCondition()=target_28
		and target_6.getEnclosingFunction() = func
}

predicate func_7(Parameter vskb_3335, Variable vlen_3342, Variable v______r_2_3367, ConditionalExpr target_29, IfStmt target_7) {
		target_7.getCondition().(ConditionalExpr).getCondition().(FunctionCall).getTarget().hasName("__builtin_constant_p")
		and target_7.getCondition().(ConditionalExpr).getCondition().(FunctionCall).getArgument(0).(ConditionalExpr).getCondition().(FunctionCall).getTarget().hasName("__builtin_constant_p")
		and target_7.getCondition().(ConditionalExpr).getCondition().(FunctionCall).getArgument(0).(ConditionalExpr).getCondition().(FunctionCall).getArgument(0).(RelationalOperation).getLesserOperand().(VariableAccess).getTarget()=vlen_3342
		and target_7.getCondition().(ConditionalExpr).getCondition().(FunctionCall).getArgument(0).(ConditionalExpr).getCondition().(FunctionCall).getArgument(0).(RelationalOperation).getGreaterOperand() instanceof Literal
		and target_7.getCondition().(ConditionalExpr).getThen().(NotExpr).getOperand().(NotExpr).getOperand().(ConditionalExpr).getCondition().(FunctionCall).getTarget().hasName("__builtin_constant_p")
		and target_7.getCondition().(ConditionalExpr).getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(2).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=v______r_2_3367
		and target_7.getCondition().(ConditionalExpr).getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(3) instanceof IfStmt
		and target_7.getCondition().(ConditionalExpr).getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(4) instanceof ExprStmt
		and target_7.getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(ConditionalExpr).getCondition().(FunctionCall).getTarget().hasName("__builtin_constant_p")
		and target_7.getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(ConditionalExpr).getCondition().(FunctionCall).getArgument(0).(FunctionCall).getTarget().hasName("skb_padto")
		and target_7.getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(ConditionalExpr).getCondition().(FunctionCall).getArgument(0).(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vskb_3335
		and target_7.getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(ConditionalExpr).getCondition().(FunctionCall).getArgument(0).(FunctionCall).getArgument(1) instanceof Literal
		and target_7.getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(ConditionalExpr).getThen().(NotExpr).getOperand().(NotExpr).getOperand().(FunctionCall).getTarget().hasName("skb_padto")
		and target_7.getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(ConditionalExpr).getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(3) instanceof IfStmt
		and target_7.getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition().(ConditionalExpr).getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(4) instanceof ExprStmt
		and target_7.getThen().(BlockStmt).getStmt(0).(IfStmt).getThen() instanceof GotoStmt
		and target_7.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vlen_3342
		and target_7.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getRValue().(Literal).getValue()="60"
		and target_7.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_29
}

/*predicate func_8(Variable vlen_3342, Variable v______r_3367, ExprStmt target_8) {
		target_8.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=v______r_3367
		and target_8.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("__builtin_expect")
		and target_8.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(NotExpr).getOperand().(NotExpr).getOperand().(RelationalOperation).getLesserOperand().(VariableAccess).getTarget()=vlen_3342
		and target_8.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(NotExpr).getOperand().(NotExpr).getOperand().(RelationalOperation).getGreaterOperand() instanceof Literal
		and target_8.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1) instanceof Literal
}

*/
/*predicate func_9(Variable v______r_3367, Variable v______f_3367, ExprStmt target_9) {
		target_9.getExpr().(FunctionCall).getTarget().hasName("ftrace_likely_update")
		and target_9.getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(VariableAccess).getTarget()=v______f_3367
		and target_9.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=v______r_3367
		and target_9.getExpr().(FunctionCall).getArgument(2) instanceof Literal
}

*/
/*predicate func_10(Variable v______r_3367, ExprStmt target_10) {
		target_10.getExpr().(VariableAccess).getTarget()=v______r_3367
}

*/
/*predicate func_11(Variable vlen_3342, Variable v______r_1_3367, ExprStmt target_11) {
		target_11.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=v______r_1_3367
		and target_11.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("__builtin_expect")
		and target_11.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(NotExpr).getOperand().(NotExpr).getOperand().(RelationalOperation).getLesserOperand().(VariableAccess).getTarget()=vlen_3342
		and target_11.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(NotExpr).getOperand().(NotExpr).getOperand().(RelationalOperation).getGreaterOperand() instanceof Literal
		and target_11.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1) instanceof Literal
}

*/
/*predicate func_12(Variable v______r_1_3367, Variable v______f_1_3367, ExprStmt target_12) {
		target_12.getExpr().(FunctionCall).getTarget().hasName("ftrace_likely_update")
		and target_12.getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(VariableAccess).getTarget()=v______f_1_3367
		and target_12.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=v______r_1_3367
		and target_12.getExpr().(FunctionCall).getArgument(2) instanceof Literal
}

*/
/*predicate func_13(Variable v______r_1_3367, ExprStmt target_13) {
		target_13.getExpr().(VariableAccess).getTarget()=v______r_1_3367
}

*/
/*predicate func_16(Variable v______r_2_3367, ExprStmt target_16) {
		target_16.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=v______r_2_3367
		and target_16.getExpr().(AssignExpr).getRValue().(NotExpr).getOperand().(NotExpr).getOperand().(ConditionalExpr).getCondition().(FunctionCall).getTarget().hasName("__builtin_constant_p")
}

*/
/*predicate func_19(Variable vlen_3342, Variable v______r_3_3367, ExprStmt target_19) {
		target_19.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=v______r_3_3367
		and target_19.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("__builtin_expect")
		and target_19.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(NotExpr).getOperand().(NotExpr).getOperand().(RelationalOperation).getLesserOperand().(VariableAccess).getTarget()=vlen_3342
		and target_19.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(NotExpr).getOperand().(NotExpr).getOperand().(RelationalOperation).getGreaterOperand() instanceof Literal
		and target_19.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1) instanceof Literal
}

*/
/*predicate func_20(Variable v______r_3_3367, Variable v______f_3_3367, ExprStmt target_20) {
		target_20.getExpr().(FunctionCall).getTarget().hasName("ftrace_likely_update")
		and target_20.getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(VariableAccess).getTarget()=v______f_3_3367
		and target_20.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=v______r_3_3367
		and target_20.getExpr().(FunctionCall).getArgument(2) instanceof Literal
}

*/
/*predicate func_21(Variable v______r_3_3367, ExprStmt target_21) {
		target_21.getExpr().(VariableAccess).getTarget()=v______r_3_3367
}

*/
/*predicate func_22(Parameter vskb_3335, Variable v______r_3368, ConditionalExpr target_30, IfStmt target_22) {
		target_22.getCondition().(ConditionalExpr).getCondition().(FunctionCall).getTarget().hasName("__builtin_constant_p")
		and target_22.getCondition().(ConditionalExpr).getCondition().(FunctionCall).getArgument(0).(FunctionCall).getTarget().hasName("skb_padto")
		and target_22.getCondition().(ConditionalExpr).getCondition().(FunctionCall).getArgument(0).(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vskb_3335
		and target_22.getCondition().(ConditionalExpr).getCondition().(FunctionCall).getArgument(0).(FunctionCall).getArgument(1) instanceof Literal
		and target_22.getCondition().(ConditionalExpr).getThen().(NotExpr).getOperand().(NotExpr).getOperand().(FunctionCall).getTarget().hasName("skb_padto")
		and target_22.getCondition().(ConditionalExpr).getThen().(NotExpr).getOperand().(NotExpr).getOperand().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vskb_3335
		and target_22.getCondition().(ConditionalExpr).getThen().(NotExpr).getOperand().(NotExpr).getOperand().(FunctionCall).getArgument(1) instanceof Literal
		and target_22.getCondition().(ConditionalExpr).getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(2).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=v______r_3368
		and target_22.getCondition().(ConditionalExpr).getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(3) instanceof IfStmt
		and target_22.getCondition().(ConditionalExpr).getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(4) instanceof ExprStmt
		and target_22.getThen() instanceof GotoStmt
		and target_22.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_30
}

*/
/*predicate func_25(Parameter vskb_3335, Variable v______r_3368, ExprStmt target_25) {
		target_25.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=v______r_3368
		and target_25.getExpr().(AssignExpr).getRValue().(NotExpr).getOperand().(NotExpr).getOperand().(FunctionCall).getTarget().hasName("skb_padto")
		and target_25.getExpr().(AssignExpr).getRValue().(NotExpr).getOperand().(NotExpr).getOperand().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vskb_3335
		and target_25.getExpr().(AssignExpr).getRValue().(NotExpr).getOperand().(NotExpr).getOperand().(FunctionCall).getArgument(1) instanceof Literal
}

*/
/*predicate func_26(Variable vlen_3342, ConditionalExpr target_30, ExprStmt target_26) {
		target_26.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vlen_3342
		and target_26.getExpr().(AssignExpr).getRValue().(Literal).getValue()="60"
		and target_26.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_30
}

*/
predicate func_27(Function func, GotoStmt target_27) {
		func.getEntryPoint().(BlockStmt).getAStmt()=target_27
}

predicate func_28(Function func, ConditionalExpr target_28) {
		target_28.getCondition() instanceof FunctionCall
		and target_28.getThen() instanceof NotExpr
		and target_28.getElse() instanceof StmtExpr
		and target_28.getEnclosingFunction() = func
}

predicate func_29(Function func, ConditionalExpr target_29) {
		target_29.getCondition().(FunctionCall).getTarget().hasName("__builtin_constant_p")
		and target_29.getCondition().(FunctionCall).getArgument(0).(VariableAccess).getTarget().getType().hasName("unsigned int")
		and target_29.getThen().(NotExpr).getOperand().(NotExpr).getOperand().(VariableAccess).getTarget().getType().hasName("unsigned int")
		and target_29.getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(2).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget().getType().hasName("int")
		and target_29.getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(3).(IfStmt).getCondition().(VariableAccess).getTarget().getType().hasName("int")
		and target_29.getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(3).(IfStmt).getThen().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getTarget().getName()="hit"
		and target_29.getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(3).(IfStmt).getElse().(ExprStmt).getExpr().(PostfixIncrExpr).getOperand().(ValueFieldAccess).getTarget().getName()="miss"
		and target_29.getElse().(StmtExpr).getStmt().(BlockStmt).getStmt(4).(ExprStmt).getExpr().(VariableAccess).getTarget().getType().hasName("int")
		and target_29.getEnclosingFunction() = func
}

predicate func_30(Function func, ConditionalExpr target_30) {
		target_30.getCondition() instanceof FunctionCall
		and target_30.getThen() instanceof NotExpr
		and target_30.getElse() instanceof StmtExpr
		and target_30.getEnclosingFunction() = func
}

from Function func, Parameter vskb_3335, Variable vlen_3342, Variable v______r_3367, Variable v______f_3367, Variable v______r_1_3367, Variable v______f_1_3367, Variable v______r_2_3367, Variable v______f_2_3367, Variable v______r_3_3367, Variable v______f_3_3367, Variable v______r_3368, Variable v______f_3368, IfStmt target_2, ExprStmt target_3, IfStmt target_4, ExprStmt target_5, GotoStmt target_6, IfStmt target_7, GotoStmt target_27, ConditionalExpr target_28, ConditionalExpr target_29, ConditionalExpr target_30
where
func_2(v______r_2_3367, v______f_2_3367, target_2)
and func_3(v______r_2_3367, target_3)
and func_4(v______r_3368, v______f_3368, target_4)
and func_5(v______r_3368, target_5)
and func_6(target_28, func, target_6)
and func_7(vskb_3335, vlen_3342, v______r_2_3367, target_29, target_7)
and func_27(func, target_27)
and func_28(func, target_28)
and func_29(func, target_29)
and func_30(func, target_30)
and vskb_3335.getType().hasName("sk_buff *")
and vlen_3342.getType().hasName("u32")
and v______r_3367.getType().hasName("int")
and v______f_3367.getType().hasName("ftrace_branch_data")
and v______r_1_3367.getType().hasName("int")
and v______f_1_3367.getType().hasName("ftrace_branch_data")
and v______r_2_3367.getType().hasName("int")
and v______f_2_3367.getType().hasName("ftrace_branch_data")
and v______r_3_3367.getType().hasName("int")
and v______f_3_3367.getType().hasName("ftrace_branch_data")
and v______r_3368.getType().hasName("int")
and v______f_3368.getType().hasName("ftrace_branch_data")
and vskb_3335.getFunction() = func
and vlen_3342.(LocalVariable).getFunction() = func
and v______r_3367.(LocalVariable).getFunction() = func
and v______f_3367.(LocalVariable).getFunction() = func
and v______r_1_3367.(LocalVariable).getFunction() = func
and v______f_1_3367.(LocalVariable).getFunction() = func
and v______r_2_3367.(LocalVariable).getFunction() = func
and v______f_2_3367.(LocalVariable).getFunction() = func
and v______r_3_3367.(LocalVariable).getFunction() = func
and v______f_3_3367.(LocalVariable).getFunction() = func
and v______r_3368.(LocalVariable).getFunction() = func
and v______f_3368.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
