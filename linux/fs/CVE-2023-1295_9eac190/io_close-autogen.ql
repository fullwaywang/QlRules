/**
 * @name linux-9eac1904d3364254d622bf2c771c4f85cd435fc2-io_close
 * @id cpp/linux/9eac1904d3364254d622bf2c771c4f85cd435fc2/io-close
 * @description linux-9eac1904d3364254d622bf2c771c4f85cd435fc2-fs/io_uring.c-io_close CVE-2023-1295
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vclose_4504, Variable vret_4505, FunctionCall target_0) {
		target_0.getTarget().hasName("close_fd_get_file")
		and not target_0.getTarget().hasName("debug_lockdep_rcu_enabled")
		and target_0.getArgument(0).(PointerFieldAccess).getTarget().getName()="fd"
		and target_0.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_0.getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="put_file"
		and target_0.getArgument(1).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_0.getParent().(AssignExpr).getRValue() = target_0
		and target_0.getParent().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
}

predicate func_3(Function func) {
	exists(FunctionCall target_3 |
		target_3.getTarget().hasName("spin_lock")
		and target_3.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
		and target_3.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
		and target_3.getEnclosingFunction() = func)
}

predicate func_4(Function func) {
	exists(ExprStmt target_4 |
		target_4.getExpr().(AssignExpr).getLValue().(VariableAccess).getType().hasName("fdtable *")
		and target_4.getExpr().(AssignExpr).getRValue().(StmtExpr).getStmt().(BlockStmt).getStmt(1).(DoStmt).getCondition() instanceof Literal
		and target_4.getExpr().(AssignExpr).getRValue().(StmtExpr).getStmt().(BlockStmt).getStmt(3).(ExprStmt).getExpr().(VariableAccess).getType().hasName("fdtable *")
		and func.getEntryPoint().(BlockStmt).getAStmt()=target_4)
}

predicate func_5(LogicalAndExpr target_55, Function func) {
	exists(DoStmt target_5 |
		target_5.getCondition() instanceof Literal
		and target_5.getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(NotExpr).getValue()="0"
		and target_5.getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__compiletime_assert_1893")
		and target_5.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(0)=target_5
		and target_5.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_55
		and target_5.getEnclosingFunction() = func)
}

/*predicate func_6(ReturnStmt target_46, Function func) {
	exists(NotExpr target_6 |
		target_6.getValue()="0"
		and target_6.getParent().(IfStmt).getThen()=target_46
		and target_6.getEnclosingFunction() = func)
}

*/
/*predicate func_7(RelationalOperation target_37, Function func) {
	exists(ExprStmt target_7 |
		target_7.getExpr().(FunctionCall).getTarget().hasName("__compiletime_assert_1893")
		and target_7.getParent().(IfStmt).getCondition()=target_37
		and target_7.getEnclosingFunction() = func)
}

*/
predicate func_8(Function func) {
	exists(PointerDereferenceExpr target_8 |
		target_8.getOperand().(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="fdt"
		and target_8.getOperand().(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
		and target_8.getEnclosingFunction() = func)
}

/*predicate func_9(NotExpr target_56, Function func) {
	exists(DoStmt target_9 |
		target_9.getCondition() instanceof Literal
		and target_9.getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(LogicalAndExpr).getAnOperand().(LogicalAndExpr).getAnOperand().(FunctionCall).getTarget().hasName("debug_lockdep_rcu_enabled")
		and target_9.getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(LogicalAndExpr).getAnOperand().(LogicalAndExpr).getAnOperand().(NotExpr).getOperand().(VariableAccess).getType().hasName("bool")
		and target_9.getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(LogicalAndExpr).getAnOperand().(NotExpr).getOperand().(LogicalOrExpr).getAnOperand().(FunctionCall).getTarget().hasName("lock_is_held")
		and target_9.getStmt().(BlockStmt).getStmt(1).(IfStmt).getCondition().(LogicalAndExpr).getAnOperand().(NotExpr).getOperand().(LogicalOrExpr).getAnOperand().(FunctionCall).getTarget().hasName("rcu_read_lock_held")
		and target_9.getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getType().hasName("bool")
		and target_9.getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("lockdep_rcu_suspicious")
		and target_9.getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(FunctionCall).getArgument(0) instanceof StringLiteral
		and target_9.getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(FunctionCall).getArgument(1) instanceof Literal
		and target_9.getStmt().(BlockStmt).getStmt(1).(IfStmt).getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(FunctionCall).getArgument(2).(StringLiteral).getValue()="suspicious rcu_dereference_check() usage"
		and target_9.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(1)=target_9
		and target_9.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_56
		and target_9.getEnclosingFunction() = func)
}

*/
/*predicate func_10(Parameter vforce_nonblock_4501, Variable vclose_4504, BlockStmt target_57) {
	exists(LogicalAndExpr target_10 |
		target_10.getAnOperand().(FunctionCall).getTarget().hasName("debug_lockdep_rcu_enabled")
		and target_10.getAnOperand().(NotExpr).getOperand().(VariableAccess).getType().hasName("bool")
		and target_10.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getTarget().getName()="flush"
		and target_10.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="f_op"
		and target_10.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="put_file"
		and target_10.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_10.getParent().(LogicalAndExpr).getAnOperand().(VariableAccess).getTarget()=vforce_nonblock_4501
		and target_10.getParent().(LogicalAndExpr).getParent().(IfStmt).getThen()=target_57)
}

*/
/*predicate func_11(Parameter vforce_nonblock_4501, Variable vclose_4504, BlockStmt target_57) {
	exists(NotExpr target_11 |
		target_11.getOperand().(LogicalOrExpr).getAnOperand().(FunctionCall).getTarget().hasName("lock_is_held")
		and target_11.getOperand().(LogicalOrExpr).getAnOperand().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ValueFieldAccess).getTarget().getName()="dep_map"
		and target_11.getOperand().(LogicalOrExpr).getAnOperand().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getTarget().getName()="(unknown field)"
		and target_11.getOperand().(LogicalOrExpr).getAnOperand().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(ValueFieldAccess).getQualifier().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="(unknown field)"
		and target_11.getOperand().(LogicalOrExpr).getAnOperand().(FunctionCall).getTarget().hasName("rcu_read_lock_held")
		and target_11.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getTarget().getName()="flush"
		and target_11.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="f_op"
		and target_11.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="put_file"
		and target_11.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_11.getParent().(LogicalAndExpr).getAnOperand().(VariableAccess).getTarget()=vforce_nonblock_4501
		and target_11.getParent().(LogicalAndExpr).getParent().(IfStmt).getThen()=target_57)
}

*/
/*predicate func_12(Function func) {
	exists(AssignExpr target_12 |
		target_12.getLValue().(VariableAccess).getType().hasName("bool")
		and target_12.getEnclosingFunction() = func)
}

*/
/*predicate func_13(NotExpr target_56, Function func) {
	exists(ExprStmt target_13 |
		target_13.getExpr().(FunctionCall).getTarget().hasName("lockdep_rcu_suspicious")
		and target_13.getExpr().(FunctionCall).getArgument(0) instanceof StringLiteral
		and target_13.getExpr().(FunctionCall).getArgument(1) instanceof Literal
		and target_13.getExpr().(FunctionCall).getArgument(2).(StringLiteral).getValue()="suspicious rcu_dereference_check() usage"
		and target_13.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(1)=target_13
		and target_13.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_56
		and target_13.getEnclosingFunction() = func)
}

*/
/*predicate func_14(NotExpr target_56, Function func) {
	exists(EmptyStmt target_14 |
		target_14.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(2)=target_14
		and target_14.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_56
		and target_14.getEnclosingFunction() = func)
}

*/
/*predicate func_15(NotExpr target_56, Function func) {
	exists(ExprStmt target_15 |
		target_15.getExpr().(VariableAccess).getType().hasName("fdtable *")
		and target_15.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(3)=target_15
		and target_15.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_56
		and target_15.getEnclosingFunction() = func)
}

*/
predicate func_16(Variable vclose_4504, BlockStmt target_57, NotExpr target_56) {
	exists(RelationalOperation target_16 |
		 (target_16 instanceof GEExpr or target_16 instanceof LEExpr)
		and target_16.getGreaterOperand().(PointerFieldAccess).getTarget().getName()="fd"
		and target_16.getGreaterOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_16.getLesserOperand().(PointerFieldAccess).getTarget().getName()="max_fds"
		and target_16.getLesserOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("fdtable *")
		and target_16.getParent().(IfStmt).getThen()=target_57
		and target_56.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_16.getGreaterOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation()))
}

predicate func_17(Function func) {
	exists(FunctionCall target_17 |
		target_17.getTarget().hasName("spin_unlock")
		and target_17.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
		and target_17.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
		and target_17.getEnclosingFunction() = func)
}

predicate func_18(LogicalAndExpr target_55, Function func) {
	exists(GotoStmt target_18 |
		target_18.getParent().(BlockStmt).getParent().(IfStmt).getThen().(BlockStmt).getStmt(1)=target_18
		and target_18.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_55
		and target_18.getEnclosingFunction() = func)
}

predicate func_19(Variable vclose_4504, Function func) {
	exists(ExprStmt target_19 |
		target_19.getExpr().(AssignExpr).getLValue().(VariableAccess).getType().hasName("file *")
		and target_19.getExpr().(AssignExpr).getRValue().(ArrayExpr).getArrayBase().(PointerFieldAccess).getTarget().getName()="fd"
		and target_19.getExpr().(AssignExpr).getRValue().(ArrayExpr).getArrayBase().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("fdtable *")
		and target_19.getExpr().(AssignExpr).getRValue().(ArrayExpr).getArrayOffset().(PointerFieldAccess).getTarget().getName()="fd"
		and target_19.getExpr().(AssignExpr).getRValue().(ArrayExpr).getArrayOffset().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and func.getEntryPoint().(BlockStmt).getAStmt()=target_19)
}

predicate func_20(Function func) {
	exists(IfStmt target_20 |
		target_20.getCondition().(NotExpr).getOperand().(VariableAccess).getType().hasName("file *")
		and target_20.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("spin_unlock")
		and target_20.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
		and target_20.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
		and func.getEntryPoint().(BlockStmt).getAStmt()=target_20)
}

predicate func_22(Function func) {
	exists(IfStmt target_22 |
		target_22.getCondition().(EqualityOperation).getAnOperand().(PointerFieldAccess).getTarget().getName()="f_op"
		and target_22.getCondition().(EqualityOperation).getAnOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("file *")
		and target_22.getCondition().(EqualityOperation).getAnOperand().(AddressOfExpr).getOperand().(VariableAccess).getType().hasName("const file_operations")
		and target_22.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("spin_unlock")
		and target_22.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
		and target_22.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
		and target_22.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getType().hasName("file *")
		and target_22.getThen().(BlockStmt).getStmt(1).(ExprStmt).getExpr().(AssignExpr).getRValue().(Literal).getValue()="0"
		and func.getEntryPoint().(BlockStmt).getAStmt()=target_22)
}

predicate func_23(Parameter vforce_nonblock_4501, Function func) {
	exists(IfStmt target_23 |
		target_23.getCondition().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getTarget().getName()="flush"
		and target_23.getCondition().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="f_op"
		and target_23.getCondition().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("file *")
		and target_23.getCondition().(LogicalAndExpr).getAnOperand().(VariableAccess).getTarget()=vforce_nonblock_4501
		and target_23.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("spin_unlock")
		and target_23.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
		and target_23.getThen().(BlockStmt).getStmt(0).(ExprStmt).getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
		and target_23.getThen().(BlockStmt).getStmt(1) instanceof ReturnStmt
		and func.getEntryPoint().(BlockStmt).getAStmt()=target_23)
}

/*predicate func_25(Function func) {
	exists(FunctionCall target_25 |
		target_25.getTarget().hasName("spin_unlock")
		and target_25.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
		and target_25.getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
		and target_25.getEnclosingFunction() = func)
}

*/
predicate func_26(Variable vclose_4504, Variable vret_4505, PointerFieldAccess target_61, ConditionalExpr target_62, RelationalOperation target_63, Function func) {
	exists(ExprStmt target_26 |
		target_26.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
		and target_26.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("__close_fd_get_file")
		and target_26.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="fd"
		and target_26.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_26.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(AddressOfExpr).getOperand().(VariableAccess).getType().hasName("file *")
		and func.getEntryPoint().(BlockStmt).getAStmt()=target_26
		and target_26.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_61.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
		and target_62.getElse().(VariableAccess).getLocation().isBefore(target_26.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation())
		and target_26.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_63.getLesserOperand().(VariableAccess).getLocation()))
}

/*predicate func_27(Variable vclose_4504, Variable vret_4505, PointerFieldAccess target_61) {
	exists(FunctionCall target_27 |
		target_27.getTarget().hasName("__close_fd_get_file")
		and target_27.getArgument(0).(PointerFieldAccess).getTarget().getName()="fd"
		and target_27.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_27.getArgument(1).(AddressOfExpr).getOperand().(VariableAccess).getType().hasName("file *")
		and target_27.getParent().(AssignExpr).getRValue() = target_27
		and target_27.getParent().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
		and target_27.getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_61.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation()))
}

*/
predicate func_29(Function func) {
	exists(ExprStmt target_29 |
		target_29.getExpr().(FunctionCall).getTarget().hasName("spin_unlock")
		and target_29.getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getTarget().getName()="file_lock"
		and target_29.getExpr().(FunctionCall).getArgument(0).(AddressOfExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getType().hasName("files_struct *")
		and func.getEntryPoint().(BlockStmt).getAStmt()=target_29)
}

predicate func_30(Variable vret_4505, RelationalOperation target_63, Function func) {
	exists(IfStmt target_30 |
		target_30.getCondition() instanceof RelationalOperation
		and target_30.getThen().(BlockStmt).getStmt(0).(IfStmt).getCondition() instanceof EqualityOperation
		and target_30.getThen().(BlockStmt).getStmt(0).(IfStmt).getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
		and target_30.getThen().(BlockStmt).getStmt(0).(IfStmt).getThen().(ExprStmt).getExpr().(AssignExpr).getRValue().(UnaryMinusExpr).getValue()="-9"
		and func.getEntryPoint().(BlockStmt).getAStmt()=target_30
		and target_63.getLesserOperand().(VariableAccess).getLocation().isBefore(target_30.getThen().(BlockStmt).getStmt(0).(IfStmt).getThen().(ExprStmt).getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation()))
}

predicate func_31(Variable vret_4505, ExprStmt target_65, Function func) {
	exists(ExprStmt target_31 |
		target_31.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
		and target_31.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("filp_close")
		and target_31.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(VariableAccess).getType().hasName("file *")
		and target_31.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="files"
		and target_31.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(FunctionCall).getTarget().hasName("get_current")
		and func.getEntryPoint().(BlockStmt).getAStmt()=target_31
		and target_31.getExpr().(AssignExpr).getLValue().(VariableAccess).getLocation().isBefore(target_65.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getLocation()))
}

/*predicate func_33(Variable vclose_4504) {
	exists(FunctionCall target_33 |
		target_33.getTarget().hasName("get_current")
		and target_33.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("filp_close")
		and target_33.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="put_file"
		and target_33.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_33.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="files"
		and target_33.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier() instanceof ValueFieldAccess)
}

*/
predicate func_34(Function func) {
	exists(IfStmt target_34 |
		target_34.getCondition().(VariableAccess).getType().hasName("file *")
		and target_34.getThen().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("fput")
		and target_34.getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getType().hasName("file *")
		and func.getEntryPoint().(BlockStmt).getAStmt()=target_34)
}

predicate func_36(Variable vclose_4504, PointerFieldAccess target_36) {
		target_36.getTarget().getName()="fd"
		and target_36.getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_36.getParent().(FunctionCall).getParent().(AssignExpr).getRValue() instanceof FunctionCall
}

predicate func_37(Variable vret_4505, ReturnStmt target_46, RelationalOperation target_37) {
		 (target_37 instanceof GTExpr or target_37 instanceof LTExpr)
		and target_37.getLesserOperand().(VariableAccess).getTarget()=vret_4505
		and target_37.getGreaterOperand().(Literal).getValue()="0"
		and target_37.getParent().(IfStmt).getThen()=target_46
}

predicate func_38(Variable vret_4505, EqualityOperation target_38) {
		target_38.getAnOperand().(VariableAccess).getTarget()=vret_4505
		and target_38.getAnOperand().(UnaryMinusExpr).getValue()="-2"
}

predicate func_39(Function func, UnaryMinusExpr target_39) {
		target_39.getValue()="-9"
		and target_39.getEnclosingFunction() = func
}

predicate func_40(LogicalAndExpr target_55, Function func, ReturnStmt target_40) {
		target_40.getExpr().(UnaryMinusExpr).getValue()="-11"
		and target_40.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_55
		and target_40.getEnclosingFunction() = func
}

predicate func_41(Variable vclose_4504, VariableAccess target_41) {
		target_41.getTarget()=vclose_4504
}

predicate func_42(Variable vclose_4504, VariableAccess target_42) {
		target_42.getTarget()=vclose_4504
		and target_42.getParent().(PointerFieldAccess).getParent().(AddressOfExpr).getParent().(FunctionCall).getParent().(AssignExpr).getRValue() instanceof FunctionCall
}

predicate func_43(Parameter vforce_nonblock_4501, Variable vclose_4504, BlockStmt target_57, VariableAccess target_43) {
		target_43.getTarget()=vforce_nonblock_4501
		and target_43.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getTarget().getName()="flush"
		and target_43.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="f_op"
		and target_43.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="put_file"
		and target_43.getParent().(LogicalAndExpr).getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_43.getParent().(LogicalAndExpr).getParent().(IfStmt).getThen()=target_57
}

predicate func_44(Variable vclose_4504, PointerFieldAccess target_44) {
		target_44.getTarget().getName()="put_file"
		and target_44.getQualifier().(VariableAccess).getTarget()=vclose_4504
}

predicate func_45(Variable vclose_4504, PointerFieldAccess target_61, PointerFieldAccess target_45) {
		target_45.getTarget().getName()="put_file"
		and target_45.getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_45.getQualifier().(VariableAccess).getLocation().isBefore(target_61.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_46(Variable vret_4505, RelationalOperation target_37, ReturnStmt target_46) {
		target_46.getExpr().(ConditionalExpr).getCondition() instanceof EqualityOperation
		and target_46.getExpr().(ConditionalExpr).getThen() instanceof UnaryMinusExpr
		and target_46.getExpr().(ConditionalExpr).getElse().(VariableAccess).getTarget()=vret_4505
		and target_46.getParent().(IfStmt).getCondition()=target_37
}

predicate func_47(Variable vclose_4504, AddressOfExpr target_68, ExprStmt target_69, PointerFieldAccess target_47) {
		target_47.getTarget().getName()="put_file"
		and target_47.getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_68.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_47.getQualifier().(VariableAccess).getLocation())
		and target_47.getQualifier().(VariableAccess).getLocation().isBefore(target_69.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_48(Parameter vreq_4501, AssignOrExpr target_48) {
		target_48.getLValue().(ValueFieldAccess).getTarget().getName()="flags"
		and target_48.getLValue().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="work"
		and target_48.getLValue().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vreq_4501
		and target_48.getRValue() instanceof EnumConstantAccess
}

predicate func_49(Parameter vreq_4501, AssignAndExpr target_49) {
		target_49.getLValue().(PointerFieldAccess).getTarget().getName()="flags"
		and target_49.getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vreq_4501
		and target_49.getRValue().(ComplementExpr).getValue()="4294966783"
}

predicate func_50(Parameter vreq_4501, AssignOrExpr target_50) {
		target_50.getLValue().(PointerFieldAccess).getTarget().getName()="flags"
		and target_50.getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vreq_4501
}

/*predicate func_51(Variable vclose_4504, PointerFieldAccess target_61, ExprStmt target_70, PointerFieldAccess target_51) {
		target_51.getTarget().getName()="put_file"
		and target_51.getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_61.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_51.getQualifier().(VariableAccess).getLocation())
		and target_51.getQualifier().(VariableAccess).getLocation().isBefore(target_70.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

*/
predicate func_52(Parameter vreq_4501, Variable vclose_4504, ValueFieldAccess target_52) {
		target_52.getTarget().getName()="identity"
		and target_52.getQualifier().(PointerFieldAccess).getTarget().getName()="work"
		and target_52.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vreq_4501
		and target_52.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("filp_close")
		and target_52.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="put_file"
		and target_52.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_52.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="files"
}

predicate func_53(Variable vclose_4504, ExprStmt target_69, ExprStmt target_71, PointerFieldAccess target_53) {
		target_53.getTarget().getName()="put_file"
		and target_53.getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_69.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_53.getQualifier().(VariableAccess).getLocation())
		and target_53.getQualifier().(VariableAccess).getLocation().isBefore(target_71.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_54(Variable vclose_4504, ExprStmt target_70, PointerFieldAccess target_54) {
		target_54.getTarget().getName()="put_file"
		and target_54.getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_70.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_54.getQualifier().(VariableAccess).getLocation())
}

predicate func_55(Parameter vforce_nonblock_4501, Variable vclose_4504, LogicalAndExpr target_55) {
		target_55.getAnOperand().(PointerFieldAccess).getTarget().getName()="flush"
		and target_55.getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="f_op"
		and target_55.getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="put_file"
		and target_55.getAnOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_55.getAnOperand().(VariableAccess).getTarget()=vforce_nonblock_4501
}

predicate func_56(Variable vclose_4504, NotExpr target_56) {
		target_56.getOperand().(PointerFieldAccess).getTarget().getName()="put_file"
		and target_56.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
}

predicate func_57(Function func, BlockStmt target_57) {
		target_57.getStmt(0).(ExprStmt).getExpr() instanceof AssignOrExpr
		and target_57.getStmt(1).(ExprStmt).getExpr() instanceof AssignAndExpr
		and target_57.getStmt(2).(ExprStmt).getExpr() instanceof AssignOrExpr
		and target_57.getStmt(3) instanceof ReturnStmt
		and target_57.getEnclosingFunction() = func
}

predicate func_61(Variable vclose_4504, PointerFieldAccess target_61) {
		target_61.getTarget().getName()="f_op"
		and target_61.getQualifier().(PointerFieldAccess).getTarget().getName()="put_file"
		and target_61.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
}

predicate func_62(Variable vret_4505, ConditionalExpr target_62) {
		target_62.getCondition() instanceof EqualityOperation
		and target_62.getThen() instanceof UnaryMinusExpr
		and target_62.getElse().(VariableAccess).getTarget()=vret_4505
}

predicate func_63(Variable vret_4505, ExprStmt target_72, RelationalOperation target_63) {
		 (target_63 instanceof GTExpr or target_63 instanceof LTExpr)
		and target_63.getLesserOperand().(VariableAccess).getTarget()=vret_4505
		and target_63.getGreaterOperand().(Literal).getValue()="0"
		and target_63.getParent().(IfStmt).getThen()=target_72
}

predicate func_65(Parameter vreq_4501, Variable vret_4505, ExprStmt target_65) {
		target_65.getExpr().(FunctionCall).getTarget().hasName("__io_req_complete")
		and target_65.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vreq_4501
		and target_65.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vret_4505
		and target_65.getExpr().(FunctionCall).getArgument(2).(Literal).getValue()="0"
		and target_65.getExpr().(FunctionCall).getArgument(3).(VariableAccess).getTarget().getType().hasName("io_comp_state *")
}

predicate func_68(Variable vclose_4504, AddressOfExpr target_68) {
		target_68.getOperand().(PointerFieldAccess).getTarget().getName()="put_file"
		and target_68.getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
}

predicate func_69(Variable vclose_4504, Variable vret_4505, ExprStmt target_69) {
		target_69.getExpr().(AssignExpr).getLValue().(VariableAccess).getTarget()=vret_4505
		and target_69.getExpr().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("filp_close")
		and target_69.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="put_file"
		and target_69.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_69.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="files"
		and target_69.getExpr().(AssignExpr).getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier() instanceof ValueFieldAccess
}

predicate func_70(Variable vclose_4504, ExprStmt target_70) {
		target_70.getExpr().(FunctionCall).getTarget().hasName("fput")
		and target_70.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="put_file"
		and target_70.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
}

predicate func_71(Variable vclose_4504, ExprStmt target_71) {
		target_71.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="put_file"
		and target_71.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vclose_4504
		and target_71.getExpr().(AssignExpr).getRValue().(Literal).getValue()="0"
}

predicate func_72(Parameter vreq_4501, ExprStmt target_72) {
		target_72.getExpr().(FunctionCall).getTarget().hasName("req_set_fail_links")
		and target_72.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vreq_4501
}

from Function func, Parameter vreq_4501, Parameter vforce_nonblock_4501, Variable vclose_4504, Variable vret_4505, FunctionCall target_0, PointerFieldAccess target_36, RelationalOperation target_37, EqualityOperation target_38, UnaryMinusExpr target_39, ReturnStmt target_40, VariableAccess target_41, VariableAccess target_42, VariableAccess target_43, PointerFieldAccess target_44, PointerFieldAccess target_45, ReturnStmt target_46, PointerFieldAccess target_47, AssignOrExpr target_48, AssignAndExpr target_49, AssignOrExpr target_50, ValueFieldAccess target_52, PointerFieldAccess target_53, PointerFieldAccess target_54, LogicalAndExpr target_55, NotExpr target_56, BlockStmt target_57, PointerFieldAccess target_61, ConditionalExpr target_62, RelationalOperation target_63, ExprStmt target_65, AddressOfExpr target_68, ExprStmt target_69, ExprStmt target_70, ExprStmt target_71, ExprStmt target_72
where
func_0(vclose_4504, vret_4505, target_0)
and not func_3(func)
and not func_4(func)
and not func_5(target_55, func)
and not func_8(func)
and not func_16(vclose_4504, target_57, target_56)
and not func_17(func)
and not func_18(target_55, func)
and not func_19(vclose_4504, func)
and not func_20(func)
and not func_22(func)
and not func_23(vforce_nonblock_4501, func)
and not func_26(vclose_4504, vret_4505, target_61, target_62, target_63, func)
and not func_29(func)
and not func_30(vret_4505, target_63, func)
and not func_31(vret_4505, target_65, func)
and not func_34(func)
and func_36(vclose_4504, target_36)
and func_37(vret_4505, target_46, target_37)
and func_38(vret_4505, target_38)
and func_39(func, target_39)
and func_40(target_55, func, target_40)
and func_41(vclose_4504, target_41)
and func_42(vclose_4504, target_42)
and func_43(vforce_nonblock_4501, vclose_4504, target_57, target_43)
and func_44(vclose_4504, target_44)
and func_45(vclose_4504, target_61, target_45)
and func_46(vret_4505, target_37, target_46)
and func_47(vclose_4504, target_68, target_69, target_47)
and func_48(vreq_4501, target_48)
and func_49(vreq_4501, target_49)
and func_50(vreq_4501, target_50)
and func_52(vreq_4501, vclose_4504, target_52)
and func_53(vclose_4504, target_69, target_71, target_53)
and func_54(vclose_4504, target_70, target_54)
and func_55(vforce_nonblock_4501, vclose_4504, target_55)
and func_56(vclose_4504, target_56)
and func_57(func, target_57)
and func_61(vclose_4504, target_61)
and func_62(vret_4505, target_62)
and func_63(vret_4505, target_72, target_63)
and func_65(vreq_4501, vret_4505, target_65)
and func_68(vclose_4504, target_68)
and func_69(vclose_4504, vret_4505, target_69)
and func_70(vclose_4504, target_70)
and func_71(vclose_4504, target_71)
and func_72(vreq_4501, target_72)
and vreq_4501.getType().hasName("io_kiocb *")
and vforce_nonblock_4501.getType().hasName("bool")
and vclose_4504.getType().hasName("io_close *")
and vret_4505.getType().hasName("int")
and vreq_4501.getFunction() = func
and vforce_nonblock_4501.getFunction() = func
and vclose_4504.(LocalVariable).getFunction() = func
and vret_4505.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
