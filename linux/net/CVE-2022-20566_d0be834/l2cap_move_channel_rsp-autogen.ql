/**
 * @name linux-d0be8347c623e0ac4202a1d4e0373882821f56b0-l2cap_move_channel_rsp
 * @id cpp/linux/d0be8347c623e0ac4202a1d4e0373882821f56b0/l2cap-move-channel-rsp
 * @description linux-d0be8347c623e0ac4202a1d4e0373882821f56b0-net/bluetooth/l2cap_core.c-l2cap_move_channel_rsp CVE-2022-20566
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_1(Variable v__UNIQUE_ID_ddebug1302_5443, VariableAccess target_1) {
	target_1.getTarget()=v__UNIQUE_ID_ddebug1302_5443
	and target_1.getParent().(ValueFieldAccess).getParent().(ValueFieldAccess).getParent().(AddressOfExpr).getParent().(PointerFieldAccess).getParent().(AddressOfExpr).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("arch_static_branch_jump")
}

predicate func_2(Variable v__UNIQUE_ID_ddebug1302_5443, VariableAccess target_2) {
	target_2.getTarget()=v__UNIQUE_ID_ddebug1302_5443
	and target_2.getParent().(ValueFieldAccess).getParent().(ValueFieldAccess).getParent().(AddressOfExpr).getParent().(PointerFieldAccess).getParent().(AddressOfExpr).getParent().(FunctionCall).getParent().(AssignExpr).getRValue().(FunctionCall).getTarget().hasName("arch_static_branch")
}

predicate func_3(Variable v__UNIQUE_ID_ddebug1302_5443, VariableAccess target_3) {
	target_3.getTarget()=v__UNIQUE_ID_ddebug1302_5443
	and target_3.getParent().(AddressOfExpr).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("__dynamic_pr_debug")
	and target_3.getParent().(AddressOfExpr).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(StringLiteral).getValue()="icid 0x%4.4x, result 0x%4.4x\n"
	and target_3.getParent().(AddressOfExpr).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget().getType().hasName("u16")
	and target_3.getParent().(AddressOfExpr).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(3).(VariableAccess).getTarget().getType().hasName("u16")
}

from Function func, Variable v__UNIQUE_ID_ddebug1302_5443, VariableAccess target_1, VariableAccess target_2, VariableAccess target_3
where
func_1(v__UNIQUE_ID_ddebug1302_5443, target_1)
and func_2(v__UNIQUE_ID_ddebug1302_5443, target_2)
and func_3(v__UNIQUE_ID_ddebug1302_5443, target_3)
and v__UNIQUE_ID_ddebug1302_5443.getType().hasName("_ddebug")
and v__UNIQUE_ID_ddebug1302_5443.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
