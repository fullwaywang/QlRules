commit fe6b4163351f503045b83bffd870d18da622a865	fe6b4163351f503045b83bffd870d18da622a865
Author: Viktor Semeniuk <vsemeniuk@google.com>
Date:   Wed Nov 29 10:37:28 2023 +0000

    Stop observing sync service on shutdown in PasswordsPrivateDelegate
    
    Bug: 1505176
    Change-Id: If1fa60a92120afb7ce53278ceaa7d4fde180bf8a
    Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/5070554
    Reviewed-by: Vasilii Sukhanov <vasilii@chromium.org>
    Commit-Queue: Viktor Semeniuk <vsemeniuk@google.com>
    Cr-Commit-Position: refs/heads/main@{#1230542}

diff --git a/chrome/browser/extensions/api/passwords_private/passwords_private_delegate_impl.cc b/chrome/browser/extensions/api/passwords_private/passwords_private_delegate_impl.cc
index f143cfaab8f34..89b234865825f 100644
--- a/chrome/browser/extensions/api/passwords_private/passwords_private_delegate_impl.cc
+++ b/chrome/browser/extensions/api/passwords_private/passwords_private_delegate_impl.cc
@@ -1059,6 +1059,10 @@ void PasswordsPrivateDelegateImpl::OnStateChanged(
   }
 }
 
+void PasswordsPrivateDelegateImpl::OnSyncShutdown(syncer::SyncService* sync) {
+  sync_service_observation_.Reset();
+}
+
 bool PasswordsPrivateDelegateImpl::OnReauthCompleted(bool authenticated) {
   device_authenticator_.reset();
 
diff --git a/chrome/browser/extensions/api/passwords_private/passwords_private_delegate_impl.h b/chrome/browser/extensions/api/passwords_private/passwords_private_delegate_impl.h
index da83a65afbb7c..ee302a722a866 100644
--- a/chrome/browser/extensions/api/passwords_private/passwords_private_delegate_impl.h
+++ b/chrome/browser/extensions/api/passwords_private/passwords_private_delegate_impl.h
@@ -232,6 +232,7 @@ class PasswordsPrivateDelegateImpl
 
   // SyncServiceObserver overrides.
   void OnStateChanged(syncer::SyncService* sync_service) override;
+  void OnSyncShutdown(syncer::SyncService* sync) override;
 
   void OnFetchingFamilyMembersCompleted(
       FetchFamilyResultsCallback callback,
