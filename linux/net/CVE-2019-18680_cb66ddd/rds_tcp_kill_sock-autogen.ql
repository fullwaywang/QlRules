/**
 * @name linux-cb66ddd156203daefb8d71158036b27b0e2caf63-rds_tcp_kill_sock
 * @id cpp/linux/cb66ddd156203daefb8d71158036b27b0e2caf63/rds-tcp-kill-sock
 * @description linux-cb66ddd156203daefb8d71158036b27b0e2caf63-net/rds/tcp.c-rds_tcp_kill_sock CVE-2019-18680
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Variable vc_net_609, Parameter vnet_598, EqualityOperation target_0) {
	target_0.getLeftOperand().(VariableAccess).getTarget()=vnet_598
	and target_0.getRightOperand().(VariableAccess).getTarget()=vc_net_609
	and target_0.getParent().(LogicalOrExpr).getRightOperand() instanceof NotExpr
	and target_0.getParent().(LogicalOrExpr).getParent().(IfStmt).getThen() instanceof ContinueStmt
}

predicate func_1(Variable vtc_600, LogicalOrExpr target_1) {
	target_1.getLeftOperand() instanceof EqualityOperation
	and target_1.getRightOperand().(NotExpr).getOperand().(PointerFieldAccess).getTarget().getName()="t_sock"
	and target_1.getRightOperand().(NotExpr).getOperand().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vtc_600
	and target_1.getParent().(IfStmt).getThen() instanceof ContinueStmt
}

from Function func, Variable vtc_600, Variable vc_net_609, Parameter vnet_598, EqualityOperation target_0, LogicalOrExpr target_1
where
func_0(vc_net_609, vnet_598, target_0)
and func_1(vtc_600, target_1)
and vtc_600.getType().hasName("rds_tcp_connection *")
and vc_net_609.getType().hasName("net *")
and vnet_598.getType().hasName("net *")
and vtc_600.(LocalVariable).getFunction() = func
and vc_net_609.(LocalVariable).getFunction() = func
and vnet_598.getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
