/**
 * @name linux-372e3147df7016ebeaa372939e8774a1292db558-binder_translate_handle
 * @id cpp/linux/372e3147df7016ebeaa372939e8774a1292db558/binder-translate-handle
 * @description linux-372e3147df7016ebeaa372939e8774a1292db558-drivers/android/binder.c-binder_translate_handle CVE-2018-20509
 * @kind problem
 * @problem.severity error
 * @tags security
 */

import cpp

predicate func_0(Parameter vfp_1257, Variable vnew_ref_1290, FunctionCall target_0) {
	target_0.getTarget().hasName("binder_inc_ref")
	and not target_0.getTarget().hasName("binder_inc_ref_for_node")
	and target_0.getArgument(0).(VariableAccess).getTarget()=vnew_ref_1290
	and target_0.getArgument(1).(EqualityOperation).getLeftOperand().(ValueFieldAccess).getTarget().getName()="type"
	and target_0.getArgument(1).(EqualityOperation).getLeftOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="hdr"
	and target_0.getArgument(1).(EqualityOperation).getLeftOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vfp_1257
	and target_0.getArgument(2).(Literal).getValue()="0"
}

predicate func_1(IfStmt target_59, Function func, ExprStmt target_1) {
	target_1.getExpr() instanceof AssignExpr
	and target_1.getLocation().isBefore(target_59.getLocation())
	and target_1.getEnclosingFunction() = func
}

predicate func_3(Variable vproc_1262, ExprStmt target_60) {
exists(AssignExpr target_3 |
	target_3.getLValue().(VariableAccess).getType().hasName("binder_node *")
	and target_3.getRValue().(FunctionCall).getTarget().hasName("binder_get_node_from_ref")
	and target_3.getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vproc_1262
	and target_3.getRValue().(FunctionCall).getArgument(1) instanceof ValueFieldAccess
	and target_3.getRValue().(FunctionCall).getArgument(2) instanceof EqualityOperation
	and target_3.getRValue().(FunctionCall).getArgument(3).(AddressOfExpr).getOperand().(VariableAccess).getType().hasName("binder_ref_data")
	and target_3.getRValue().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_60.getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation()))
}

predicate func_10(Parameter vt_1258, Variable vref_1261) {
exists(AddressOfExpr target_10 |
	target_10.getOperand().(VariableAccess).getType().hasName("binder_ref_data")
	and target_10.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("trace_binder_transaction_ref_to_node")
	and target_10.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vt_1258
	and target_10.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vref_1261)
}

predicate func_11(Function func) {
exists(ValueFieldAccess target_11 |
	target_11.getTarget().getName()="debug_id"
	and target_11.getQualifier().(VariableAccess).getType().hasName("binder_ref_data")
	and target_11.getEnclosingFunction() = func)
}

predicate func_12(Function func) {
exists(ValueFieldAccess target_12 |
	target_12.getTarget().getName()="desc"
	and target_12.getQualifier().(VariableAccess).getType().hasName("binder_ref_data")
	and target_12.getEnclosingFunction() = func)
}

predicate func_16(Parameter vfp_1257, Variable vtarget_proc_1263, ExprStmt target_61) {
exists(AssignExpr target_16 |
	target_16.getLValue().(VariableAccess).getType().hasName("int")
	and target_16.getRValue().(FunctionCall).getTarget().hasName("binder_inc_ref_for_node")
	and target_16.getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vtarget_proc_1263
	and target_16.getRValue().(FunctionCall).getArgument(1).(VariableAccess).getType().hasName("binder_node *")
	and target_16.getRValue().(FunctionCall).getArgument(2).(EqualityOperation).getLeftOperand().(ValueFieldAccess).getTarget().getName()="type"
	and target_16.getRValue().(FunctionCall).getArgument(2).(EqualityOperation).getLeftOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="hdr"
	and target_16.getRValue().(FunctionCall).getArgument(2).(EqualityOperation).getLeftOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vfp_1257
	and target_16.getRValue().(FunctionCall).getArgument(3).(Literal).getValue()="0"
	and target_16.getRValue().(FunctionCall).getArgument(4).(AddressOfExpr).getOperand().(VariableAccess).getType().hasName("binder_ref_data")
	and target_61.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_16.getRValue().(FunctionCall).getArgument(2).(EqualityOperation).getLeftOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation()))
}

/*predicate func_18(Function func) {
exists(AddressOfExpr target_18 |
	target_18.getOperand().(VariableAccess).getType().hasName("binder_ref_data")
	and target_18.getParent().(FunctionCall).getParent().(ExprStmt).getExpr() instanceof FunctionCall
	and target_18.getEnclosingFunction() = func)
}

*/
predicate func_21(Function func) {
exists(ValueFieldAccess target_21 |
	target_21.getTarget().getName()="desc"
	and target_21.getQualifier().(VariableAccess).getType().hasName("binder_ref_data")
	and target_21.getEnclosingFunction() = func)
}

predicate func_23(Parameter vt_1258, Variable vref_1261, Variable vnew_ref_1290) {
exists(AddressOfExpr target_23 |
	target_23.getOperand().(VariableAccess).getType().hasName("binder_ref_data")
	and target_23.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("trace_binder_transaction_ref_to_ref")
	and target_23.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vt_1258
	and target_23.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vref_1261
	and target_23.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget()=vnew_ref_1290)
}

predicate func_24(Parameter vt_1258, Variable vref_1261, Variable vnew_ref_1290) {
exists(AddressOfExpr target_24 |
	target_24.getOperand().(VariableAccess).getType().hasName("binder_ref_data")
	and target_24.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("trace_binder_transaction_ref_to_ref")
	and target_24.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vt_1258
	and target_24.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vref_1261
	and target_24.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget()=vnew_ref_1290)
}

predicate func_25(Function func) {
exists(ValueFieldAccess target_25 |
	target_25.getTarget().getName()="debug_id"
	and target_25.getQualifier().(VariableAccess).getType().hasName("binder_ref_data")
	and target_25.getEnclosingFunction() = func)
}

predicate func_26(Function func) {
exists(ValueFieldAccess target_26 |
	target_26.getTarget().getName()="desc"
	and target_26.getQualifier().(VariableAccess).getType().hasName("binder_ref_data")
	and target_26.getEnclosingFunction() = func)
}

predicate func_27(Function func) {
exists(ValueFieldAccess target_27 |
	target_27.getTarget().getName()="debug_id"
	and target_27.getQualifier().(VariableAccess).getType().hasName("binder_ref_data")
	and target_27.getEnclosingFunction() = func)
}

predicate func_28(Function func) {
exists(ValueFieldAccess target_28 |
	target_28.getTarget().getName()="desc"
	and target_28.getQualifier().(VariableAccess).getType().hasName("binder_ref_data")
	and target_28.getEnclosingFunction() = func)
}

predicate func_30(Parameter vfp_1257, ValueFieldAccess target_30) {
	target_30.getTarget().getName()="handle"
	and target_30.getQualifier().(PointerFieldAccess).getTarget().getName()="(unknown field)"
	and target_30.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vfp_1257
}

predicate func_31(Parameter vfp_1257, EqualityOperation target_31) {
	target_31.getLeftOperand().(ValueFieldAccess).getTarget().getName()="type"
	and target_31.getLeftOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="hdr"
	and target_31.getLeftOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vfp_1257
	and target_31.getParent().(FunctionCall).getParent().(AssignExpr).getRValue() instanceof FunctionCall
}

predicate func_32(Variable vproc_1262, VariableAccess target_32) {
	target_32.getTarget()=vproc_1262
	and target_32.getParent().(FunctionCall).getParent().(AssignExpr).getRValue() instanceof FunctionCall
}

predicate func_33(Variable vtarget_proc_1263, VariableAccess target_33) {
	target_33.getTarget()=vtarget_proc_1263
	and target_33.getParent().(FunctionCall).getParent().(AssignExpr).getRValue() instanceof FunctionCall
}

predicate func_35(Variable vref_1261, Variable vproc_1262, AssignExpr target_35) {
	target_35.getLValue().(VariableAccess).getTarget()=vref_1261
	and target_35.getRValue().(FunctionCall).getTarget().hasName("binder_get_ref")
	and target_35.getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vproc_1262
	and target_35.getRValue().(FunctionCall).getArgument(1) instanceof ValueFieldAccess
	and target_35.getRValue().(FunctionCall).getArgument(2) instanceof EqualityOperation
}

predicate func_36(Variable vref_1261, BlockStmt target_62, EqualityOperation target_64, VariableAccess target_36) {
	target_36.getTarget()=vref_1261
	and target_36.getParent().(NotExpr).getParent().(IfStmt).getThen()=target_62
	and target_36.getLocation().isBefore(target_64.getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_37(Variable vref_1261, NotExpr target_65, ExprStmt target_66, PointerFieldAccess target_37) {
	target_37.getTarget().getName()="node"
	and target_37.getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_65.getOperand().(VariableAccess).getLocation().isBefore(target_37.getQualifier().(VariableAccess).getLocation())
	and target_37.getQualifier().(VariableAccess).getLocation().isBefore(target_66.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_38(Variable vref_1261, EqualityOperation target_64, ExprStmt target_67, PointerFieldAccess target_38) {
	target_38.getTarget().getName()="node"
	and target_38.getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_64.getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_38.getQualifier().(VariableAccess).getLocation())
	and target_38.getQualifier().(VariableAccess).getLocation().isBefore(target_67.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_39(Variable vref_1261, ExprStmt target_66, ExprStmt target_68, PointerFieldAccess target_39) {
	target_39.getTarget().getName()="node"
	and target_39.getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_66.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_39.getQualifier().(VariableAccess).getLocation())
	and target_39.getQualifier().(VariableAccess).getLocation().isBefore(target_68.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_40(Variable vref_1261, ExprStmt target_67, ExprStmt target_69, PointerFieldAccess target_40) {
	target_40.getTarget().getName()="node"
	and target_40.getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_67.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_40.getQualifier().(VariableAccess).getLocation())
	and target_40.getQualifier().(VariableAccess).getLocation().isBefore(target_69.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getLocation())
}

predicate func_41(Parameter vt_1258, Variable vref_1261, ExprStmt target_51, ExprStmt target_68, ExprStmt target_70, VariableAccess target_41) {
	target_41.getTarget()=vref_1261
	and target_41.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("trace_binder_transaction_ref_to_node")
	and target_41.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vt_1258
	and target_41.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_51.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
	and target_68.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_41.getLocation())
	and target_41.getLocation().isBefore(target_70.getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_42(Variable vref_1261, ExprStmt target_69, VariableAccess target_42) {
	target_42.getTarget()=vref_1261
	and target_42.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("printk")
	and target_42.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(StringLiteral).getValue()="6binder:         ref %d desc %d -> node %d u%016llx\n"
	and target_42.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="debug_id"
	and target_42.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(PointerFieldAccess).getTarget().getName()="desc"
	and target_42.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_42.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(3).(PointerFieldAccess).getTarget().getName()="debug_id"
	and target_42.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(3).(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="node"
	and target_42.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(3).(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_42.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(4).(PointerFieldAccess).getTarget().getName()="ptr"
	and target_42.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(4).(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="node"
	and target_42.getParent().(PointerFieldAccess).getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(4).(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_69.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getLocation().isBefore(target_42.getLocation())
}

/*predicate func_43(Variable vref_1261, PointerFieldAccess target_43) {
	target_43.getTarget().getName()="desc"
	and target_43.getQualifier().(VariableAccess).getTarget()=vref_1261
}

*/
/*predicate func_44(Variable vref_1261, PointerFieldAccess target_71, PointerFieldAccess target_44) {
	target_44.getTarget().getName()="node"
	and target_44.getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_44.getQualifier().(VariableAccess).getLocation().isBefore(target_71.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

*/
/*predicate func_45(Variable vref_1261, PointerFieldAccess target_72, ExprStmt target_1, PointerFieldAccess target_45) {
	target_45.getTarget().getName()="node"
	and target_45.getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_72.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_45.getQualifier().(VariableAccess).getLocation())
}

*/
predicate func_47(Variable vref_1261, Variable vtarget_proc_1263, Variable vnew_ref_1290, AssignExpr target_47) {
	target_47.getLValue().(VariableAccess).getTarget()=vnew_ref_1290
	and target_47.getRValue().(FunctionCall).getTarget().hasName("binder_get_ref_for_node")
	and target_47.getRValue().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vtarget_proc_1263
	and target_47.getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="node"
	and target_47.getRValue().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
}

predicate func_48(Variable vnew_ref_1290, ReturnStmt target_73, NotExpr target_48) {
	target_48.getOperand().(VariableAccess).getTarget()=vnew_ref_1290
	and target_48.getParent().(IfStmt).getThen()=target_73
}

predicate func_49(Function func, UnaryMinusExpr target_49) {
	target_49.getValue()="-12"
	and target_49.getEnclosingFunction() = func
}

predicate func_50(Variable vnew_ref_1290, NotExpr target_48, PointerFieldAccess target_50) {
	target_50.getTarget().getName()="desc"
	and target_50.getQualifier().(VariableAccess).getTarget()=vnew_ref_1290
	and target_48.getOperand().(VariableAccess).getLocation().isBefore(target_50.getQualifier().(VariableAccess).getLocation())
}

predicate func_51(Parameter vt_1258, Variable vref_1261, Variable vnew_ref_1290, EqualityOperation target_64, ExprStmt target_51) {
	target_51.getExpr().(FunctionCall).getTarget().hasName("trace_binder_transaction_ref_to_ref")
	and target_51.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vt_1258
	and target_51.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vref_1261
	and target_51.getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget()=vnew_ref_1290
	and target_51.getParent().(BlockStmt).getParent().(IfStmt).getCondition()=target_64
}

/*predicate func_52(Parameter vt_1258, Variable vref_1261, Variable vnew_ref_1290, ExprStmt target_69, ExprStmt target_1, ExprStmt target_75, VariableAccess target_52) {
	target_52.getTarget()=vref_1261
	and target_52.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("trace_binder_transaction_ref_to_ref")
	and target_52.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vt_1258
	and target_52.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(VariableAccess).getTarget()=vnew_ref_1290
	and target_69.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_52.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
	and target_52.getLocation().isBefore(target_75.getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

*/
/*predicate func_53(Parameter vt_1258, Variable vref_1261, Variable vnew_ref_1290, ExprStmt target_69, ExprStmt target_1, ExprStmt target_75, VariableAccess target_53) {
	target_53.getTarget()=vnew_ref_1290
	and target_53.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("trace_binder_transaction_ref_to_ref")
	and target_53.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vt_1258
	and target_53.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vref_1261
	and target_69.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation().isBefore(target_53.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(VariableAccess).getLocation())
	and target_53.getParent().(FunctionCall).getParent().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(VariableAccess).getLocation().isBefore(target_75.getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

*/
predicate func_54(Variable vref_1261, PointerFieldAccess target_54) {
	target_54.getTarget().getName()="debug_id"
	and target_54.getQualifier().(VariableAccess).getTarget()=vref_1261
}

predicate func_55(Variable vref_1261, PointerFieldAccess target_58, PointerFieldAccess target_55) {
	target_55.getTarget().getName()="desc"
	and target_55.getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_55.getQualifier().(VariableAccess).getLocation().isBefore(target_58.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getLocation())
}

predicate func_56(Variable vnew_ref_1290, PointerFieldAccess target_56) {
	target_56.getTarget().getName()="debug_id"
	and target_56.getQualifier().(VariableAccess).getTarget()=vnew_ref_1290
}

predicate func_57(Variable vnew_ref_1290, ExprStmt target_75, PointerFieldAccess target_57) {
	target_57.getTarget().getName()="desc"
	and target_57.getQualifier().(VariableAccess).getTarget()=vnew_ref_1290
	and target_75.getExpr().(FunctionCall).getArgument(3).(PointerFieldAccess).getQualifier().(VariableAccess).getLocation().isBefore(target_57.getQualifier().(VariableAccess).getLocation())
}

predicate func_58(Variable vref_1261, PointerFieldAccess target_58) {
	target_58.getTarget().getName()="debug_id"
	and target_58.getQualifier().(PointerFieldAccess).getTarget().getName()="node"
	and target_58.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
}

predicate func_59(Function func, IfStmt target_59) {
	target_59.getCondition() instanceof NotExpr
	and target_59.getThen().(ReturnStmt).getExpr() instanceof UnaryMinusExpr
	and target_59.getEnclosingFunction() = func
}

predicate func_60(Parameter vfp_1257, Variable vproc_1262, ExprStmt target_60) {
	target_60.getExpr().(FunctionCall).getTarget().hasName("printk")
	and target_60.getExpr().(FunctionCall).getArgument(0).(StringLiteral).getValue()="6binder: %d:%d got transaction with invalid handle, %d\n"
	and target_60.getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="pid"
	and target_60.getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vproc_1262
	and target_60.getExpr().(FunctionCall).getArgument(2).(PointerFieldAccess).getTarget().getName()="pid"
	and target_60.getExpr().(FunctionCall).getArgument(2).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget().getType().hasName("binder_thread *")
	and target_60.getExpr().(FunctionCall).getArgument(3).(ValueFieldAccess).getTarget().getName()="handle"
	and target_60.getExpr().(FunctionCall).getArgument(3).(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="(unknown field)"
	and target_60.getExpr().(FunctionCall).getArgument(3).(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vfp_1257
}

predicate func_61(Parameter vfp_1257, ExprStmt target_61) {
	target_61.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="cookie"
	and target_61.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vfp_1257
	and target_61.getExpr().(AssignExpr).getRValue().(Literal).getValue()="0"
}

predicate func_62(Function func, BlockStmt target_62) {
	target_62.getStmt(0).(DoStmt).getCondition().(Literal).getValue()="0"
	and target_62.getStmt(0).(DoStmt).getStmt().(BlockStmt).getStmt(0).(IfStmt).getCondition().(BitwiseAndExpr).getLeftOperand().(VariableAccess).getTarget().getType().hasName("uint32_t")
	and target_62.getStmt(0).(DoStmt).getStmt().(BlockStmt).getStmt(0).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getTarget().hasName("printk")
	and target_62.getStmt(0).(DoStmt).getStmt().(BlockStmt).getStmt(0).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(0).(StringLiteral).getValue()="6binder: %d:%d got transaction with invalid handle, %d\n"
	and target_62.getStmt(0).(DoStmt).getStmt().(BlockStmt).getStmt(0).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="pid"
	and target_62.getStmt(0).(DoStmt).getStmt().(BlockStmt).getStmt(0).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(2).(PointerFieldAccess).getTarget().getName()="pid"
	and target_62.getStmt(0).(DoStmt).getStmt().(BlockStmt).getStmt(0).(IfStmt).getThen().(ExprStmt).getExpr().(FunctionCall).getArgument(3).(ValueFieldAccess).getTarget().getName()="handle"
	and target_62.getEnclosingFunction() = func
}

predicate func_64(Variable vref_1261, Variable vtarget_proc_1263, EqualityOperation target_64) {
	target_64.getLeftOperand().(PointerFieldAccess).getTarget().getName()="proc"
	and target_64.getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="node"
	and target_64.getLeftOperand().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_64.getRightOperand().(VariableAccess).getTarget()=vtarget_proc_1263
}

predicate func_65(Variable vref_1261, NotExpr target_65) {
	target_65.getOperand().(VariableAccess).getTarget()=vref_1261
}

predicate func_66(Parameter vfp_1257, Variable vref_1261, ExprStmt target_66) {
	target_66.getExpr().(AssignExpr).getLValue().(ValueFieldAccess).getTarget().getName()="binder"
	and target_66.getExpr().(AssignExpr).getLValue().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="(unknown field)"
	and target_66.getExpr().(AssignExpr).getLValue().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vfp_1257
	and target_66.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getTarget().getName()="ptr"
	and target_66.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="node"
	and target_66.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
}

predicate func_67(Parameter vfp_1257, Variable vref_1261, ExprStmt target_67) {
	target_67.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getTarget().getName()="cookie"
	and target_67.getExpr().(AssignExpr).getLValue().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vfp_1257
	and target_67.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getTarget().getName()="cookie"
	and target_67.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="node"
	and target_67.getExpr().(AssignExpr).getRValue().(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
}

predicate func_68(Parameter vfp_1257, Variable vref_1261, ExprStmt target_68) {
	target_68.getExpr().(FunctionCall).getTarget().hasName("binder_inc_node")
	and target_68.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getTarget().getName()="node"
	and target_68.getExpr().(FunctionCall).getArgument(0).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_68.getExpr().(FunctionCall).getArgument(1).(EqualityOperation).getLeftOperand().(ValueFieldAccess).getTarget().getName()="type"
	and target_68.getExpr().(FunctionCall).getArgument(1).(EqualityOperation).getLeftOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="hdr"
	and target_68.getExpr().(FunctionCall).getArgument(1).(EqualityOperation).getLeftOperand().(ValueFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vfp_1257
	and target_68.getExpr().(FunctionCall).getArgument(2).(Literal).getValue()="0"
	and target_68.getExpr().(FunctionCall).getArgument(3).(Literal).getValue()="0"
}

predicate func_69(Parameter vt_1258, Variable vref_1261, ExprStmt target_69) {
	target_69.getExpr().(FunctionCall).getTarget().hasName("trace_binder_transaction_ref_to_node")
	and target_69.getExpr().(FunctionCall).getArgument(0).(VariableAccess).getTarget()=vt_1258
	and target_69.getExpr().(FunctionCall).getArgument(1).(VariableAccess).getTarget()=vref_1261
}

predicate func_70(Variable vref_1261, ExprStmt target_70) {
	target_70.getExpr().(FunctionCall).getTarget().hasName("printk")
	and target_70.getExpr().(FunctionCall).getArgument(0).(StringLiteral).getValue()="6binder:         ref %d desc %d -> node %d u%016llx\n"
	and target_70.getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="debug_id"
	and target_70.getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_70.getExpr().(FunctionCall).getArgument(2).(PointerFieldAccess).getTarget().getName()="desc"
	and target_70.getExpr().(FunctionCall).getArgument(2).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_70.getExpr().(FunctionCall).getArgument(3).(PointerFieldAccess).getTarget().getName()="debug_id"
	and target_70.getExpr().(FunctionCall).getArgument(3).(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="node"
	and target_70.getExpr().(FunctionCall).getArgument(3).(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_70.getExpr().(FunctionCall).getArgument(4).(PointerFieldAccess).getTarget().getName()="ptr"
	and target_70.getExpr().(FunctionCall).getArgument(4).(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="node"
	and target_70.getExpr().(FunctionCall).getArgument(4).(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
}

predicate func_71(Variable vref_1261, PointerFieldAccess target_71) {
	target_71.getTarget().getName()="ptr"
	and target_71.getQualifier().(PointerFieldAccess).getTarget().getName()="node"
	and target_71.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
}

predicate func_72(Variable vref_1261, PointerFieldAccess target_72) {
	target_72.getTarget().getName()="debug_id"
	and target_72.getQualifier().(PointerFieldAccess).getTarget().getName()="node"
	and target_72.getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
}

predicate func_73(Function func, ReturnStmt target_73) {
	target_73.getExpr() instanceof UnaryMinusExpr
	and target_73.getEnclosingFunction() = func
}

predicate func_75(Variable vref_1261, Variable vnew_ref_1290, ExprStmt target_75) {
	target_75.getExpr().(FunctionCall).getTarget().hasName("printk")
	and target_75.getExpr().(FunctionCall).getArgument(0).(StringLiteral).getValue()="6binder:         ref %d desc %d -> ref %d desc %d (node %d)\n"
	and target_75.getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getTarget().getName()="debug_id"
	and target_75.getExpr().(FunctionCall).getArgument(1).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_75.getExpr().(FunctionCall).getArgument(2).(PointerFieldAccess).getTarget().getName()="desc"
	and target_75.getExpr().(FunctionCall).getArgument(2).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
	and target_75.getExpr().(FunctionCall).getArgument(3).(PointerFieldAccess).getTarget().getName()="debug_id"
	and target_75.getExpr().(FunctionCall).getArgument(3).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vnew_ref_1290
	and target_75.getExpr().(FunctionCall).getArgument(4).(PointerFieldAccess).getTarget().getName()="desc"
	and target_75.getExpr().(FunctionCall).getArgument(4).(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vnew_ref_1290
	and target_75.getExpr().(FunctionCall).getArgument(5).(PointerFieldAccess).getTarget().getName()="debug_id"
	and target_75.getExpr().(FunctionCall).getArgument(5).(PointerFieldAccess).getQualifier().(PointerFieldAccess).getTarget().getName()="node"
	and target_75.getExpr().(FunctionCall).getArgument(5).(PointerFieldAccess).getQualifier().(PointerFieldAccess).getQualifier().(VariableAccess).getTarget()=vref_1261
}

from Function func, Parameter vfp_1257, Parameter vt_1258, Variable vref_1261, Variable vproc_1262, Variable vtarget_proc_1263, Variable vnew_ref_1290, FunctionCall target_0, ExprStmt target_1, ValueFieldAccess target_30, EqualityOperation target_31, VariableAccess target_32, VariableAccess target_33, AssignExpr target_35, VariableAccess target_36, PointerFieldAccess target_37, PointerFieldAccess target_38, PointerFieldAccess target_39, PointerFieldAccess target_40, VariableAccess target_41, VariableAccess target_42, AssignExpr target_47, NotExpr target_48, UnaryMinusExpr target_49, PointerFieldAccess target_50, ExprStmt target_51, PointerFieldAccess target_54, PointerFieldAccess target_55, PointerFieldAccess target_56, PointerFieldAccess target_57, PointerFieldAccess target_58, IfStmt target_59, ExprStmt target_60, ExprStmt target_61, BlockStmt target_62, EqualityOperation target_64, NotExpr target_65, ExprStmt target_66, ExprStmt target_67, ExprStmt target_68, ExprStmt target_69, ExprStmt target_70, PointerFieldAccess target_71, PointerFieldAccess target_72, ReturnStmt target_73, ExprStmt target_75
where
func_0(vfp_1257, vnew_ref_1290, target_0)
and func_1(target_59, func, target_1)
and not func_3(vproc_1262, target_60)
and not func_10(vt_1258, vref_1261)
and not func_11(func)
and not func_12(func)
and not func_16(vfp_1257, vtarget_proc_1263, target_61)
and not func_21(func)
and not func_23(vt_1258, vref_1261, vnew_ref_1290)
and not func_24(vt_1258, vref_1261, vnew_ref_1290)
and not func_25(func)
and not func_26(func)
and not func_27(func)
and not func_28(func)
and func_30(vfp_1257, target_30)
and func_31(vfp_1257, target_31)
and func_32(vproc_1262, target_32)
and func_33(vtarget_proc_1263, target_33)
and func_35(vref_1261, vproc_1262, target_35)
and func_36(vref_1261, target_62, target_64, target_36)
and func_37(vref_1261, target_65, target_66, target_37)
and func_38(vref_1261, target_64, target_67, target_38)
and func_39(vref_1261, target_66, target_68, target_39)
and func_40(vref_1261, target_67, target_69, target_40)
and func_41(vt_1258, vref_1261, target_51, target_68, target_70, target_41)
and func_42(vref_1261, target_69, target_42)
and func_47(vref_1261, vtarget_proc_1263, vnew_ref_1290, target_47)
and func_48(vnew_ref_1290, target_73, target_48)
and func_49(func, target_49)
and func_50(vnew_ref_1290, target_48, target_50)
and func_51(vt_1258, vref_1261, vnew_ref_1290, target_64, target_51)
and func_54(vref_1261, target_54)
and func_55(vref_1261, target_58, target_55)
and func_56(vnew_ref_1290, target_56)
and func_57(vnew_ref_1290, target_75, target_57)
and func_58(vref_1261, target_58)
and func_59(func, target_59)
and func_60(vfp_1257, vproc_1262, target_60)
and func_61(vfp_1257, target_61)
and func_62(func, target_62)
and func_64(vref_1261, vtarget_proc_1263, target_64)
and func_65(vref_1261, target_65)
and func_66(vfp_1257, vref_1261, target_66)
and func_67(vfp_1257, vref_1261, target_67)
and func_68(vfp_1257, vref_1261, target_68)
and func_69(vt_1258, vref_1261, target_69)
and func_70(vref_1261, target_70)
and func_71(vref_1261, target_71)
and func_72(vref_1261, target_72)
and func_73(func, target_73)
and func_75(vref_1261, vnew_ref_1290, target_75)
and vfp_1257.getType().hasName("flat_binder_object *")
and vt_1258.getType().hasName("binder_transaction *")
and vref_1261.getType().hasName("binder_ref *")
and vproc_1262.getType().hasName("binder_proc *")
and vtarget_proc_1263.getType().hasName("binder_proc *")
and vnew_ref_1290.getType().hasName("binder_ref *")
and vfp_1257.getFunction() = func
and vt_1258.getFunction() = func
and vref_1261.(LocalVariable).getFunction() = func
and vproc_1262.(LocalVariable).getFunction() = func
and vtarget_proc_1263.(LocalVariable).getFunction() = func
and vnew_ref_1290.(LocalVariable).getFunction() = func
select func, func.getFile().toString() + ":" + func.getLocation().getStartLine().toString()
